import{_ as V,r as T,i as k,o as $,j as z,a as p,h as D,H as W,m as j}from"./index-BzWFaB76.js";const N={class:"content bg"},U={class:"input-box"},O={__name:"AudioVisual",setup(X){let e,u,o,a,c,r,M,b,m=!1;const h=window.devicePixelRatio||1;let A=!1;const B=T("https://ghchenjingqi.github.io/qux/thz.mp3");function L(){q(),C(),S()}function q(){e=document.getElementById("acanvas"),u=e.getContext("2d"),e.width=e.clientWidth*h,e.height=e.clientHeight*h,u.scale(h,h)}function C(){o=document.getElementById("acanvas2"),a=o.getContext("2d"),o.width=o.clientWidth*h,o.height=o.clientHeight*h,a.scale(h,h)}function S(){c=document.getElementById("audio"),c.controls=!0,c.autoplay=!1,c.crossOrigin="anonymous",c.addEventListener("play",()=>{m=!0,A||P(),R(),I()}),c.addEventListener("pause",()=>{m=!1}),c.addEventListener("ended",()=>{m=!1,F()});const i=document.getElementById("bttn");i.onclick=()=>{m||(c.src=B.value,i.innerHTML="正在播放中",c.play())}}function F(){u.clearRect(0,0,e.width,e.height),a.clearRect(0,0,o.width,o.height)}function P(){const i=new AudioContext,t=i.createMediaElementSource(c);r=i.createAnalyser(),M=r.frequencyBinCount,r.fftSize=M/2,t.connect(r),r.connect(i.destination),b=new Uint8Array(M),A=!0}function R(){if(!m)return;requestAnimationFrame(R),u.clearRect(0,0,e.width,e.height),r.getByteFrequencyData(b),u.clearRect(0,0,e.width,e.height);const i=r.frequencyBinCount,t=e.width/i,d=Math.floor(i/2);for(let f=0;f<d;f++){const s=b[f],g=s*(e.height/256),w=s+50>255?255:s+50,n=50,l=150;u.fillStyle=`rgb(${w},${n},${l})`;let y=f*t,v=e.height-g;u.fillRect(y,v,t,g);let x=e.width-(f+1)*t,E=e.height-g;u.fillRect(x,E,t,g)}}function I(){if(!m)return;requestAnimationFrame(I),r.getByteFrequencyData(b),a.clearRect(0,0,o.width,o.height);const i=r.frequencyBinCount,t=o.width/2,d=o.height/2,f=Math.min(t,d)*.8,s=f*.5,g=Math.PI*2/i;for(let n=0;n<i;n++){const l=b[n],y=l*(f-s)/256,v=l+50>255?255:l+50;a.fillStyle=`rgb(${v},50,150)`;const x=n*g,E=(n+1)*g,_=Math.PI*2-E,H=Math.PI*2-x;w(x,E,y),w(_,H,y)}function w(n,l,y){const v=s+y;a.beginPath(),a.moveTo(t+Math.cos(n)*s,d+Math.sin(n)*s),a.lineTo(t+Math.cos(n)*v,d+Math.sin(n)*v),a.arc(t,d,v,n,l),a.lineTo(t+Math.cos(l)*s,d+Math.sin(l)*s),a.arc(t,d,s,l,n,!0),a.closePath(),a.fill()}}return k(()=>{L()}),(i,t)=>($(),z("section",N,[t[3]||(t[3]=p("h3",null,"音频可视化",-1)),p("div",U,[D(p("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=d=>B.value=d)},null,512),[[W,B.value]]),t[1]||(t[1]=p("button",{id:"bttn"},"播放",-1)),t[2]||(t[2]=p("audio",{id:"audio",style:{display:"none"}},null,-1))]),t[4]||(t[4]=j('<div class="box-a" data-v-de25f8eb><div class="width50" style="width:calc(100% - 600px);" data-v-de25f8eb><canvas id="acanvas" data-v-de25f8eb></canvas></div><div class="width50" style="width:600px;" data-v-de25f8eb><canvas id="acanvas2" data-v-de25f8eb></canvas></div></div><p data-v-de25f8eb>实现代码：<a href="http://localhost:5173/#/knowledge/index?name=audio%E9%9F%B3%E9%A2%91%E5%8F%AF%E8%A7%86%E5%8C%96" data-v-de25f8eb>点击前往</a></p>',2))]))}},G=V(O,[["__scopeId","data-v-de25f8eb"]]);export{G as default};
