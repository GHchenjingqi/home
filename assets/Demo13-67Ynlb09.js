import{V as C,f as Y,Q as F,g as U,u as J,L as k}from"./Loading-BXfAn8sb.js";import{_ as q,b as z,o as X,c as Z,w as Q,u as V,a as W}from"./index-CpG5Uu6k.js";import"./allscreen-DU3wKF98.js";import"./loading-rc5OEJZk.js";const K="https://cdn.jsdelivr.net/npm/jolt-physics@0.23.0/dist/jolt-physics.wasm-compat.js",$=60;let i=null;function R(h){const s=h.parameters;if(h.type==="BoxGeometry"){const y=s.width!==void 0?s.width/2:.5,m=s.height!==void 0?s.height/2:.5,M=s.depth!==void 0?s.depth/2:.5;return new i.BoxShape(new i.Vec3(y,m,M),.05*Math.min(y,m,M),null)}else if(h.type==="SphereGeometry"||h.type==="IcosahedronGeometry"){const y=s.radius!==void 0?s.radius:1;return new i.SphereShape(y,null)}return null}const j=0,B=1,D=2;function T(h){let s=new i.ObjectLayerPairFilterTable(D);s.EnableCollision(j,B),s.EnableCollision(B,B);const y=new i.BroadPhaseLayer(0),m=new i.BroadPhaseLayer(1),M=2;let f=new i.BroadPhaseLayerInterfaceTable(D,M);f.MapObjectToBroadPhaseLayer(j,y),f.MapObjectToBroadPhaseLayer(B,m),h.mObjectLayerPairFilter=s,h.mBroadPhaseLayerInterface=f,h.mObjectVsBroadPhaseLayerFilter=new i.ObjectVsBroadPhaseLayerFilterTable(h.mBroadPhaseLayerInterface,M,h.mObjectLayerPairFilter,D)}async function H(){if(i===null){const{default:e}=await import(K);i=await e()}const h=new i.JoltSettings;T(h);const s=new i.JoltInterface(h);i.destroy(h);const m=s.GetPhysicsSystem().GetBodyInterface(),M=[],f=new WeakMap,x=new C,t=new F,w=new C(1,1,1),g=new Y;function O(e){e.traverse(function(a){if(a.isMesh){const r=a.userData.physics;r&&L(a,r.mass,r.restitution)}})}function L(e,a=0,r=0){const p=R(e.geometry);if(p===null)return;const o=e.isInstancedMesh?v(e,a,r,p):_(e.position,e.quaternion,a,r,p);a>0&&(M.push(e),f.set(e,o))}function v(e,a,r,p){const o=e.instanceMatrix.array,c=[];for(let n=0;n<e.count;n++){const l=x.fromArray(o,n*16+12),b=t.setFromRotationMatrix(g.fromArray(o,n*16));c.push(_(l,b,a,r,p))}return c}function _(e,a,r,p,o){const c=new i.Vec3(e.x,e.y,e.z),n=new i.Quat(a.x,a.y,a.z,a.w),l=r>0?i.EMotionType_Dynamic:i.EMotionType_Static,b=r>0?B:j,d=new i.BodyCreationSettings(o,c,n,l,b);d.mRestitution=p;const G=m.CreateBody(d);return m.AddBody(G.GetID(),i.EActivation_Activate),i.destroy(d),G}function S(e,a,r=0){if(e.isInstancedMesh){const p=f.get(e),o=p[r];m.RemoveBody(o.GetID()),m.DestroyBody(o.GetID());const c=e.userData.physics;let n=o.GetShape(),l=_(a,{x:0,y:0,z:0,w:1},c.mass,c.restitution,n);p[r]=l}}function P(e,a,r=0){}const I=new U;function A(){let e=I.getDelta();e=Math.min(e,1/30);const a=e>1/55?2:1;s.Step(e,a);for(let r=0,p=M.length;r<p;r++){const o=M[r];if(o.isInstancedMesh){const c=o.instanceMatrix.array,n=f.get(o);for(let l=0;l<n.length;l++){const b=n[l],d=b.GetPosition(),G=b.GetRotation();x.set(d.GetX(),d.GetY(),d.GetZ()),t.set(G.GetX(),G.GetY(),G.GetZ(),G.GetW()),g.compose(x,t,w).toArray(c,l*16)}o.instanceMatrix.needsUpdate=!0,o.computeBoundingSphere()}else{const c=f.get(o),n=c.GetPosition(),l=c.GetRotation();o.position.set(n.GetX(),n.GetY(),n.GetZ()),o.quaternion.set(l.GetX(),l.GetY(),l.GetZ(),l.GetW())}}}return setInterval(A,1e3/$),{addScene:O,addMesh:L,setMeshPosition:S,setMeshVelocity:P}}const E={__name:"Demo13",setup(h){let s,y,m;const M=async({THREE:t,scene:w,controls:g,transControls:O,camera:L,renderer:v})=>{s=await H(),y=new t.Vector3;const _=new t.Group;let S=new t.TextureLoader,P=S.load("/home//public/images/world.jpg"),I=S.load("/home//public/images/atearth.webp"),A=new t.SphereGeometry(2,40,40),e=new t.MeshLambertMaterial({map:P,bumpMap:I,bumpScale:1}),a=new t.Mesh(A,e);a.name="earth",_.add(a);let r=S.load("/home//public/images/cloud.png"),p=new t.Mesh(new t.SphereGeometry(2.2,40,40),new t.MeshLambertMaterial({map:r,transparent:!0,opacity:.4}));p.name="earthCloud",_.add(p),w.add(_);const o=new t.Mesh(new t.BoxGeometry(10,5,10),new t.ShadowMaterial({color:4473924}));o.position.y=-5,o.receiveShadow=!0,o.userData.physics={mass:0},w.add(o);const c=100;e=new t.MeshBasicMaterial({color:16777215});let n=new t.InstancedMesh(new t.BoxGeometry(.3,.3,.3,2,2,2),e,c);n.instanceMatrix.setUsage(t.DynamicDrawUsage),n.userData.physics={mass:1};const l=new t.Matrix4,b=new t.Color;for(let u=0;u<c;u++)l.setPosition(Math.random()*3-5,Math.random()*3-5,Math.random()*3-5),n.setMatrixAt(u,l),n.setColorAt(u,b.setHSL(u/c,1,.5));n.position.set(-.5,0,1),w.add(n);let d=new t.InstancedMesh(new t.SphereGeometry(.3,30,12),e,c);d.instanceMatrix.setUsage(t.DynamicDrawUsage),d.userData.physics={mass:1};const G=new t.Matrix4,N=new t.Color;for(let u=0;u<c;u++)G.setPosition(Math.random()*2-5,Math.random()*2-5,Math.random()*2-5),d.setMatrixAt(u,G),d.setColorAt(u,N.setHSL(u/c,1,.5));d.position.set(-.5,0,1),w.add(d),s.addScene(w),m=setInterval(()=>{let u=Math.floor(Math.random()*n.count);y.set(-3,Math.random()+3,0),s.setMeshPosition(n,y,u),u=Math.floor(Math.random()*d.count),y.set(5,Math.random()+3,0),s.setMeshPosition(d,y,u)},16.666666666666668)},{loading:f,pregress:x}=J({el:"#canvas",background:"#fff",cameraPosition:[0,2,6],control:!0,controlAutoSpeed:!0,helper:!1,light:!0,creatMesh:M});return z(()=>{s=y=null,m&&clearInterval(m)}),(t,w)=>(X(),Z(k,{loading:V(f),pregress:V(x)},{default:Q(()=>w[0]||(w[0]=[W("canvas",{id:"canvas"},null,-1)])),_:1},8,["loading","pregress"]))}},ae=q(E,[["__scopeId","data-v-9a3c38c4"]]);export{ae as default};
