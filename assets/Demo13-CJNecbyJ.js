import{V as C,f as Y,Q as F,g as U,u as J,L as k}from"./Loading-ZeL5atX1.js";import{_ as q,b as z,o as X,c as Z,w as Q,u as V,a as W}from"./index-Bgeq1sOb.js";import"./allscreen-DI_KOFBz.js";import"./loading-kJxifjDy.js";const K="https://cdn.jsdelivr.net/npm/jolt-physics@0.23.0/dist/jolt-physics.wasm-compat.js",$=60;let i=null;function R(p){const s=p.parameters;if(p.type==="BoxGeometry"){const y=s.width!==void 0?s.width/2:.5,m=s.height!==void 0?s.height/2:.5,f=s.depth!==void 0?s.depth/2:.5;return new i.BoxShape(new i.Vec3(y,m,f),.05*Math.min(y,m,f),null)}else if(p.type==="SphereGeometry"||p.type==="IcosahedronGeometry"){const y=s.radius!==void 0?s.radius:1;return new i.SphereShape(y,null)}return null}const j=0,B=1,D=2;function T(p){let s=new i.ObjectLayerPairFilterTable(D);s.EnableCollision(j,B),s.EnableCollision(B,B);const y=new i.BroadPhaseLayer(0),m=new i.BroadPhaseLayer(1),f=2;let M=new i.BroadPhaseLayerInterfaceTable(D,f);M.MapObjectToBroadPhaseLayer(j,y),M.MapObjectToBroadPhaseLayer(B,m),p.mObjectLayerPairFilter=s,p.mBroadPhaseLayerInterface=M,p.mObjectVsBroadPhaseLayerFilter=new i.ObjectVsBroadPhaseLayerFilterTable(p.mBroadPhaseLayerInterface,f,p.mObjectLayerPairFilter,D)}async function H(){if(i===null){const{default:e}=await import(K);i=await e()}const p=new i.JoltSettings;T(p);const s=new i.JoltInterface(p);i.destroy(p);const m=s.GetPhysicsSystem().GetBodyInterface(),f=[],M=new WeakMap,_=new C,t=new F,w=new C(1,1,1),g=new Y;function O(e){e.traverse(function(a){if(a.isMesh){const r=a.userData.physics;r&&L(a,r.mass,r.restitution)}})}function L(e,a=0,r=0){const u=R(e.geometry);if(u===null)return;const o=e.isInstancedMesh?v(e,a,r,u):x(e.position,e.quaternion,a,r,u);a>0&&(f.push(e),M.set(e,o))}function v(e,a,r,u){const o=e.instanceMatrix.array,c=[];for(let n=0;n<e.count;n++){const l=_.fromArray(o,n*16+12),b=t.setFromRotationMatrix(g.fromArray(o,n*16));c.push(x(l,b,a,r,u))}return c}function x(e,a,r,u,o){const c=new i.Vec3(e.x,e.y,e.z),n=new i.Quat(a.x,a.y,a.z,a.w),l=r>0?i.EMotionType_Dynamic:i.EMotionType_Static,b=r>0?B:j,d=new i.BodyCreationSettings(o,c,n,l,b);d.mRestitution=u;const G=m.CreateBody(d);return m.AddBody(G.GetID(),i.EActivation_Activate),i.destroy(d),G}function S(e,a,r=0){if(e.isInstancedMesh){const u=M.get(e),o=u[r];m.RemoveBody(o.GetID()),m.DestroyBody(o.GetID());const c=e.userData.physics;let n=o.GetShape(),l=x(a,{x:0,y:0,z:0,w:1},c.mass,c.restitution,n);u[r]=l}}function P(e,a,r=0){}const I=new U;function A(){let e=I.getDelta();e=Math.min(e,1/30);const a=e>1/55?2:1;s.Step(e,a);for(let r=0,u=f.length;r<u;r++){const o=f[r];if(o.isInstancedMesh){const c=o.instanceMatrix.array,n=M.get(o);for(let l=0;l<n.length;l++){const b=n[l],d=b.GetPosition(),G=b.GetRotation();_.set(d.GetX(),d.GetY(),d.GetZ()),t.set(G.GetX(),G.GetY(),G.GetZ(),G.GetW()),g.compose(_,t,w).toArray(c,l*16)}o.instanceMatrix.needsUpdate=!0,o.computeBoundingSphere()}else{const c=M.get(o),n=c.GetPosition(),l=c.GetRotation();o.position.set(n.GetX(),n.GetY(),n.GetZ()),o.quaternion.set(l.GetX(),l.GetY(),l.GetZ(),l.GetW())}}}return setInterval(A,1e3/$),{addScene:O,addMesh:L,setMeshPosition:S,setMeshVelocity:P}}const E={__name:"Demo13",setup(p){let s,y,m;const f=async({THREE:t,scene:w,controls:g,transControls:O,camera:L,renderer:v})=>{s=await H(),y=new t.Vector3;const x=new t.Group;let S=new t.TextureLoader,P=S.load("/public/images/world.jpg"),I=S.load("/public/images/atearth.webp"),A=new t.SphereGeometry(2,40,40),e=new t.MeshLambertMaterial({map:P,bumpMap:I,bumpScale:1}),a=new t.Mesh(A,e);a.name="earth",x.add(a);let r=S.load("/public/images/cloud.png"),u=new t.Mesh(new t.SphereGeometry(2.2,40,40),new t.MeshLambertMaterial({map:r,transparent:!0,opacity:.4}));u.name="earthCloud",x.add(u),w.add(x);const o=new t.Mesh(new t.BoxGeometry(10,5,10),new t.ShadowMaterial({color:4473924}));o.position.y=-5,o.receiveShadow=!0,o.userData.physics={mass:0},w.add(o);const c=100;e=new t.MeshBasicMaterial({color:16777215});let n=new t.InstancedMesh(new t.BoxGeometry(.3,.3,.3,2,2,2),e,c);n.instanceMatrix.setUsage(t.DynamicDrawUsage),n.userData.physics={mass:1};const l=new t.Matrix4,b=new t.Color;for(let h=0;h<c;h++)l.setPosition(Math.random()*3-5,Math.random()*3-5,Math.random()*3-5),n.setMatrixAt(h,l),n.setColorAt(h,b.setHSL(h/c,1,.5));n.position.set(-.5,0,1),w.add(n);let d=new t.InstancedMesh(new t.SphereGeometry(.3,30,12),e,c);d.instanceMatrix.setUsage(t.DynamicDrawUsage),d.userData.physics={mass:1};const G=new t.Matrix4,N=new t.Color;for(let h=0;h<c;h++)G.setPosition(Math.random()*2-5,Math.random()*2-5,Math.random()*2-5),d.setMatrixAt(h,G),d.setColorAt(h,N.setHSL(h/c,1,.5));d.position.set(-.5,0,1),w.add(d),s.addScene(w),m=setInterval(()=>{let h=Math.floor(Math.random()*n.count);y.set(-3,Math.random()+3,0),s.setMeshPosition(n,y,h),h=Math.floor(Math.random()*d.count),y.set(5,Math.random()+3,0),s.setMeshPosition(d,y,h)},16.666666666666668)},{loading:M,pregress:_}=J({el:"#canvas",background:"#fff",cameraPosition:[0,2,6],control:!0,controlAutoSpeed:!0,helper:!1,light:!0,creatMesh:f});return z(()=>{s=y=null,m&&clearInterval(m)}),(t,w)=>(X(),Z(k,{loading:V(M),pregress:V(_)},{default:Q(()=>w[0]||(w[0]=[W("canvas",{id:"canvas"},null,-1)])),_:1},8,["loading","pregress"]))}},ae=q(E,[["__scopeId","data-v-a8fdc3ed"]]);export{ae as default};
