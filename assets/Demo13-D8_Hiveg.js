import{V,f as Y,Q as F,g as J,u as U,L as k}from"./Loading-CWFZPSwi.js";import{f as q,_ as z,a as X,b as Z,c as Q,w as W,d as $,u as C}from"./index-CIeIexVd.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./allscreen-B9PGqhro.js";import"./loading-H6oYD2Od.js";const K="https://cdn.jsdelivr.net/npm/jolt-physics@0.23.0/dist/jolt-physics.wasm-compat.js",R=60;let i=null;function T(u){const s=u.parameters;if(u.type==="BoxGeometry"){const y=s.width!==void 0?s.width/2:.5,m=s.height!==void 0?s.height/2:.5,M=s.depth!==void 0?s.depth/2:.5;return new i.BoxShape(new i.Vec3(y,m,M),.05*Math.min(y,m,M),null)}else if(u.type==="SphereGeometry"||u.type==="IcosahedronGeometry"){const y=s.radius!==void 0?s.radius:1;return new i.SphereShape(y,null)}return null}const j=0,B=1,D=2;function H(u){let s=new i.ObjectLayerPairFilterTable(D);s.EnableCollision(j,B),s.EnableCollision(B,B);const y=new i.BroadPhaseLayer(0),m=new i.BroadPhaseLayer(1),M=2;let f=new i.BroadPhaseLayerInterfaceTable(D,M);f.MapObjectToBroadPhaseLayer(j,y),f.MapObjectToBroadPhaseLayer(B,m),u.mObjectLayerPairFilter=s,u.mBroadPhaseLayerInterface=f,u.mObjectVsBroadPhaseLayerFilter=new i.ObjectVsBroadPhaseLayerFilterTable(u.mBroadPhaseLayerInterface,M,u.mObjectLayerPairFilter,D)}async function E(){if(i===null){const{default:e}=await q(async()=>{const{default:o}=await import(`${K}`);return{default:o}},[]);i=await e()}const u=new i.JoltSettings;H(u);const s=new i.JoltInterface(u);i.destroy(u);const m=s.GetPhysicsSystem().GetBodyInterface(),M=[],f=new WeakMap,x=new V,t=new F,w=new V(1,1,1),g=new Y;function O(e){e.traverse(function(o){if(o.isMesh){const r=o.userData.physics;r&&P(o,r.mass,r.restitution)}})}function P(e,o=0,r=0){const p=T(e.geometry);if(p===null)return;const n=e.isInstancedMesh?v(e,o,r,p):b(e.position,e.quaternion,o,r,p);o>0&&(M.push(e),f.set(e,n))}function v(e,o,r,p){const n=e.instanceMatrix.array,c=[];for(let a=0;a<e.count;a++){const l=x.fromArray(n,a*16+12),G=t.setFromRotationMatrix(g.fromArray(n,a*16));c.push(b(l,G,o,r,p))}return c}function b(e,o,r,p,n){const c=new i.Vec3(e.x,e.y,e.z),a=new i.Quat(o.x,o.y,o.z,o.w),l=r>0?i.EMotionType_Dynamic:i.EMotionType_Static,G=r>0?B:j,d=new i.BodyCreationSettings(n,c,a,l,G);d.mRestitution=p;const _=m.CreateBody(d);return m.AddBody(_.GetID(),i.EActivation_Activate),i.destroy(d),_}function S(e,o,r=0){if(e.isInstancedMesh){const p=f.get(e),n=p[r];m.RemoveBody(n.GetID()),m.DestroyBody(n.GetID());const c=e.userData.physics;let a=n.GetShape(),l=b(o,{x:0,y:0,z:0,w:1},c.mass,c.restitution,a);p[r]=l}}function L(e,o,r=0){}const I=new J;function A(){let e=I.getDelta();e=Math.min(e,1/30);const o=e>1/55?2:1;s.Step(e,o);for(let r=0,p=M.length;r<p;r++){const n=M[r];if(n.isInstancedMesh){const c=n.instanceMatrix.array,a=f.get(n);for(let l=0;l<a.length;l++){const G=a[l],d=G.GetPosition(),_=G.GetRotation();x.set(d.GetX(),d.GetY(),d.GetZ()),t.set(_.GetX(),_.GetY(),_.GetZ(),_.GetW()),g.compose(x,t,w).toArray(c,l*16)}n.instanceMatrix.needsUpdate=!0,n.computeBoundingSphere()}else{const c=f.get(n),a=c.GetPosition(),l=c.GetRotation();n.position.set(a.GetX(),a.GetY(),a.GetZ()),n.quaternion.set(l.GetX(),l.GetY(),l.GetZ(),l.GetW())}}}return setInterval(A,1e3/R),{addScene:O,addMesh:P,setMeshPosition:S,setMeshVelocity:L}}const ee={__name:"Demo13",setup(u){let s,y,m;const M=async({THREE:t,scene:w,controls:g,transControls:O,camera:P,renderer:v})=>{s=await E(),y=new t.Vector3;const b=new t.Group;let S=new t.TextureLoader,L=S.load("/home//public/images/world.jpg"),I=S.load("/home//public/images/atearth.webp"),A=new t.SphereGeometry(2,40,40),e=new t.MeshLambertMaterial({map:L,bumpMap:I,bumpScale:1}),o=new t.Mesh(A,e);o.name="earth",b.add(o);let r=S.load("/home//public/images/cloud.png"),p=new t.Mesh(new t.SphereGeometry(2.2,40,40),new t.MeshLambertMaterial({map:r,transparent:!0,opacity:.4}));p.name="earthCloud",b.add(p),w.add(b);const n=new t.Mesh(new t.BoxGeometry(10,5,10),new t.ShadowMaterial({color:4473924}));n.position.y=-5,n.receiveShadow=!0,n.userData.physics={mass:0},w.add(n);const c=100;e=new t.MeshBasicMaterial({color:16777215});let a=new t.InstancedMesh(new t.BoxGeometry(.3,.3,.3,2,2,2),e,c);a.instanceMatrix.setUsage(t.DynamicDrawUsage),a.userData.physics={mass:1};const l=new t.Matrix4,G=new t.Color;for(let h=0;h<c;h++)l.setPosition(Math.random()*3-5,Math.random()*3-5,Math.random()*3-5),a.setMatrixAt(h,l),a.setColorAt(h,G.setHSL(h/c,1,.5));a.position.set(-.5,0,1),w.add(a);let d=new t.InstancedMesh(new t.SphereGeometry(.3,30,12),e,c);d.instanceMatrix.setUsage(t.DynamicDrawUsage),d.userData.physics={mass:1};const _=new t.Matrix4,N=new t.Color;for(let h=0;h<c;h++)_.setPosition(Math.random()*2-5,Math.random()*2-5,Math.random()*2-5),d.setMatrixAt(h,_),d.setColorAt(h,N.setHSL(h/c,1,.5));d.position.set(-.5,0,1),w.add(d),s.addScene(w),m=setInterval(()=>{let h=Math.floor(Math.random()*a.count);y.set(-3,Math.random()+3,0),s.setMeshPosition(a,y,h),h=Math.floor(Math.random()*d.count),y.set(5,Math.random()+3,0),s.setMeshPosition(d,y,h)},16.666666666666668)},{loading:f,pregress:x}=U({el:"#canvas",background:"#fff",cameraPosition:[0,2,6],control:!0,controlAutoSpeed:!0,helper:!1,light:!0,creatMesh:M});return X(()=>{s=y=null,m&&clearInterval(m)}),(t,w)=>(Z(),Q(k,{loading:C(f),pregress:C(x)},{default:W(()=>w[0]||(w[0]=[$("canvas",{id:"canvas"},null,-1)])),_:1},8,["loading","pregress"]))}},ie=z(ee,[["__scopeId","data-v-9a3c38c4"]]);export{ie as default};
