import{V as C,f as Y,Q as F,g as U,u as J,L as k}from"./Loading-79aDrk5N.js";import{_ as q,d as z,o as X,c as Z,w as Q,u as V,p as W,a as K,b as $}from"./index-VRAcYr2a.js";import"./allscreen-BbwXwfjp.js";import"./loading-BwWTHRMq.js";const R="https://cdn.jsdelivr.net/npm/jolt-physics@0.23.0/dist/jolt-physics.wasm-compat.js",T=60;let i=null;function H(c){const s=c.parameters;if(c.type==="BoxGeometry"){const y=s.width!==void 0?s.width/2:.5,m=s.height!==void 0?s.height/2:.5,f=s.depth!==void 0?s.depth/2:.5;return new i.BoxShape(new i.Vec3(y,m,f),.05*Math.min(y,m,f),null)}else if(c.type==="SphereGeometry"||c.type==="IcosahedronGeometry"){const y=s.radius!==void 0?s.radius:1;return new i.SphereShape(y,null)}return null}const j=0,B=1,D=2;function E(c){let s=new i.ObjectLayerPairFilterTable(D);s.EnableCollision(j,B),s.EnableCollision(B,B);const y=new i.BroadPhaseLayer(0),m=new i.BroadPhaseLayer(1),f=2;let M=new i.BroadPhaseLayerInterfaceTable(D,f);M.MapObjectToBroadPhaseLayer(j,y),M.MapObjectToBroadPhaseLayer(B,m),c.mObjectLayerPairFilter=s,c.mBroadPhaseLayerInterface=M,c.mObjectVsBroadPhaseLayerFilter=new i.ObjectVsBroadPhaseLayerFilterTable(c.mBroadPhaseLayerInterface,f,c.mObjectLayerPairFilter,D)}async function ee(){if(i===null){const{default:e}=await import(R);i=await e()}const c=new i.JoltSettings;E(c);const s=new i.JoltInterface(c);i.destroy(c);const m=s.GetPhysicsSystem().GetBodyInterface(),f=[],M=new WeakMap,x=new C,t=new F,G=new C(1,1,1),g=new Y;function O(e){e.traverse(function(a){if(a.isMesh){const r=a.userData.physics;r&&I(a,r.mass,r.restitution)}})}function I(e,a=0,r=0){const h=H(e.geometry);if(h===null)return;const o=e.isInstancedMesh?v(e,a,r,h):b(e.position,e.quaternion,a,r,h);a>0&&(f.push(e),M.set(e,o))}function v(e,a,r,h){const o=e.instanceMatrix.array,d=[];for(let n=0;n<e.count;n++){const l=x.fromArray(o,n*16+12),_=t.setFromRotationMatrix(g.fromArray(o,n*16));d.push(b(l,_,a,r,h))}return d}function b(e,a,r,h,o){const d=new i.Vec3(e.x,e.y,e.z),n=new i.Quat(a.x,a.y,a.z,a.w),l=r>0?i.EMotionType_Dynamic:i.EMotionType_Static,_=r>0?B:j,p=new i.BodyCreationSettings(o,d,n,l,_);p.mRestitution=h;const w=m.CreateBody(p);return m.AddBody(w.GetID(),i.EActivation_Activate),i.destroy(p),w}function S(e,a,r=0){if(e.isInstancedMesh){const h=M.get(e),o=h[r];m.RemoveBody(o.GetID()),m.DestroyBody(o.GetID());const d=e.userData.physics;let n=o.GetShape(),l=b(a,{x:0,y:0,z:0,w:1},d.mass,d.restitution,n);h[r]=l}}function L(e,a,r=0){}const P=new U;function A(){let e=P.getDelta();e=Math.min(e,1/30);const a=e>1/55?2:1;s.Step(e,a);for(let r=0,h=f.length;r<h;r++){const o=f[r];if(o.isInstancedMesh){const d=o.instanceMatrix.array,n=M.get(o);for(let l=0;l<n.length;l++){const _=n[l],p=_.GetPosition(),w=_.GetRotation();x.set(p.GetX(),p.GetY(),p.GetZ()),t.set(w.GetX(),w.GetY(),w.GetZ(),w.GetW()),g.compose(x,t,G).toArray(d,l*16)}o.instanceMatrix.needsUpdate=!0,o.computeBoundingSphere()}else{const d=M.get(o),n=d.GetPosition(),l=d.GetRotation();o.position.set(n.GetX(),n.GetY(),n.GetZ()),o.quaternion.set(l.GetX(),l.GetY(),l.GetZ(),l.GetW())}}}return setInterval(A,1e3/T),{addScene:O,addMesh:I,setMeshPosition:S,setMeshVelocity:L}}const te=c=>(W("data-v-a8fdc3ed"),c=c(),K(),c),oe=te(()=>$("canvas",{id:"canvas"},null,-1)),ne={__name:"Demo13",setup(c){let s,y,m;const f=async({THREE:t,scene:G,controls:g,transControls:O,camera:I,renderer:v})=>{s=await ee(),y=new t.Vector3;const b=new t.Group;let S=new t.TextureLoader,L=S.load("/public/images/world.jpg"),P=S.load("/public/images/atearth.webp"),A=new t.SphereGeometry(2,40,40),e=new t.MeshLambertMaterial({map:L,bumpMap:P,bumpScale:1}),a=new t.Mesh(A,e);a.name="earth",b.add(a);let r=S.load("/public/images/cloud.png"),h=new t.Mesh(new t.SphereGeometry(2.2,40,40),new t.MeshLambertMaterial({map:r,transparent:!0,opacity:.4}));h.name="earthCloud",b.add(h),G.add(b);const o=new t.Mesh(new t.BoxGeometry(10,5,10),new t.ShadowMaterial({color:4473924}));o.position.y=-5,o.receiveShadow=!0,o.userData.physics={mass:0},G.add(o);const d=100;e=new t.MeshBasicMaterial({color:16777215});let n=new t.InstancedMesh(new t.BoxGeometry(.3,.3,.3,2,2,2),e,d);n.instanceMatrix.setUsage(t.DynamicDrawUsage),n.userData.physics={mass:1};const l=new t.Matrix4,_=new t.Color;for(let u=0;u<d;u++)l.setPosition(Math.random()*3-5,Math.random()*3-5,Math.random()*3-5),n.setMatrixAt(u,l),n.setColorAt(u,_.setHSL(u/d,1,.5));n.position.set(-.5,0,1),G.add(n);let p=new t.InstancedMesh(new t.SphereGeometry(.3,30,12),e,d);p.instanceMatrix.setUsage(t.DynamicDrawUsage),p.userData.physics={mass:1};const w=new t.Matrix4,N=new t.Color;for(let u=0;u<d;u++)w.setPosition(Math.random()*2-5,Math.random()*2-5,Math.random()*2-5),p.setMatrixAt(u,w),p.setColorAt(u,N.setHSL(u/d,1,.5));p.position.set(-.5,0,1),G.add(p),s.addScene(G),m=setInterval(()=>{let u=Math.floor(Math.random()*n.count);y.set(-3,Math.random()+3,0),s.setMeshPosition(n,y,u),u=Math.floor(Math.random()*p.count),y.set(5,Math.random()+3,0),s.setMeshPosition(p,y,u)},16.666666666666668)},{loading:M,pregress:x}=J({el:"#canvas",background:"#fff",cameraPosition:[0,2,6],control:!0,controlAutoSpeed:!0,helper:!1,light:!0,creatMesh:f});return z(()=>{s=y=null,m&&clearInterval(m)}),(t,G)=>(X(),Z(k,{loading:V(M),pregress:V(x)},{default:Q(()=>[oe]),_:1},8,["loading","pregress"]))}},ce=q(ne,[["__scopeId","data-v-a8fdc3ed"]]);export{ce as default};
