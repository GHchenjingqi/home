import{_ as E,r as B,o as ee,a as oe,b as te,c as ae,w as se,d as a,t as m,j as ne,h as ie,v as le,u as re}from"./index-BuYTP-pm.js";import{u as ce,L as pe}from"./Loading-DC6eqkF4.js";import{g as S}from"./comfun-BiQWa5Ul.js";import{W as de,N as ue,P as fe,a as q,V as w,B as N,Q as ye}from"./cannon-es-BWPdSu6A.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./allscreen-DnW93eKv.js";import"./loading-C4V6Bmbo.js";const me={class:"box-position"},we={class:"grade-box",style:{display:"none"}},he={class:"gald"},xe={__name:"Demo34",setup(be){let t=null,h=null,l=null,p=null,n=null,x=null;const b=B([0,0,0]),v=B(0),A=B(0),V=async({THREE:e,scene:o,camera:c})=>{let d=new e.PlaneGeometry(2e3,2e3,100,100);d.rotateX(-Math.PI/2);const r=new e.MeshBasicMaterial({color:1118481}),u=new e.Mesh(d,r);u.position.y=-.5,o.add(u);let P=new e.BoxGeometry(1,1,1),F=new e.MeshBasicMaterial({color:16711680});t=new e.Mesh(P,F),t.position.set(S(-3,3),0,S(1,4)),o.add(t),p=new e.Group;let f=new e.Mesh(P,F);f.position.x=1,f.material=new e.MeshBasicMaterial({color:16776960,transparent:!0,opacity:.8,transmission:.9,roughness:.3,metalness:.1,clearcoat:.5,clearcoatRoughness:.1,ior:1.3,thickness:.5,specularColor:new e.Color(16777215)});const G=new e.Group;for(let i=0;i<50;i++){const y=new e.Mesh(new e.SphereGeometry(.05,8,8),new e.MeshBasicMaterial({color:16777215}));y.position.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize().multiplyScalar(Math.random()*.8),G.add(y)}f.add(G);let I=f.clone();I.position.x=-1;let z=f.clone();z.position.x=0,z.position.z=-1,x=new e.Mesh(new e.PlaneGeometry(1,1),new e.MeshBasicMaterial({color:65280})),x.rotateX(-Math.PI/2).translateZ(-.49),p.add(f,I,z),o.add(p,x),l=new de,l.gravity.set(0,0,0),l.quatNormalizeSkip=0,l.quatNormalizeFast=!1,l.broadphase=new ue;const Z=new fe,M=new q({mass:0});M.addShape(Z),M.quaternion.setFromAxisAngle(new w(1,0,0),-Math.PI/2),M.position.y=-.5,l.addBody(M);const O=new N(new w(.5,.5,.5));n=new q({mass:1,position:new w().copy(t.position),angularFactor:new w(0,0,0),angularDamping:.8,linearDamping:.8,shape:O}),n.velocity.set(0,0,0),n.allowSleep=!1,n.addEventListener("collide",i=>{i.body===h&&(t.material.color.setHex(65280),i.contact.restitution=.3)}),l.addBody(n),h=new q({mass:0}),p.traverse(i=>{if(i instanceof e.Mesh){const y=i.geometry.parameters,$=new w(y.width/2,y.height/2,y.depth/2),R=new N($),T=new w().copy(i.position),H=new ye().copy(i.quaternion);h.addShape(R,T,H)}}),l.addBody(h),c.position.set(t.position.x,t.position.y+5,t.position.z+10),c.lookAt(p.position)};let D=!1;const J=()=>{l.step(1/60),t.position.copy(n.position),t.quaternion.copy(n.quaternion),Y(),n.position.z>1&&t.material.color.setHex(16711680),t.position.y=0,n.position.y=0,n.velocity.y=0,b.value=[t.position.x,t.position.y,t.position.z],W(t,x,.5)&&(D=!0,v.value=((performance.now()-A.value)/1e3).toFixed(3),k.value=!1,document.querySelector(".grade-box").style.display="block")};function W(e,o,c=.3){return e.position.distanceTo(o.position)<c}const C=(e,o)=>{const r=new e.Vector3().copy(t.position);r.y+=8,o.position.lerp(r,.1),o.position.z+=.2,o.lookAt(p.position)},U=({THREE:e,controls:o,scene:c,camera:d,renderer:r,stats:u})=>{u==null||u.update(),o==null||o.update(),D||(J(),C(e,d)),r==null||r.render(c,d)},{loading:Q}=ce({el:"#canvas",background:"#333333",cameraPosition:[2,2,6],control:!0,controlAutoSpeed:!1,helper:!1,light:!0,showStats:!0,creatMesh:V,animation:U});let g=1,X=.5,s={forward:!1,backward:!1,left:!1,right:!1,canJump:!1};const Y=()=>{const e=n.velocity;s.forward&&(e.z=-g),s.backward&&(e.z=g),s.left&&(e.x=-g),s.right&&(e.x=g),s.canJump&&Math.abs(e.y)<.01&&(e.y=X,s.canJump=!1)},K=function(e){switch(e.code){case"ArrowUp":case"KeyW":s.forward=!0;break;case"ArrowLeft":case"KeyA":s.left=!0;break;case"ArrowDown":case"KeyS":s.backward=!0;break;case"ArrowRight":case"KeyD":s.right=!0;break;case"Space":s.canJump=!1;break}},_=function(e){switch(e.code){case"ArrowUp":case"KeyW":s.forward=!1;break;case"ArrowLeft":case"KeyA":s.left=!1;break;case"ArrowDown":case"KeyS":s.backward=!1;break;case"ArrowRight":case"KeyD":s.right=!1;break;case"Space":s.canJump=!1;break}};let k=B(!1);const j=()=>k.value?((performance.now()-A.value)/1e3).toFixed(3):0,L=()=>{document.querySelector(".playbox").style.display="none",document.querySelector(".grade-box").style.display="none",document.addEventListener("keydown",K),document.addEventListener("keyup",_),k.value=!0,D=!1,A.value=performance.now();const e=S(-3,3),o=S(1,4);t.position.set(e,0,o),n.position.set(e,0,o),n.velocity.set(0,0,0),n.angularVelocity.set(0,0,0),t.material.color.setHex(16711680)};return ee(()=>{document.getElementById("reset").onclick=()=>{L()},document.getElementById("reset2").onclick=()=>{L()},document.getElementById("help").onclick=()=>{document.querySelector(".playbox").style.display="block",k.value=!1}}),oe(()=>{document.removeEventListener("keydown",K),document.removeEventListener("keyup",_),s=null}),(e,o)=>(te(),ae(pe,{loading:re(Q)},{default:se(()=>[o[2]||(o[2]=a("div",{id:"canvas"},null,-1)),a("div",me,[a("p",null,"盒子位置：x轴"+m(b.value[0].toFixed(2))+",y轴"+m(b.value[1].toFixed(2))+",z轴"+m(b.value[2].toFixed(2)),1),a("p",null,[ne("用时："+m(j())+"s ",1),ie(a("span",null,"，成绩"+m(v.value)+"s",513),[[le,v.value]])])]),o[3]||(o[3]=a("div",{class:"playbox"},[a("div",{class:"help"},[a("h3",null,"玩法介绍"),a("p",null,"1.按键盘“WASD”或“↑←↓→”键移动红色盒子"),a("p",null,"2.将红色盒子移动到绿色区域，挑战成功")]),a("div",{class:"btn-group"},[a("button",{class:"btn-paly",id:"reset"},"开始挑战")])],-1)),a("div",we,[a("div",he,[o[0]||(o[0]=a("h3",null,"恭喜完成任务",-1)),a("p",null,"成绩："+m(v.value||0)+"s",1)]),o[1]||(o[1]=a("div",{class:"btn-group"},[a("button",{class:"btn-paly",id:"reset2"},"再玩一次")],-1))]),o[4]||(o[4]=a("div",{class:"btn",id:"help"},"帮助",-1))]),_:1},8,["loading"]))}},ze=E(xe,[["__scopeId","data-v-74ee05ee"]]);export{ze as default};
