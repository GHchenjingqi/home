import"./FileSaver.min-BFbnFquq.js";import{_ as v,r as f,o as w,b as h,l as g,d as i,j as u,m as b}from"./index-B4xWM6pg.js";import"./_commonjsHelpers-Cpj98o6Y.js";class _{constructor(e={}){this.quality=e.quality||.8,this.maxWidth=e.maxWidth||null,this.maxHeight=e.maxHeight||null}async convertFileToWebP(e){if(!e.type.startsWith("image/"))throw new Error("Invalid file type. Only images are supported.");const n=await this._createImage(e);return this._convertImageToWebP(n)}async convertURLToWebP(e){const n=await this._loadImage(e);return this._convertImageToWebP(n)}_createImage(e){return new Promise((n,o)=>{const t=new Image;t.onload=()=>n(t),t.onerror=o,t.src=URL.createObjectURL(e)})}_loadImage(e){return new Promise((n,o)=>{const t=new Image;t.crossOrigin="anonymous",t.onload=()=>n(t),t.onerror=o,t.src=e})}_convertImageToWebP(e){const n=document.createElement("canvas");let o=e.width,t=e.height;return this.maxWidth&&o>this.maxWidth&&(t=this.maxWidth/o*t,o=this.maxWidth),this.maxHeight&&t>this.maxHeight&&(o=this.maxHeight/t*o,t=this.maxHeight),n.width=o,n.height=t,n.getContext("2d").drawImage(e,0,0,o,t),new Promise(r=>{n.toBlob(l=>r(l),"image/webp",this.quality)})}}const I={class:"content"},x={key:0,class:"width50"},W=["src"],y={__name:"Img2Webp",setup(p){const e=f(""),n=new _({quality:.8}),o=()=>{if(e.value){const a=document.createElement("a");a.href=e.value,a.download="converted.webp",a.click()}},t=async a=>{const r=await n.convertFileToWebP(a);e.value=URL.createObjectURL(r)};return w(()=>{const a=document.getElementById("dropZone"),r=document.getElementById("fileInput");["dragenter","dragover","dragleave","drop"].forEach(s=>{a.addEventListener(s,l,!1)});function l(s){s.preventDefault(),s.stopPropagation()}["dragenter","dragover"].forEach(s=>{a.addEventListener(s,()=>a.classList.add("hover"),!1)}),["dragleave","drop"].forEach(s=>{a.addEventListener(s,()=>a.classList.remove("hover"),!1)}),a.addEventListener("click",()=>r.click(),!1),r.addEventListener("change",c,!1),a.addEventListener("drop",c,!1);function c(s){let d=s.dataTransfer,m=d?d.files:r.files;m.length>0&&t(m[0])}}),(a,r)=>(h(),g("section",I,[r[1]||(r[1]=i("div",{class:"width50"},[i("h1",null,"PNG/JPG转Webp"),i("div",{id:"dropZone",style:{"margin-top":"1rem"}},[u("将文件拖放到此处"),i("br"),u("或点击选择文件 "),i("input",{type:"file",style:{display:"none"},id:"fileInput"})])],-1)),e.value?(h(),g("div",x,[r[0]||(r[0]=i("h3",null,"转换结果：",-1)),i("img",{src:e.value,alt:"预览"},null,8,W),i("button",{onClick:o},"下载WebP")])):b("",!0)]))}},T=v(y,[["__scopeId","data-v-a5a9e6f0"]]);export{T as default};
