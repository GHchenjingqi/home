import{c as Kt,g as Js}from"./_commonjsHelpers-Cpj98o6Y.js";import{c as Yt}from"./_commonjs-dynamic-modules-TDtrdbi3.js";import{C as ws,V as J,J as _t,T as mt,Q as ye,K as Vn,i as De,X as $s,Y as ei,t as ke,Z as ti,O as $e,M as dt,L as Hn,_ as Me,$ as Re,B as at,F as st,c as q,a0 as Vt,d as Ye,a1 as St,a2 as ni,E as it,e as he,a3 as si,D as At,a4 as ii,a5 as Pn,a6 as bs,a7 as wt,u as zt,a8 as bt,v as Bt,a9 as qe,a as Se,aa as Ve,z as we,ab as vs,ac as ln,ad as Gn,ae as ri,af as oi,ag as As,ah as ai,ai as li,aj as xs,ak as ci,al as hi,am as ui,an as Cn,ao as Ts,ap as Nt,aq as fi,ar as Mn,as as di,at as mn,au as Es,av as Ut,aw as Ss,ax as pi,ay as mi,az as gi,G as Lt,aA as Xn,g as yi,aB as ks,aC as Is,aD as Ln,aE as _i,aF as Rs,aG as wi,aH as Dn,aI as On,aJ as Fn,aK as cn,l as Ge,aL as bi,aM as vi,aN as Ai,aO as xi,aP as jt,aQ as Ti,aR as gn,aS as Ei,aT as Si,aU as Ps,aV as ki,w as Ii,y as Ri,aW as Pi,aX as qn,aY as Ci,aZ as Mi,a_ as sn,f as Li,a$ as Di}from"./three-vendor-FOuzmdZG.js";import{b as Oi,u as Fi,_ as zi}from"./index-k_b31qc0.js";import{i as Bi,q as Ni,A as zn,s as dn,c as Qn,o as Jn,x as Ui,g as yn,y as ji,f as Hi,t as Gi,B as Xi}from"./vue-vendor-C-eO5OHd.js";import{u as Zi}from"./loading-Dwx6fc8s.js";var _n={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var $n;function Wi(){return $n||($n=1,(function(p,e){(function(t){p.exports=t()})(function(){return(function t(i,n,s){function r(c,h){if(!n[c]){if(!i[c]){var l=typeof Yt=="function"&&Yt;if(!h&&l)return l(c,!0);if(o)return o(c,!0);var f=new Error("Cannot find module '"+c+"'");throw f.code="MODULE_NOT_FOUND",f}var u=n[c]={exports:{}};i[c][0].call(u.exports,function(_){var m=i[c][1][_];return r(m||_)},u,u.exports,t,i,n,s)}return n[c].exports}for(var o=typeof Yt=="function"&&Yt,a=0;a<s.length;a++)r(s[a]);return r})({1:[function(t,i,n){var s=t("./utils"),r=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(a){for(var c,h,l,f,u,_,m,g=[],w=0,b=a.length,v=b,T=s.getTypeOf(a)!=="string";w<a.length;)v=b-w,l=T?(c=a[w++],h=w<b?a[w++]:0,w<b?a[w++]:0):(c=a.charCodeAt(w++),h=w<b?a.charCodeAt(w++):0,w<b?a.charCodeAt(w++):0),f=c>>2,u=(3&c)<<4|h>>4,_=1<v?(15&h)<<2|l>>6:64,m=2<v?63&l:64,g.push(o.charAt(f)+o.charAt(u)+o.charAt(_)+o.charAt(m));return g.join("")},n.decode=function(a){var c,h,l,f,u,_,m=0,g=0,w="data:";if(a.substr(0,w.length)===w)throw new Error("Invalid base64 input, it looks like a data url.");var b,v=3*(a=a.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(a.charAt(a.length-1)===o.charAt(64)&&v--,a.charAt(a.length-2)===o.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=r.uint8array?new Uint8Array(0|v):new Array(0|v);m<a.length;)c=o.indexOf(a.charAt(m++))<<2|(f=o.indexOf(a.charAt(m++)))>>4,h=(15&f)<<4|(u=o.indexOf(a.charAt(m++)))>>2,l=(3&u)<<6|(_=o.indexOf(a.charAt(m++))),b[g++]=c,u!==64&&(b[g++]=h),_!==64&&(b[g++]=l);return b}},{"./support":30,"./utils":32}],2:[function(t,i,n){var s=t("./external"),r=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),a=t("./stream/DataLengthProbe");function c(h,l,f,u,_){this.compressedSize=h,this.uncompressedSize=l,this.crc32=f,this.compression=u,this.compressedContent=_}c.prototype={getContentWorker:function(){var h=new r(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),l=this;return h.on("end",function(){if(this.streamInfo.data_length!==l.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new r(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(h,l,f){return h.pipe(new o).pipe(new a("uncompressedSize")).pipe(l.compressWorker(f)).pipe(new a("compressedSize")).withStreamInfo("compression",l)},i.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,i,n){var s=t("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},n.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,i,n){var s=t("./utils"),r=(function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var h=0;h<8;h++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a})();i.exports=function(o,a){return o!==void 0&&o.length?s.getTypeOf(o)!=="string"?(function(c,h,l,f){var u=r,_=f+l;c^=-1;for(var m=f;m<_;m++)c=c>>>8^u[255&(c^h[m])];return-1^c})(0|a,o,o.length,0):(function(c,h,l,f){var u=r,_=f+l;c^=-1;for(var m=f;m<_;m++)c=c>>>8^u[255&(c^h.charCodeAt(m))];return-1^c})(0|a,o,o.length,0):0}},{"./utils":32}],5:[function(t,i,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(t,i,n){var s=null;s=typeof Promise<"u"?Promise:t("lie"),i.exports={Promise:s}},{lie:37}],7:[function(t,i,n){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=t("pako"),o=t("./utils"),a=t("./stream/GenericWorker"),c=s?"uint8array":"array";function h(l,f){a.call(this,"FlateWorker/"+l),this._pako=null,this._pakoAction=l,this._pakoOptions=f,this.meta={}}n.magic="\b\0",o.inherits(h,a),h.prototype.processChunk=function(l){this.meta=l.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(c,l.data),!1)},h.prototype.flush=function(){a.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var l=this;this._pako.onData=function(f){l.push({data:f,meta:l.meta})}},n.compressWorker=function(l){return new h("Deflate",l)},n.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,i,n){function s(u,_){var m,g="";for(m=0;m<_;m++)g+=String.fromCharCode(255&u),u>>>=8;return g}function r(u,_,m,g,w,b){var v,T,S=u.file,M=u.compression,P=b!==c.utf8encode,z=o.transformTo("string",b(S.name)),C=o.transformTo("string",c.utf8encode(S.name)),H=S.comment,K=o.transformTo("string",b(H)),E=o.transformTo("string",c.utf8encode(H)),F=C.length!==S.name.length,y=E.length!==H.length,O="",$="",U="",ne=S.dir,N=S.date,ee={crc32:0,compressedSize:0,uncompressedSize:0};_&&!m||(ee.crc32=u.crc32,ee.compressedSize=u.compressedSize,ee.uncompressedSize=u.uncompressedSize);var L=0;_&&(L|=8),P||!F&&!y||(L|=2048);var I=0,Q=0;ne&&(I|=16),w==="UNIX"?(Q=798,I|=(function(Z,fe){var ve=Z;return Z||(ve=fe?16893:33204),(65535&ve)<<16})(S.unixPermissions,ne)):(Q=20,I|=(function(Z){return 63&(Z||0)})(S.dosPermissions)),v=N.getUTCHours(),v<<=6,v|=N.getUTCMinutes(),v<<=5,v|=N.getUTCSeconds()/2,T=N.getUTCFullYear()-1980,T<<=4,T|=N.getUTCMonth()+1,T<<=5,T|=N.getUTCDate(),F&&($=s(1,1)+s(h(z),4)+C,O+="up"+s($.length,2)+$),y&&(U=s(1,1)+s(h(K),4)+E,O+="uc"+s(U.length,2)+U);var Y="";return Y+=`
\0`,Y+=s(L,2),Y+=M.magic,Y+=s(v,2),Y+=s(T,2),Y+=s(ee.crc32,4),Y+=s(ee.compressedSize,4),Y+=s(ee.uncompressedSize,4),Y+=s(z.length,2),Y+=s(O.length,2),{fileRecord:l.LOCAL_FILE_HEADER+Y+z+O,dirRecord:l.CENTRAL_FILE_HEADER+s(Q,2)+Y+s(K.length,2)+"\0\0\0\0"+s(I,4)+s(g,4)+z+O+K}}var o=t("../utils"),a=t("../stream/GenericWorker"),c=t("../utf8"),h=t("../crc32"),l=t("../signature");function f(u,_,m,g){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=_,this.zipPlatform=m,this.encodeFileName=g,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(f,a),f.prototype.push=function(u){var _=u.meta.percent||0,m=this.entriesCount,g=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,a.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:m?(_+100*(m-g-1))/m:100}}))},f.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var _=this.streamFiles&&!u.file.dir;if(_){var m=r(u,_,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(u){this.accumulate=!1;var _=this.streamFiles&&!u.file.dir,m=r(u,_,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),_)this.push({data:(function(g){return l.DATA_DESCRIPTOR+s(g.crc32,4)+s(g.compressedSize,4)+s(g.uncompressedSize,4)})(u),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var u=this.bytesWritten,_=0;_<this.dirRecords.length;_++)this.push({data:this.dirRecords[_],meta:{percent:100}});var m=this.bytesWritten-u,g=(function(w,b,v,T,S){var M=o.transformTo("string",S(T));return l.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(w,2)+s(w,2)+s(b,4)+s(v,4)+s(M.length,2)+M})(this.dirRecords.length,m,u,this.zipComment,this.encodeFileName);this.push({data:g,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(u){this._sources.push(u);var _=this;return u.on("data",function(m){_.processChunk(m)}),u.on("end",function(){_.closedSource(_.previous.streamInfo),_._sources.length?_.prepareNextSource():_.end()}),u.on("error",function(m){_.error(m)}),this},f.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(u){var _=this._sources;if(!a.prototype.error.call(this,u))return!1;for(var m=0;m<_.length;m++)try{_[m].error(u)}catch{}return!0},f.prototype.lock=function(){a.prototype.lock.call(this);for(var u=this._sources,_=0;_<u.length;_++)u[_].lock()},i.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,i,n){var s=t("../compressions"),r=t("./ZipFileWorker");n.generateWorker=function(o,a,c){var h=new r(a.streamFiles,c,a.platform,a.encodeFileName),l=0;try{o.forEach(function(f,u){l++;var _=(function(b,v){var T=b||v,S=s[T];if(!S)throw new Error(T+" is not a valid compression method !");return S})(u.options.compression,a.compression),m=u.options.compressionOptions||a.compressionOptions||{},g=u.dir,w=u.date;u._compressWorker(_,m).withStreamInfo("file",{name:f,dir:g,date:w,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(h)}),h.entriesCount=l}catch(f){h.error(f)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,i,n){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new s;for(var o in this)typeof this[o]!="function"&&(r[o]=this[o]);return r}}(s.prototype=t("./object")).loadAsync=t("./load"),s.support=t("./support"),s.defaults=t("./defaults"),s.version="3.10.1",s.loadAsync=function(r,o){return new s().loadAsync(r,o)},s.external=t("./external"),i.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,i,n){var s=t("./utils"),r=t("./external"),o=t("./utf8"),a=t("./zipEntries"),c=t("./stream/Crc32Probe"),h=t("./nodejsUtils");function l(f){return new r.Promise(function(u,_){var m=f.decompressed.getContentWorker().pipe(new c);m.on("error",function(g){_(g)}).on("end",function(){m.streamInfo.crc32!==f.decompressed.crc32?_(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}i.exports=function(f,u){var _=this;return u=s.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),h.isNode&&h.isStream(f)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",f,!0,u.optimizedBinaryString,u.base64).then(function(m){var g=new a(u);return g.load(m),g}).then(function(m){var g=[r.Promise.resolve(m)],w=m.files;if(u.checkCRC32)for(var b=0;b<w.length;b++)g.push(l(w[b]));return r.Promise.all(g)}).then(function(m){for(var g=m.shift(),w=g.files,b=0;b<w.length;b++){var v=w[b],T=v.fileNameStr,S=s.resolve(v.fileNameStr);_.file(S,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:u.createFolders}),v.dir||(_.file(S).unsafeOriginalName=T)}return g.zipComment.length&&(_.comment=g.zipComment),_})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,i,n){var s=t("../utils"),r=t("../stream/GenericWorker");function o(a,c){r.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(c)}s.inherits(o,r),o.prototype._bindStream=function(a){var c=this;(this._stream=a).pause(),a.on("data",function(h){c.push({data:h,meta:{percent:0}})}).on("error",function(h){c.isPaused?this.generatedError=h:c.error(h)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},o.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,i,n){var s=t("readable-stream").Readable;function r(o,a,c){s.call(this,a),this._helper=o;var h=this;o.on("data",function(l,f){h.push(l)||h._helper.pause(),c&&c(f)}).on("error",function(l){h.emit("error",l)}).on("end",function(){h.push(null)})}t("../utils").inherits(r,s),r.prototype._read=function(){this._helper.resume()},i.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,i,n){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,r);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,r)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var r=new Buffer(s);return r.fill(0),r},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(t,i,n){function s(S,M,P){var z,C=o.getTypeOf(M),H=o.extend(P||{},h);H.date=H.date||new Date,H.compression!==null&&(H.compression=H.compression.toUpperCase()),typeof H.unixPermissions=="string"&&(H.unixPermissions=parseInt(H.unixPermissions,8)),H.unixPermissions&&16384&H.unixPermissions&&(H.dir=!0),H.dosPermissions&&16&H.dosPermissions&&(H.dir=!0),H.dir&&(S=w(S)),H.createFolders&&(z=g(S))&&b.call(this,z,!0);var K=C==="string"&&H.binary===!1&&H.base64===!1;P&&P.binary!==void 0||(H.binary=!K),(M instanceof l&&M.uncompressedSize===0||H.dir||!M||M.length===0)&&(H.base64=!1,H.binary=!0,M="",H.compression="STORE",C="string");var E=null;E=M instanceof l||M instanceof a?M:_.isNode&&_.isStream(M)?new m(S,M):o.prepareContent(S,M,H.binary,H.optimizedBinaryString,H.base64);var F=new f(S,E,H);this.files[S]=F}var r=t("./utf8"),o=t("./utils"),a=t("./stream/GenericWorker"),c=t("./stream/StreamHelper"),h=t("./defaults"),l=t("./compressedObject"),f=t("./zipObject"),u=t("./generate"),_=t("./nodejsUtils"),m=t("./nodejs/NodejsStreamInputAdapter"),g=function(S){S.slice(-1)==="/"&&(S=S.substring(0,S.length-1));var M=S.lastIndexOf("/");return 0<M?S.substring(0,M):""},w=function(S){return S.slice(-1)!=="/"&&(S+="/"),S},b=function(S,M){return M=M!==void 0?M:h.createFolders,S=w(S),this.files[S]||s.call(this,S,null,{dir:!0,createFolders:M}),this.files[S]};function v(S){return Object.prototype.toString.call(S)==="[object RegExp]"}var T={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(S){var M,P,z;for(M in this.files)z=this.files[M],(P=M.slice(this.root.length,M.length))&&M.slice(0,this.root.length)===this.root&&S(P,z)},filter:function(S){var M=[];return this.forEach(function(P,z){S(P,z)&&M.push(z)}),M},file:function(S,M,P){if(arguments.length!==1)return S=this.root+S,s.call(this,S,M,P),this;if(v(S)){var z=S;return this.filter(function(H,K){return!K.dir&&z.test(H)})}var C=this.files[this.root+S];return C&&!C.dir?C:null},folder:function(S){if(!S)return this;if(v(S))return this.filter(function(C,H){return H.dir&&S.test(C)});var M=this.root+S,P=b.call(this,M),z=this.clone();return z.root=P.name,z},remove:function(S){S=this.root+S;var M=this.files[S];if(M||(S.slice(-1)!=="/"&&(S+="/"),M=this.files[S]),M&&!M.dir)delete this.files[S];else for(var P=this.filter(function(C,H){return H.name.slice(0,S.length)===S}),z=0;z<P.length;z++)delete this.files[P[z].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(S){var M,P={};try{if((P=o.extend(S||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=P.type.toLowerCase(),P.compression=P.compression.toUpperCase(),P.type==="binarystring"&&(P.type="string"),!P.type)throw new Error("No output type specified.");o.checkSupport(P.type),P.platform!=="darwin"&&P.platform!=="freebsd"&&P.platform!=="linux"&&P.platform!=="sunos"||(P.platform="UNIX"),P.platform==="win32"&&(P.platform="DOS");var z=P.comment||this.comment||"";M=u.generateWorker(this,P,z)}catch(C){(M=new a("error")).error(C)}return new c(M,P.type||"string",P.mimeType)},generateAsync:function(S,M){return this.generateInternalStream(S).accumulate(M)},generateNodeStream:function(S,M){return(S=S||{}).type||(S.type="nodebuffer"),this.generateInternalStream(S).toNodejsStream(M)}};i.exports=T},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,i,n){i.exports=t("stream")},{stream:void 0}],17:[function(t,i,n){var s=t("./DataReader");function r(o){s.call(this,o);for(var a=0;a<this.data.length;a++)o[a]=255&o[a]}t("../utils").inherits(r,s),r.prototype.byteAt=function(o){return this.data[this.zero+o]},r.prototype.lastIndexOfSignature=function(o){for(var a=o.charCodeAt(0),c=o.charCodeAt(1),h=o.charCodeAt(2),l=o.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===a&&this.data[f+1]===c&&this.data[f+2]===h&&this.data[f+3]===l)return f-this.zero;return-1},r.prototype.readAndCheckSignature=function(o){var a=o.charCodeAt(0),c=o.charCodeAt(1),h=o.charCodeAt(2),l=o.charCodeAt(3),f=this.readData(4);return a===f[0]&&c===f[1]&&h===f[2]&&l===f[3]},r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},i.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,i,n){var s=t("../utils");function r(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var a,c=0;for(this.checkOffset(o),a=this.index+o-1;a>=this.index;a--)c=(c<<8)+this.byteAt(a);return this.index+=o,c},readString:function(o){return s.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},i.exports=r},{"../utils":32}],19:[function(t,i,n){var s=t("./Uint8ArrayReader");function r(o){s.call(this,o)}t("../utils").inherits(r,s),r.prototype.readData=function(o){this.checkOffset(o);var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},i.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,i,n){var s=t("./DataReader");function r(o){s.call(this,o)}t("../utils").inherits(r,s),r.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},r.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},r.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},r.prototype.readData=function(o){this.checkOffset(o);var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},i.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,i,n){var s=t("./ArrayReader");function r(o){s.call(this,o)}t("../utils").inherits(r,s),r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var a=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},i.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,i,n){var s=t("../utils"),r=t("../support"),o=t("./ArrayReader"),a=t("./StringReader"),c=t("./NodeBufferReader"),h=t("./Uint8ArrayReader");i.exports=function(l){var f=s.getTypeOf(l);return s.checkSupport(f),f!=="string"||r.uint8array?f==="nodebuffer"?new c(l):r.uint8array?new h(s.transformTo("uint8array",l)):new o(s.transformTo("array",l)):new a(l)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,i,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,i,n){var s=t("./GenericWorker"),r=t("../utils");function o(a){s.call(this,"ConvertWorker to "+a),this.destType=a}r.inherits(o,s),o.prototype.processChunk=function(a){this.push({data:r.transformTo(this.destType,a.data),meta:a.meta})},i.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,i,n){var s=t("./GenericWorker"),r=t("../crc32");function o(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,s),o.prototype.processChunk=function(a){this.streamInfo.crc32=r(a.data,this.streamInfo.crc32||0),this.push(a)},i.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,i,n){var s=t("../utils"),r=t("./GenericWorker");function o(a){r.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}s.inherits(o,r),o.prototype.processChunk=function(a){if(a){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+a.data.length}r.prototype.processChunk.call(this,a)},i.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,i,n){var s=t("../utils"),r=t("./GenericWorker");function o(a){r.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(h){c.dataIsReady=!0,c.data=h,c.max=h&&h.length||0,c.type=s.getTypeOf(h),c.isPaused||c._tickAndRepeat()},function(h){c.error(h)})}s.inherits(o,r),o.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":a=this.data.substring(this.index,c);break;case"uint8array":a=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":a=this.data.slice(this.index,c)}return this.index=c,this.push({data:a,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,i,n){function s(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,o){return this._listeners[r].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,o){if(this._listeners[r])for(var a=0;a<this._listeners[r].length;a++)this._listeners[r][a].call(this,o)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var o=this;return r.on("data",function(a){o.processChunk(a)}),r.on("end",function(){o.end()}),r.on("error",function(a){o.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,o){return this.extraStreamInfo[r]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},i.exports=s},{}],29:[function(t,i,n){var s=t("../utils"),r=t("./ConvertWorker"),o=t("./GenericWorker"),a=t("../base64"),c=t("../support"),h=t("../external"),l=null;if(c.nodestream)try{l=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(_,m){return new h.Promise(function(g,w){var b=[],v=_._internalType,T=_._outputType,S=_._mimeType;_.on("data",function(M,P){b.push(M),m&&m(P)}).on("error",function(M){b=[],w(M)}).on("end",function(){try{var M=(function(P,z,C){switch(P){case"blob":return s.newBlob(s.transformTo("arraybuffer",z),C);case"base64":return a.encode(z);default:return s.transformTo(P,z)}})(T,(function(P,z){var C,H=0,K=null,E=0;for(C=0;C<z.length;C++)E+=z[C].length;switch(P){case"string":return z.join("");case"array":return Array.prototype.concat.apply([],z);case"uint8array":for(K=new Uint8Array(E),C=0;C<z.length;C++)K.set(z[C],H),H+=z[C].length;return K;case"nodebuffer":return Buffer.concat(z);default:throw new Error("concat : unsupported type '"+P+"'")}})(v,b),S);g(M)}catch(P){w(P)}b=[]}).resume()})}function u(_,m,g){var w=m;switch(m){case"blob":case"arraybuffer":w="uint8array";break;case"base64":w="string"}try{this._internalType=w,this._outputType=m,this._mimeType=g,s.checkSupport(w),this._worker=_.pipe(new r(w)),_.lock()}catch(b){this._worker=new o("error"),this._worker.error(b)}}u.prototype={accumulate:function(_){return f(this,_)},on:function(_,m){var g=this;return _==="data"?this._worker.on(_,function(w){m.call(g,w.data,w.meta)}):this._worker.on(_,function(){s.delay(m,arguments,g)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(_){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new l(this,{objectMode:this._outputType!=="nodebuffer"},_)}},i.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,i,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var s=new ArrayBuffer(0);try{n.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(s),n.blob=r.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!t("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(t,i,n){for(var s=t("./utils"),r=t("./support"),o=t("./nodejsUtils"),a=t("./stream/GenericWorker"),c=new Array(256),h=0;h<256;h++)c[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;c[254]=c[254]=1;function l(){a.call(this,"utf-8 decode"),this.leftOver=null}function f(){a.call(this,"utf-8 encode")}n.utf8encode=function(u){return r.nodebuffer?o.newBufferFrom(u,"utf-8"):(function(_){var m,g,w,b,v,T=_.length,S=0;for(b=0;b<T;b++)(64512&(g=_.charCodeAt(b)))==55296&&b+1<T&&(64512&(w=_.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(w-56320),b++),S+=g<128?1:g<2048?2:g<65536?3:4;for(m=r.uint8array?new Uint8Array(S):new Array(S),b=v=0;v<S;b++)(64512&(g=_.charCodeAt(b)))==55296&&b+1<T&&(64512&(w=_.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(w-56320),b++),g<128?m[v++]=g:(g<2048?m[v++]=192|g>>>6:(g<65536?m[v++]=224|g>>>12:(m[v++]=240|g>>>18,m[v++]=128|g>>>12&63),m[v++]=128|g>>>6&63),m[v++]=128|63&g);return m})(u)},n.utf8decode=function(u){return r.nodebuffer?s.transformTo("nodebuffer",u).toString("utf-8"):(function(_){var m,g,w,b,v=_.length,T=new Array(2*v);for(m=g=0;m<v;)if((w=_[m++])<128)T[g++]=w;else if(4<(b=c[w]))T[g++]=65533,m+=b-1;else{for(w&=b===2?31:b===3?15:7;1<b&&m<v;)w=w<<6|63&_[m++],b--;1<b?T[g++]=65533:w<65536?T[g++]=w:(w-=65536,T[g++]=55296|w>>10&1023,T[g++]=56320|1023&w)}return T.length!==g&&(T.subarray?T=T.subarray(0,g):T.length=g),s.applyFromCharCode(T)})(u=s.transformTo(r.uint8array?"uint8array":"array",u))},s.inherits(l,a),l.prototype.processChunk=function(u){var _=s.transformTo(r.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var m=_;(_=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),_.set(m,this.leftOver.length)}else _=this.leftOver.concat(_);this.leftOver=null}var g=(function(b,v){var T;for((v=v||b.length)>b.length&&(v=b.length),T=v-1;0<=T&&(192&b[T])==128;)T--;return T<0||T===0?v:T+c[b[T]]>v?T:v})(_),w=_;g!==_.length&&(r.uint8array?(w=_.subarray(0,g),this.leftOver=_.subarray(g,_.length)):(w=_.slice(0,g),this.leftOver=_.slice(g,_.length))),this.push({data:n.utf8decode(w),meta:u.meta})},l.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=l,s.inherits(f,a),f.prototype.processChunk=function(u){this.push({data:n.utf8encode(u.data),meta:u.meta})},n.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,i,n){var s=t("./support"),r=t("./base64"),o=t("./nodejsUtils"),a=t("./external");function c(m){return m}function h(m,g){for(var w=0;w<m.length;++w)g[w]=255&m.charCodeAt(w);return g}t("setimmediate"),n.newBlob=function(m,g){n.checkSupport("blob");try{return new Blob([m],{type:g})}catch{try{var w=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return w.append(m),w.getBlob(g)}catch{throw new Error("Bug : can't construct the Blob.")}}};var l={stringifyByChunk:function(m,g,w){var b=[],v=0,T=m.length;if(T<=w)return String.fromCharCode.apply(null,m);for(;v<T;)g==="array"||g==="nodebuffer"?b.push(String.fromCharCode.apply(null,m.slice(v,Math.min(v+w,T)))):b.push(String.fromCharCode.apply(null,m.subarray(v,Math.min(v+w,T)))),v+=w;return b.join("")},stringifyByChar:function(m){for(var g="",w=0;w<m.length;w++)g+=String.fromCharCode(m[w]);return g},applyCanBeUsed:{uint8array:(function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}})()}};function f(m){var g=65536,w=n.getTypeOf(m),b=!0;if(w==="uint8array"?b=l.applyCanBeUsed.uint8array:w==="nodebuffer"&&(b=l.applyCanBeUsed.nodebuffer),b)for(;1<g;)try{return l.stringifyByChunk(m,w,g)}catch{g=Math.floor(g/2)}return l.stringifyByChar(m)}function u(m,g){for(var w=0;w<m.length;w++)g[w]=m[w];return g}n.applyFromCharCode=f;var _={};_.string={string:c,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return _.string.uint8array(m).buffer},uint8array:function(m){return h(m,new Uint8Array(m.length))},nodebuffer:function(m){return h(m,o.allocBuffer(m.length))}},_.array={string:f,array:c,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return o.newBufferFrom(m)}},_.arraybuffer={string:function(m){return f(new Uint8Array(m))},array:function(m){return u(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:c,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return o.newBufferFrom(new Uint8Array(m))}},_.uint8array={string:f,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:c,nodebuffer:function(m){return o.newBufferFrom(m)}},_.nodebuffer={string:f,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return _.nodebuffer.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:c},n.transformTo=function(m,g){if(g=g||"",!m)return g;n.checkSupport(m);var w=n.getTypeOf(g);return _[w][m](g)},n.resolve=function(m){for(var g=m.split("/"),w=[],b=0;b<g.length;b++){var v=g[b];v==="."||v===""&&b!==0&&b!==g.length-1||(v===".."?w.pop():w.push(v))}return w.join("/")},n.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&o.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(m){var g,w,b="";for(w=0;w<(m||"").length;w++)b+="\\x"+((g=m.charCodeAt(w))<16?"0":"")+g.toString(16).toUpperCase();return b},n.delay=function(m,g,w){setImmediate(function(){m.apply(w||null,g||[])})},n.inherits=function(m,g){function w(){}w.prototype=g.prototype,m.prototype=new w},n.extend=function(){var m,g,w={};for(m=0;m<arguments.length;m++)for(g in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],g)&&w[g]===void 0&&(w[g]=arguments[m][g]);return w},n.prepareContent=function(m,g,w,b,v){return a.Promise.resolve(g).then(function(T){return s.blob&&(T instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(T))!==-1)&&typeof FileReader<"u"?new a.Promise(function(S,M){var P=new FileReader;P.onload=function(z){S(z.target.result)},P.onerror=function(z){M(z.target.error)},P.readAsArrayBuffer(T)}):T}).then(function(T){var S=n.getTypeOf(T);return S?(S==="arraybuffer"?T=n.transformTo("uint8array",T):S==="string"&&(v?T=r.decode(T):w&&b!==!0&&(T=(function(M){return h(M,s.uint8array?new Uint8Array(M.length):new Array(M.length))})(T))),T):a.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,i,n){var s=t("./reader/readerFor"),r=t("./utils"),o=t("./signature"),a=t("./zipEntry"),c=t("./support");function h(l){this.files=[],this.loadOptions=l}h.prototype={checkSignature:function(l){if(!this.reader.readAndCheckSignature(l)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(f)+", expected "+r.pretty(l)+")")}},isSignature:function(l,f){var u=this.reader.index;this.reader.setIndex(l);var _=this.reader.readString(4)===f;return this.reader.setIndex(u),_},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var l=this.reader.readData(this.zipCommentLength),f=c.uint8array?"uint8array":"array",u=r.transformTo(f,l);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var l,f,u,_=this.zip64EndOfCentralSize-44;0<_;)l=this.reader.readInt(2),f=this.reader.readInt(4),u=this.reader.readData(f),this.zip64ExtensibleData[l]={id:l,length:f,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var l,f;for(l=0;l<this.files.length;l++)f=this.files[l],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var l;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(l=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(l);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var l=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(l<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(l);var f=l;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(l=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(l),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var _=f-u;if(0<_)this.isSignature(f,o.CENTRAL_FILE_HEADER)||(this.reader.zero=_);else if(_<0)throw new Error("Corrupted zip: missing "+Math.abs(_)+" bytes.")},prepareReader:function(l){this.reader=s(l)},load:function(l){this.prepareReader(l),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,i,n){var s=t("./reader/readerFor"),r=t("./utils"),o=t("./compressedObject"),a=t("./crc32"),c=t("./utf8"),h=t("./compressions"),l=t("./support");function f(u,_){this.options=u,this.loadOptions=_}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var _,m;if(u.skip(22),this.fileNameLength=u.readInt(2),m=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((_=(function(g){for(var w in h)if(Object.prototype.hasOwnProperty.call(h,w)&&h[w].magic===g)return h[w];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,_,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var _=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(_),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=s(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var _,m,g,w=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<w;)_=u.readInt(2),m=u.readInt(2),g=u.readData(m),this.extraFields[_]={id:_,length:m,value:g};u.setIndex(w)},handleUTF8:function(){var u=l.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var _=this.findExtraFieldUnicodePath();if(_!==null)this.fileNameStr=_;else{var m=r.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var w=r.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(w)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var _=s(u.value);return _.readInt(1)!==1||a(this.fileName)!==_.readInt(4)?null:c.utf8decode(_.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var _=s(u.value);return _.readInt(1)!==1||a(this.fileComment)!==_.readInt(4)?null:c.utf8decode(_.readData(u.length-5))}return null}},i.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,i,n){function s(_,m,g){this.name=_,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=m,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}}var r=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),a=t("./utf8"),c=t("./compressedObject"),h=t("./stream/GenericWorker");s.prototype={internalStream:function(_){var m=null,g="string";try{if(!_)throw new Error("No output type specified.");var w=(g=_.toLowerCase())==="string"||g==="text";g!=="binarystring"&&g!=="text"||(g="string"),m=this._decompressWorker();var b=!this._dataBinary;b&&!w&&(m=m.pipe(new a.Utf8EncodeWorker)),!b&&w&&(m=m.pipe(new a.Utf8DecodeWorker))}catch(v){(m=new h("error")).error(v)}return new r(m,g,"")},async:function(_,m){return this.internalStream(_).accumulate(m)},nodeStream:function(_,m){return this.internalStream(_||"nodebuffer").toNodejsStream(m)},_compressWorker:function(_,m){if(this._data instanceof c&&this._data.compression.magic===_.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new a.Utf8EncodeWorker)),c.createWorkerFrom(g,_,m)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof h?this._data:new o(this._data)}};for(var l=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<l.length;u++)s.prototype[l[u]]=f;i.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,i,n){(function(s){var r,o,a=s.MutationObserver||s.WebKitMutationObserver;if(a){var c=0,h=new a(_),l=s.document.createTextNode("");h.observe(l,{characterData:!0}),r=function(){l.data=c=++c%2}}else if(s.setImmediate||s.MessageChannel===void 0)r="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){_(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(_,0)};else{var f=new s.MessageChannel;f.port1.onmessage=_,r=function(){f.port2.postMessage(0)}}var u=[];function _(){var m,g;o=!0;for(var w=u.length;w;){for(g=u,u=[],m=-1;++m<w;)g[m]();w=u.length}o=!1}i.exports=function(m){u.push(m)!==1||o||r()}}).call(this,typeof Kt<"u"?Kt:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,i,n){var s=t("immediate");function r(){}var o={},a=["REJECTED"],c=["FULFILLED"],h=["PENDING"];function l(w){if(typeof w!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,w!==r&&m(this,w)}function f(w,b,v){this.promise=w,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function u(w,b,v){s(function(){var T;try{T=b(v)}catch(S){return o.reject(w,S)}T===w?o.reject(w,new TypeError("Cannot resolve promise with itself")):o.resolve(w,T)})}function _(w){var b=w&&w.then;if(w&&(typeof w=="object"||typeof w=="function")&&typeof b=="function")return function(){b.apply(w,arguments)}}function m(w,b){var v=!1;function T(P){v||(v=!0,o.reject(w,P))}function S(P){v||(v=!0,o.resolve(w,P))}var M=g(function(){b(S,T)});M.status==="error"&&T(M.value)}function g(w,b){var v={};try{v.value=w(b),v.status="success"}catch(T){v.status="error",v.value=T}return v}(i.exports=l).prototype.finally=function(w){if(typeof w!="function")return this;var b=this.constructor;return this.then(function(v){return b.resolve(w()).then(function(){return v})},function(v){return b.resolve(w()).then(function(){throw v})})},l.prototype.catch=function(w){return this.then(null,w)},l.prototype.then=function(w,b){if(typeof w!="function"&&this.state===c||typeof b!="function"&&this.state===a)return this;var v=new this.constructor(r);return this.state!==h?u(v,this.state===c?w:b,this.outcome):this.queue.push(new f(v,w,b)),v},f.prototype.callFulfilled=function(w){o.resolve(this.promise,w)},f.prototype.otherCallFulfilled=function(w){u(this.promise,this.onFulfilled,w)},f.prototype.callRejected=function(w){o.reject(this.promise,w)},f.prototype.otherCallRejected=function(w){u(this.promise,this.onRejected,w)},o.resolve=function(w,b){var v=g(_,b);if(v.status==="error")return o.reject(w,v.value);var T=v.value;if(T)m(w,T);else{w.state=c,w.outcome=b;for(var S=-1,M=w.queue.length;++S<M;)w.queue[S].callFulfilled(b)}return w},o.reject=function(w,b){w.state=a,w.outcome=b;for(var v=-1,T=w.queue.length;++v<T;)w.queue[v].callRejected(b);return w},l.resolve=function(w){return w instanceof this?w:o.resolve(new this(r),w)},l.reject=function(w){var b=new this(r);return o.reject(b,w)},l.all=function(w){var b=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=w.length,T=!1;if(!v)return this.resolve([]);for(var S=new Array(v),M=0,P=-1,z=new this(r);++P<v;)C(w[P],P);return z;function C(H,K){b.resolve(H).then(function(E){S[K]=E,++M!==v||T||(T=!0,o.resolve(z,S))},function(E){T||(T=!0,o.reject(z,E))})}},l.race=function(w){var b=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=w.length,T=!1;if(!v)return this.resolve([]);for(var S=-1,M=new this(r);++S<v;)P=w[S],b.resolve(P).then(function(z){T||(T=!0,o.resolve(M,z))},function(z){T||(T=!0,o.reject(M,z))});var P;return M}},{immediate:36}],38:[function(t,i,n){var s={};(0,t("./lib/utils/common").assign)(s,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),i.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,i,n){var s=t("./zlib/deflate"),r=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/messages"),c=t("./zlib/zstream"),h=Object.prototype.toString,l=0,f=-1,u=0,_=8;function m(w){if(!(this instanceof m))return new m(w);this.options=r.assign({level:f,method:_,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},w||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var v=s.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(v!==l)throw new Error(a[v]);if(b.header&&s.deflateSetHeader(this.strm,b.header),b.dictionary){var T;if(T=typeof b.dictionary=="string"?o.string2buf(b.dictionary):h.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(v=s.deflateSetDictionary(this.strm,T))!==l)throw new Error(a[v]);this._dict_set=!0}}function g(w,b){var v=new m(b);if(v.push(w,!0),v.err)throw v.msg||a[v.err];return v.result}m.prototype.push=function(w,b){var v,T,S=this.strm,M=this.options.chunkSize;if(this.ended)return!1;T=b===~~b?b:b===!0?4:0,typeof w=="string"?S.input=o.string2buf(w):h.call(w)==="[object ArrayBuffer]"?S.input=new Uint8Array(w):S.input=w,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new r.Buf8(M),S.next_out=0,S.avail_out=M),(v=s.deflate(S,T))!==1&&v!==l)return this.onEnd(v),!(this.ended=!0);S.avail_out!==0&&(S.avail_in!==0||T!==4&&T!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(r.shrinkBuf(S.output,S.next_out))):this.onData(r.shrinkBuf(S.output,S.next_out)))}while((0<S.avail_in||S.avail_out===0)&&v!==1);return T===4?(v=s.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===l):T!==2||(this.onEnd(l),!(S.avail_out=0))},m.prototype.onData=function(w){this.chunks.push(w)},m.prototype.onEnd=function(w){w===l&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},n.Deflate=m,n.deflate=g,n.deflateRaw=function(w,b){return(b=b||{}).raw=!0,g(w,b)},n.gzip=function(w,b){return(b=b||{}).gzip=!0,g(w,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,i,n){var s=t("./zlib/inflate"),r=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/constants"),c=t("./zlib/messages"),h=t("./zlib/zstream"),l=t("./zlib/gzheader"),f=Object.prototype.toString;function u(m){if(!(this instanceof u))return new u(m);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},m||{});var g=this.options;g.raw&&0<=g.windowBits&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(0<=g.windowBits&&g.windowBits<16)||m&&m.windowBits||(g.windowBits+=32),15<g.windowBits&&g.windowBits<48&&(15&g.windowBits)==0&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var w=s.inflateInit2(this.strm,g.windowBits);if(w!==a.Z_OK)throw new Error(c[w]);this.header=new l,s.inflateGetHeader(this.strm,this.header)}function _(m,g){var w=new u(g);if(w.push(m,!0),w.err)throw w.msg||c[w.err];return w.result}u.prototype.push=function(m,g){var w,b,v,T,S,M,P=this.strm,z=this.options.chunkSize,C=this.options.dictionary,H=!1;if(this.ended)return!1;b=g===~~g?g:g===!0?a.Z_FINISH:a.Z_NO_FLUSH,typeof m=="string"?P.input=o.binstring2buf(m):f.call(m)==="[object ArrayBuffer]"?P.input=new Uint8Array(m):P.input=m,P.next_in=0,P.avail_in=P.input.length;do{if(P.avail_out===0&&(P.output=new r.Buf8(z),P.next_out=0,P.avail_out=z),(w=s.inflate(P,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&C&&(M=typeof C=="string"?o.string2buf(C):f.call(C)==="[object ArrayBuffer]"?new Uint8Array(C):C,w=s.inflateSetDictionary(this.strm,M)),w===a.Z_BUF_ERROR&&H===!0&&(w=a.Z_OK,H=!1),w!==a.Z_STREAM_END&&w!==a.Z_OK)return this.onEnd(w),!(this.ended=!0);P.next_out&&(P.avail_out!==0&&w!==a.Z_STREAM_END&&(P.avail_in!==0||b!==a.Z_FINISH&&b!==a.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=o.utf8border(P.output,P.next_out),T=P.next_out-v,S=o.buf2string(P.output,v),P.next_out=T,P.avail_out=z-T,T&&r.arraySet(P.output,P.output,v,T,0),this.onData(S)):this.onData(r.shrinkBuf(P.output,P.next_out)))),P.avail_in===0&&P.avail_out===0&&(H=!0)}while((0<P.avail_in||P.avail_out===0)&&w!==a.Z_STREAM_END);return w===a.Z_STREAM_END&&(b=a.Z_FINISH),b===a.Z_FINISH?(w=s.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===a.Z_OK):b!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(P.avail_out=0))},u.prototype.onData=function(m){this.chunks.push(m)},u.prototype.onEnd=function(m){m===a.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},n.Inflate=u,n.inflate=_,n.inflateRaw=function(m,g){return(g=g||{}).raw=!0,_(m,g)},n.ungzip=_},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,i,n){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(a){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var h=c.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var l in h)h.hasOwnProperty(l)&&(a[l]=h[l])}}return a},n.shrinkBuf=function(a,c){return a.length===c?a:a.subarray?a.subarray(0,c):(a.length=c,a)};var r={arraySet:function(a,c,h,l,f){if(c.subarray&&a.subarray)a.set(c.subarray(h,h+l),f);else for(var u=0;u<l;u++)a[f+u]=c[h+u]},flattenChunks:function(a){var c,h,l,f,u,_;for(c=l=0,h=a.length;c<h;c++)l+=a[c].length;for(_=new Uint8Array(l),c=f=0,h=a.length;c<h;c++)u=a[c],_.set(u,f),f+=u.length;return _}},o={arraySet:function(a,c,h,l,f){for(var u=0;u<l;u++)a[f+u]=c[h+u]},flattenChunks:function(a){return[].concat.apply([],a)}};n.setTyped=function(a){a?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,o))},n.setTyped(s)},{}],42:[function(t,i,n){var s=t("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var a=new s.Buf8(256),c=0;c<256;c++)a[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function h(l,f){if(f<65537&&(l.subarray&&o||!l.subarray&&r))return String.fromCharCode.apply(null,s.shrinkBuf(l,f));for(var u="",_=0;_<f;_++)u+=String.fromCharCode(l[_]);return u}a[254]=a[254]=1,n.string2buf=function(l){var f,u,_,m,g,w=l.length,b=0;for(m=0;m<w;m++)(64512&(u=l.charCodeAt(m)))==55296&&m+1<w&&(64512&(_=l.charCodeAt(m+1)))==56320&&(u=65536+(u-55296<<10)+(_-56320),m++),b+=u<128?1:u<2048?2:u<65536?3:4;for(f=new s.Buf8(b),m=g=0;g<b;m++)(64512&(u=l.charCodeAt(m)))==55296&&m+1<w&&(64512&(_=l.charCodeAt(m+1)))==56320&&(u=65536+(u-55296<<10)+(_-56320),m++),u<128?f[g++]=u:(u<2048?f[g++]=192|u>>>6:(u<65536?f[g++]=224|u>>>12:(f[g++]=240|u>>>18,f[g++]=128|u>>>12&63),f[g++]=128|u>>>6&63),f[g++]=128|63&u);return f},n.buf2binstring=function(l){return h(l,l.length)},n.binstring2buf=function(l){for(var f=new s.Buf8(l.length),u=0,_=f.length;u<_;u++)f[u]=l.charCodeAt(u);return f},n.buf2string=function(l,f){var u,_,m,g,w=f||l.length,b=new Array(2*w);for(u=_=0;u<w;)if((m=l[u++])<128)b[_++]=m;else if(4<(g=a[m]))b[_++]=65533,u+=g-1;else{for(m&=g===2?31:g===3?15:7;1<g&&u<w;)m=m<<6|63&l[u++],g--;1<g?b[_++]=65533:m<65536?b[_++]=m:(m-=65536,b[_++]=55296|m>>10&1023,b[_++]=56320|1023&m)}return h(b,_)},n.utf8border=function(l,f){var u;for((f=f||l.length)>l.length&&(f=l.length),u=f-1;0<=u&&(192&l[u])==128;)u--;return u<0||u===0?f:u+a[l[u]]>f?u:f}},{"./common":41}],43:[function(t,i,n){i.exports=function(s,r,o,a){for(var c=65535&s|0,h=s>>>16&65535|0,l=0;o!==0;){for(o-=l=2e3<o?2e3:o;h=h+(c=c+r[a++]|0)|0,--l;);c%=65521,h%=65521}return c|h<<16|0}},{}],44:[function(t,i,n){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,i,n){var s=(function(){for(var r,o=[],a=0;a<256;a++){r=a;for(var c=0;c<8;c++)r=1&r?3988292384^r>>>1:r>>>1;o[a]=r}return o})();i.exports=function(r,o,a,c){var h=s,l=c+a;r^=-1;for(var f=c;f<l;f++)r=r>>>8^h[255&(r^o[f])];return-1^r}},{}],46:[function(t,i,n){var s,r=t("../utils/common"),o=t("./trees"),a=t("./adler32"),c=t("./crc32"),h=t("./messages"),l=0,f=4,u=0,_=-2,m=-1,g=4,w=2,b=8,v=9,T=286,S=30,M=19,P=2*T+1,z=15,C=3,H=258,K=H+C+1,E=42,F=113,y=1,O=2,$=3,U=4;function ne(d,B){return d.msg=h[B],B}function N(d){return(d<<1)-(4<d?9:0)}function ee(d){for(var B=d.length;0<=--B;)d[B]=0}function L(d){var B=d.state,D=B.pending;D>d.avail_out&&(D=d.avail_out),D!==0&&(r.arraySet(d.output,B.pending_buf,B.pending_out,D,d.next_out),d.next_out+=D,B.pending_out+=D,d.total_out+=D,d.avail_out-=D,B.pending-=D,B.pending===0&&(B.pending_out=0))}function I(d,B){o._tr_flush_block(d,0<=d.block_start?d.block_start:-1,d.strstart-d.block_start,B),d.block_start=d.strstart,L(d.strm)}function Q(d,B){d.pending_buf[d.pending++]=B}function Y(d,B){d.pending_buf[d.pending++]=B>>>8&255,d.pending_buf[d.pending++]=255&B}function Z(d,B){var D,x,A=d.max_chain_length,k=d.strstart,j=d.prev_length,G=d.nice_match,R=d.strstart>d.w_size-K?d.strstart-(d.w_size-K):0,X=d.window,V=d.w_mask,W=d.prev,te=d.strstart+H,ue=X[k+j-1],oe=X[k+j];d.prev_length>=d.good_match&&(A>>=2),G>d.lookahead&&(G=d.lookahead);do if(X[(D=B)+j]===oe&&X[D+j-1]===ue&&X[D]===X[k]&&X[++D]===X[k+1]){k+=2,D++;do;while(X[++k]===X[++D]&&X[++k]===X[++D]&&X[++k]===X[++D]&&X[++k]===X[++D]&&X[++k]===X[++D]&&X[++k]===X[++D]&&X[++k]===X[++D]&&X[++k]===X[++D]&&k<te);if(x=H-(te-k),k=te-H,j<x){if(d.match_start=B,G<=(j=x))break;ue=X[k+j-1],oe=X[k+j]}}while((B=W[B&V])>R&&--A!=0);return j<=d.lookahead?j:d.lookahead}function fe(d){var B,D,x,A,k,j,G,R,X,V,W=d.w_size;do{if(A=d.window_size-d.lookahead-d.strstart,d.strstart>=W+(W-K)){for(r.arraySet(d.window,d.window,W,W,0),d.match_start-=W,d.strstart-=W,d.block_start-=W,B=D=d.hash_size;x=d.head[--B],d.head[B]=W<=x?x-W:0,--D;);for(B=D=W;x=d.prev[--B],d.prev[B]=W<=x?x-W:0,--D;);A+=W}if(d.strm.avail_in===0)break;if(j=d.strm,G=d.window,R=d.strstart+d.lookahead,X=A,V=void 0,V=j.avail_in,X<V&&(V=X),D=V===0?0:(j.avail_in-=V,r.arraySet(G,j.input,j.next_in,V,R),j.state.wrap===1?j.adler=a(j.adler,G,V,R):j.state.wrap===2&&(j.adler=c(j.adler,G,V,R)),j.next_in+=V,j.total_in+=V,V),d.lookahead+=D,d.lookahead+d.insert>=C)for(k=d.strstart-d.insert,d.ins_h=d.window[k],d.ins_h=(d.ins_h<<d.hash_shift^d.window[k+1])&d.hash_mask;d.insert&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[k+C-1])&d.hash_mask,d.prev[k&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=k,k++,d.insert--,!(d.lookahead+d.insert<C)););}while(d.lookahead<K&&d.strm.avail_in!==0)}function ve(d,B){for(var D,x;;){if(d.lookahead<K){if(fe(d),d.lookahead<K&&B===l)return y;if(d.lookahead===0)break}if(D=0,d.lookahead>=C&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+C-1])&d.hash_mask,D=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),D!==0&&d.strstart-D<=d.w_size-K&&(d.match_length=Z(d,D)),d.match_length>=C)if(x=o._tr_tally(d,d.strstart-d.match_start,d.match_length-C),d.lookahead-=d.match_length,d.match_length<=d.max_lazy_match&&d.lookahead>=C){for(d.match_length--;d.strstart++,d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+C-1])&d.hash_mask,D=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart,--d.match_length!=0;);d.strstart++}else d.strstart+=d.match_length,d.match_length=0,d.ins_h=d.window[d.strstart],d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+1])&d.hash_mask;else x=o._tr_tally(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++;if(x&&(I(d,!1),d.strm.avail_out===0))return y}return d.insert=d.strstart<C-1?d.strstart:C-1,B===f?(I(d,!0),d.strm.avail_out===0?$:U):d.last_lit&&(I(d,!1),d.strm.avail_out===0)?y:O}function ie(d,B){for(var D,x,A;;){if(d.lookahead<K){if(fe(d),d.lookahead<K&&B===l)return y;if(d.lookahead===0)break}if(D=0,d.lookahead>=C&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+C-1])&d.hash_mask,D=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),d.prev_length=d.match_length,d.prev_match=d.match_start,d.match_length=C-1,D!==0&&d.prev_length<d.max_lazy_match&&d.strstart-D<=d.w_size-K&&(d.match_length=Z(d,D),d.match_length<=5&&(d.strategy===1||d.match_length===C&&4096<d.strstart-d.match_start)&&(d.match_length=C-1)),d.prev_length>=C&&d.match_length<=d.prev_length){for(A=d.strstart+d.lookahead-C,x=o._tr_tally(d,d.strstart-1-d.prev_match,d.prev_length-C),d.lookahead-=d.prev_length-1,d.prev_length-=2;++d.strstart<=A&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+C-1])&d.hash_mask,D=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),--d.prev_length!=0;);if(d.match_available=0,d.match_length=C-1,d.strstart++,x&&(I(d,!1),d.strm.avail_out===0))return y}else if(d.match_available){if((x=o._tr_tally(d,0,d.window[d.strstart-1]))&&I(d,!1),d.strstart++,d.lookahead--,d.strm.avail_out===0)return y}else d.match_available=1,d.strstart++,d.lookahead--}return d.match_available&&(x=o._tr_tally(d,0,d.window[d.strstart-1]),d.match_available=0),d.insert=d.strstart<C-1?d.strstart:C-1,B===f?(I(d,!0),d.strm.avail_out===0?$:U):d.last_lit&&(I(d,!1),d.strm.avail_out===0)?y:O}function ae(d,B,D,x,A){this.good_length=d,this.max_lazy=B,this.nice_length=D,this.max_chain=x,this.func=A}function Ae(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*P),this.dyn_dtree=new r.Buf16(2*(2*S+1)),this.bl_tree=new r.Buf16(2*(2*M+1)),ee(this.dyn_ltree),ee(this.dyn_dtree),ee(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(z+1),this.heap=new r.Buf16(2*T+1),ee(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*T+1),ee(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function pe(d){var B;return d&&d.state?(d.total_in=d.total_out=0,d.data_type=w,(B=d.state).pending=0,B.pending_out=0,B.wrap<0&&(B.wrap=-B.wrap),B.status=B.wrap?E:F,d.adler=B.wrap===2?0:1,B.last_flush=l,o._tr_init(B),u):ne(d,_)}function Oe(d){var B=pe(d);return B===u&&(function(D){D.window_size=2*D.w_size,ee(D.head),D.max_lazy_match=s[D.level].max_lazy,D.good_match=s[D.level].good_length,D.nice_match=s[D.level].nice_length,D.max_chain_length=s[D.level].max_chain,D.strstart=0,D.block_start=0,D.lookahead=0,D.insert=0,D.match_length=D.prev_length=C-1,D.match_available=0,D.ins_h=0})(d.state),B}function Ce(d,B,D,x,A,k){if(!d)return _;var j=1;if(B===m&&(B=6),x<0?(j=0,x=-x):15<x&&(j=2,x-=16),A<1||v<A||D!==b||x<8||15<x||B<0||9<B||k<0||g<k)return ne(d,_);x===8&&(x=9);var G=new Ae;return(d.state=G).strm=d,G.wrap=j,G.gzhead=null,G.w_bits=x,G.w_size=1<<G.w_bits,G.w_mask=G.w_size-1,G.hash_bits=A+7,G.hash_size=1<<G.hash_bits,G.hash_mask=G.hash_size-1,G.hash_shift=~~((G.hash_bits+C-1)/C),G.window=new r.Buf8(2*G.w_size),G.head=new r.Buf16(G.hash_size),G.prev=new r.Buf16(G.w_size),G.lit_bufsize=1<<A+6,G.pending_buf_size=4*G.lit_bufsize,G.pending_buf=new r.Buf8(G.pending_buf_size),G.d_buf=1*G.lit_bufsize,G.l_buf=3*G.lit_bufsize,G.level=B,G.strategy=k,G.method=D,Oe(d)}s=[new ae(0,0,0,0,function(d,B){var D=65535;for(D>d.pending_buf_size-5&&(D=d.pending_buf_size-5);;){if(d.lookahead<=1){if(fe(d),d.lookahead===0&&B===l)return y;if(d.lookahead===0)break}d.strstart+=d.lookahead,d.lookahead=0;var x=d.block_start+D;if((d.strstart===0||d.strstart>=x)&&(d.lookahead=d.strstart-x,d.strstart=x,I(d,!1),d.strm.avail_out===0)||d.strstart-d.block_start>=d.w_size-K&&(I(d,!1),d.strm.avail_out===0))return y}return d.insert=0,B===f?(I(d,!0),d.strm.avail_out===0?$:U):(d.strstart>d.block_start&&(I(d,!1),d.strm.avail_out),y)}),new ae(4,4,8,4,ve),new ae(4,5,16,8,ve),new ae(4,6,32,32,ve),new ae(4,4,16,16,ie),new ae(8,16,32,32,ie),new ae(8,16,128,128,ie),new ae(8,32,128,256,ie),new ae(32,128,258,1024,ie),new ae(32,258,258,4096,ie)],n.deflateInit=function(d,B){return Ce(d,B,b,15,8,0)},n.deflateInit2=Ce,n.deflateReset=Oe,n.deflateResetKeep=pe,n.deflateSetHeader=function(d,B){return d&&d.state?d.state.wrap!==2?_:(d.state.gzhead=B,u):_},n.deflate=function(d,B){var D,x,A,k;if(!d||!d.state||5<B||B<0)return d?ne(d,_):_;if(x=d.state,!d.output||!d.input&&d.avail_in!==0||x.status===666&&B!==f)return ne(d,d.avail_out===0?-5:_);if(x.strm=d,D=x.last_flush,x.last_flush=B,x.status===E)if(x.wrap===2)d.adler=0,Q(x,31),Q(x,139),Q(x,8),x.gzhead?(Q(x,(x.gzhead.text?1:0)+(x.gzhead.hcrc?2:0)+(x.gzhead.extra?4:0)+(x.gzhead.name?8:0)+(x.gzhead.comment?16:0)),Q(x,255&x.gzhead.time),Q(x,x.gzhead.time>>8&255),Q(x,x.gzhead.time>>16&255),Q(x,x.gzhead.time>>24&255),Q(x,x.level===9?2:2<=x.strategy||x.level<2?4:0),Q(x,255&x.gzhead.os),x.gzhead.extra&&x.gzhead.extra.length&&(Q(x,255&x.gzhead.extra.length),Q(x,x.gzhead.extra.length>>8&255)),x.gzhead.hcrc&&(d.adler=c(d.adler,x.pending_buf,x.pending,0)),x.gzindex=0,x.status=69):(Q(x,0),Q(x,0),Q(x,0),Q(x,0),Q(x,0),Q(x,x.level===9?2:2<=x.strategy||x.level<2?4:0),Q(x,3),x.status=F);else{var j=b+(x.w_bits-8<<4)<<8;j|=(2<=x.strategy||x.level<2?0:x.level<6?1:x.level===6?2:3)<<6,x.strstart!==0&&(j|=32),j+=31-j%31,x.status=F,Y(x,j),x.strstart!==0&&(Y(x,d.adler>>>16),Y(x,65535&d.adler)),d.adler=1}if(x.status===69)if(x.gzhead.extra){for(A=x.pending;x.gzindex<(65535&x.gzhead.extra.length)&&(x.pending!==x.pending_buf_size||(x.gzhead.hcrc&&x.pending>A&&(d.adler=c(d.adler,x.pending_buf,x.pending-A,A)),L(d),A=x.pending,x.pending!==x.pending_buf_size));)Q(x,255&x.gzhead.extra[x.gzindex]),x.gzindex++;x.gzhead.hcrc&&x.pending>A&&(d.adler=c(d.adler,x.pending_buf,x.pending-A,A)),x.gzindex===x.gzhead.extra.length&&(x.gzindex=0,x.status=73)}else x.status=73;if(x.status===73)if(x.gzhead.name){A=x.pending;do{if(x.pending===x.pending_buf_size&&(x.gzhead.hcrc&&x.pending>A&&(d.adler=c(d.adler,x.pending_buf,x.pending-A,A)),L(d),A=x.pending,x.pending===x.pending_buf_size)){k=1;break}k=x.gzindex<x.gzhead.name.length?255&x.gzhead.name.charCodeAt(x.gzindex++):0,Q(x,k)}while(k!==0);x.gzhead.hcrc&&x.pending>A&&(d.adler=c(d.adler,x.pending_buf,x.pending-A,A)),k===0&&(x.gzindex=0,x.status=91)}else x.status=91;if(x.status===91)if(x.gzhead.comment){A=x.pending;do{if(x.pending===x.pending_buf_size&&(x.gzhead.hcrc&&x.pending>A&&(d.adler=c(d.adler,x.pending_buf,x.pending-A,A)),L(d),A=x.pending,x.pending===x.pending_buf_size)){k=1;break}k=x.gzindex<x.gzhead.comment.length?255&x.gzhead.comment.charCodeAt(x.gzindex++):0,Q(x,k)}while(k!==0);x.gzhead.hcrc&&x.pending>A&&(d.adler=c(d.adler,x.pending_buf,x.pending-A,A)),k===0&&(x.status=103)}else x.status=103;if(x.status===103&&(x.gzhead.hcrc?(x.pending+2>x.pending_buf_size&&L(d),x.pending+2<=x.pending_buf_size&&(Q(x,255&d.adler),Q(x,d.adler>>8&255),d.adler=0,x.status=F)):x.status=F),x.pending!==0){if(L(d),d.avail_out===0)return x.last_flush=-1,u}else if(d.avail_in===0&&N(B)<=N(D)&&B!==f)return ne(d,-5);if(x.status===666&&d.avail_in!==0)return ne(d,-5);if(d.avail_in!==0||x.lookahead!==0||B!==l&&x.status!==666){var G=x.strategy===2?(function(R,X){for(var V;;){if(R.lookahead===0&&(fe(R),R.lookahead===0)){if(X===l)return y;break}if(R.match_length=0,V=o._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++,V&&(I(R,!1),R.strm.avail_out===0))return y}return R.insert=0,X===f?(I(R,!0),R.strm.avail_out===0?$:U):R.last_lit&&(I(R,!1),R.strm.avail_out===0)?y:O})(x,B):x.strategy===3?(function(R,X){for(var V,W,te,ue,oe=R.window;;){if(R.lookahead<=H){if(fe(R),R.lookahead<=H&&X===l)return y;if(R.lookahead===0)break}if(R.match_length=0,R.lookahead>=C&&0<R.strstart&&(W=oe[te=R.strstart-1])===oe[++te]&&W===oe[++te]&&W===oe[++te]){ue=R.strstart+H;do;while(W===oe[++te]&&W===oe[++te]&&W===oe[++te]&&W===oe[++te]&&W===oe[++te]&&W===oe[++te]&&W===oe[++te]&&W===oe[++te]&&te<ue);R.match_length=H-(ue-te),R.match_length>R.lookahead&&(R.match_length=R.lookahead)}if(R.match_length>=C?(V=o._tr_tally(R,1,R.match_length-C),R.lookahead-=R.match_length,R.strstart+=R.match_length,R.match_length=0):(V=o._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++),V&&(I(R,!1),R.strm.avail_out===0))return y}return R.insert=0,X===f?(I(R,!0),R.strm.avail_out===0?$:U):R.last_lit&&(I(R,!1),R.strm.avail_out===0)?y:O})(x,B):s[x.level].func(x,B);if(G!==$&&G!==U||(x.status=666),G===y||G===$)return d.avail_out===0&&(x.last_flush=-1),u;if(G===O&&(B===1?o._tr_align(x):B!==5&&(o._tr_stored_block(x,0,0,!1),B===3&&(ee(x.head),x.lookahead===0&&(x.strstart=0,x.block_start=0,x.insert=0))),L(d),d.avail_out===0))return x.last_flush=-1,u}return B!==f?u:x.wrap<=0?1:(x.wrap===2?(Q(x,255&d.adler),Q(x,d.adler>>8&255),Q(x,d.adler>>16&255),Q(x,d.adler>>24&255),Q(x,255&d.total_in),Q(x,d.total_in>>8&255),Q(x,d.total_in>>16&255),Q(x,d.total_in>>24&255)):(Y(x,d.adler>>>16),Y(x,65535&d.adler)),L(d),0<x.wrap&&(x.wrap=-x.wrap),x.pending!==0?u:1)},n.deflateEnd=function(d){var B;return d&&d.state?(B=d.state.status)!==E&&B!==69&&B!==73&&B!==91&&B!==103&&B!==F&&B!==666?ne(d,_):(d.state=null,B===F?ne(d,-3):u):_},n.deflateSetDictionary=function(d,B){var D,x,A,k,j,G,R,X,V=B.length;if(!d||!d.state||(k=(D=d.state).wrap)===2||k===1&&D.status!==E||D.lookahead)return _;for(k===1&&(d.adler=a(d.adler,B,V,0)),D.wrap=0,V>=D.w_size&&(k===0&&(ee(D.head),D.strstart=0,D.block_start=0,D.insert=0),X=new r.Buf8(D.w_size),r.arraySet(X,B,V-D.w_size,D.w_size,0),B=X,V=D.w_size),j=d.avail_in,G=d.next_in,R=d.input,d.avail_in=V,d.next_in=0,d.input=B,fe(D);D.lookahead>=C;){for(x=D.strstart,A=D.lookahead-(C-1);D.ins_h=(D.ins_h<<D.hash_shift^D.window[x+C-1])&D.hash_mask,D.prev[x&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=x,x++,--A;);D.strstart=x,D.lookahead=C-1,fe(D)}return D.strstart+=D.lookahead,D.block_start=D.strstart,D.insert=D.lookahead,D.lookahead=0,D.match_length=D.prev_length=C-1,D.match_available=0,d.next_in=G,d.input=R,d.avail_in=j,D.wrap=k,u},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,i,n){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,i,n){i.exports=function(s,r){var o,a,c,h,l,f,u,_,m,g,w,b,v,T,S,M,P,z,C,H,K,E,F,y,O;o=s.state,a=s.next_in,y=s.input,c=a+(s.avail_in-5),h=s.next_out,O=s.output,l=h-(r-s.avail_out),f=h+(s.avail_out-257),u=o.dmax,_=o.wsize,m=o.whave,g=o.wnext,w=o.window,b=o.hold,v=o.bits,T=o.lencode,S=o.distcode,M=(1<<o.lenbits)-1,P=(1<<o.distbits)-1;e:do{v<15&&(b+=y[a++]<<v,v+=8,b+=y[a++]<<v,v+=8),z=T[b&M];t:for(;;){if(b>>>=C=z>>>24,v-=C,(C=z>>>16&255)===0)O[h++]=65535&z;else{if(!(16&C)){if((64&C)==0){z=T[(65535&z)+(b&(1<<C)-1)];continue t}if(32&C){o.mode=12;break e}s.msg="invalid literal/length code",o.mode=30;break e}H=65535&z,(C&=15)&&(v<C&&(b+=y[a++]<<v,v+=8),H+=b&(1<<C)-1,b>>>=C,v-=C),v<15&&(b+=y[a++]<<v,v+=8,b+=y[a++]<<v,v+=8),z=S[b&P];n:for(;;){if(b>>>=C=z>>>24,v-=C,!(16&(C=z>>>16&255))){if((64&C)==0){z=S[(65535&z)+(b&(1<<C)-1)];continue n}s.msg="invalid distance code",o.mode=30;break e}if(K=65535&z,v<(C&=15)&&(b+=y[a++]<<v,(v+=8)<C&&(b+=y[a++]<<v,v+=8)),u<(K+=b&(1<<C)-1)){s.msg="invalid distance too far back",o.mode=30;break e}if(b>>>=C,v-=C,(C=h-l)<K){if(m<(C=K-C)&&o.sane){s.msg="invalid distance too far back",o.mode=30;break e}if(F=w,(E=0)===g){if(E+=_-C,C<H){for(H-=C;O[h++]=w[E++],--C;);E=h-K,F=O}}else if(g<C){if(E+=_+g-C,(C-=g)<H){for(H-=C;O[h++]=w[E++],--C;);if(E=0,g<H){for(H-=C=g;O[h++]=w[E++],--C;);E=h-K,F=O}}}else if(E+=g-C,C<H){for(H-=C;O[h++]=w[E++],--C;);E=h-K,F=O}for(;2<H;)O[h++]=F[E++],O[h++]=F[E++],O[h++]=F[E++],H-=3;H&&(O[h++]=F[E++],1<H&&(O[h++]=F[E++]))}else{for(E=h-K;O[h++]=O[E++],O[h++]=O[E++],O[h++]=O[E++],2<(H-=3););H&&(O[h++]=O[E++],1<H&&(O[h++]=O[E++]))}break}}break}}while(a<c&&h<f);a-=H=v>>3,b&=(1<<(v-=H<<3))-1,s.next_in=a,s.next_out=h,s.avail_in=a<c?c-a+5:5-(a-c),s.avail_out=h<f?f-h+257:257-(h-f),o.hold=b,o.bits=v}},{}],49:[function(t,i,n){var s=t("../utils/common"),r=t("./adler32"),o=t("./crc32"),a=t("./inffast"),c=t("./inftrees"),h=1,l=2,f=0,u=-2,_=1,m=852,g=592;function w(E){return(E>>>24&255)+(E>>>8&65280)+((65280&E)<<8)+((255&E)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(E){var F;return E&&E.state?(F=E.state,E.total_in=E.total_out=F.total=0,E.msg="",F.wrap&&(E.adler=1&F.wrap),F.mode=_,F.last=0,F.havedict=0,F.dmax=32768,F.head=null,F.hold=0,F.bits=0,F.lencode=F.lendyn=new s.Buf32(m),F.distcode=F.distdyn=new s.Buf32(g),F.sane=1,F.back=-1,f):u}function T(E){var F;return E&&E.state?((F=E.state).wsize=0,F.whave=0,F.wnext=0,v(E)):u}function S(E,F){var y,O;return E&&E.state?(O=E.state,F<0?(y=0,F=-F):(y=1+(F>>4),F<48&&(F&=15)),F&&(F<8||15<F)?u:(O.window!==null&&O.wbits!==F&&(O.window=null),O.wrap=y,O.wbits=F,T(E))):u}function M(E,F){var y,O;return E?(O=new b,(E.state=O).window=null,(y=S(E,F))!==f&&(E.state=null),y):u}var P,z,C=!0;function H(E){if(C){var F;for(P=new s.Buf32(512),z=new s.Buf32(32),F=0;F<144;)E.lens[F++]=8;for(;F<256;)E.lens[F++]=9;for(;F<280;)E.lens[F++]=7;for(;F<288;)E.lens[F++]=8;for(c(h,E.lens,0,288,P,0,E.work,{bits:9}),F=0;F<32;)E.lens[F++]=5;c(l,E.lens,0,32,z,0,E.work,{bits:5}),C=!1}E.lencode=P,E.lenbits=9,E.distcode=z,E.distbits=5}function K(E,F,y,O){var $,U=E.state;return U.window===null&&(U.wsize=1<<U.wbits,U.wnext=0,U.whave=0,U.window=new s.Buf8(U.wsize)),O>=U.wsize?(s.arraySet(U.window,F,y-U.wsize,U.wsize,0),U.wnext=0,U.whave=U.wsize):(O<($=U.wsize-U.wnext)&&($=O),s.arraySet(U.window,F,y-O,$,U.wnext),(O-=$)?(s.arraySet(U.window,F,y-O,O,0),U.wnext=O,U.whave=U.wsize):(U.wnext+=$,U.wnext===U.wsize&&(U.wnext=0),U.whave<U.wsize&&(U.whave+=$))),0}n.inflateReset=T,n.inflateReset2=S,n.inflateResetKeep=v,n.inflateInit=function(E){return M(E,15)},n.inflateInit2=M,n.inflate=function(E,F){var y,O,$,U,ne,N,ee,L,I,Q,Y,Z,fe,ve,ie,ae,Ae,pe,Oe,Ce,d,B,D,x,A=0,k=new s.Buf8(4),j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!E||!E.state||!E.output||!E.input&&E.avail_in!==0)return u;(y=E.state).mode===12&&(y.mode=13),ne=E.next_out,$=E.output,ee=E.avail_out,U=E.next_in,O=E.input,N=E.avail_in,L=y.hold,I=y.bits,Q=N,Y=ee,B=f;e:for(;;)switch(y.mode){case _:if(y.wrap===0){y.mode=13;break}for(;I<16;){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}if(2&y.wrap&&L===35615){k[y.check=0]=255&L,k[1]=L>>>8&255,y.check=o(y.check,k,2,0),I=L=0,y.mode=2;break}if(y.flags=0,y.head&&(y.head.done=!1),!(1&y.wrap)||(((255&L)<<8)+(L>>8))%31){E.msg="incorrect header check",y.mode=30;break}if((15&L)!=8){E.msg="unknown compression method",y.mode=30;break}if(I-=4,d=8+(15&(L>>>=4)),y.wbits===0)y.wbits=d;else if(d>y.wbits){E.msg="invalid window size",y.mode=30;break}y.dmax=1<<d,E.adler=y.check=1,y.mode=512&L?10:12,I=L=0;break;case 2:for(;I<16;){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}if(y.flags=L,(255&y.flags)!=8){E.msg="unknown compression method",y.mode=30;break}if(57344&y.flags){E.msg="unknown header flags set",y.mode=30;break}y.head&&(y.head.text=L>>8&1),512&y.flags&&(k[0]=255&L,k[1]=L>>>8&255,y.check=o(y.check,k,2,0)),I=L=0,y.mode=3;case 3:for(;I<32;){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}y.head&&(y.head.time=L),512&y.flags&&(k[0]=255&L,k[1]=L>>>8&255,k[2]=L>>>16&255,k[3]=L>>>24&255,y.check=o(y.check,k,4,0)),I=L=0,y.mode=4;case 4:for(;I<16;){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}y.head&&(y.head.xflags=255&L,y.head.os=L>>8),512&y.flags&&(k[0]=255&L,k[1]=L>>>8&255,y.check=o(y.check,k,2,0)),I=L=0,y.mode=5;case 5:if(1024&y.flags){for(;I<16;){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}y.length=L,y.head&&(y.head.extra_len=L),512&y.flags&&(k[0]=255&L,k[1]=L>>>8&255,y.check=o(y.check,k,2,0)),I=L=0}else y.head&&(y.head.extra=null);y.mode=6;case 6:if(1024&y.flags&&(N<(Z=y.length)&&(Z=N),Z&&(y.head&&(d=y.head.extra_len-y.length,y.head.extra||(y.head.extra=new Array(y.head.extra_len)),s.arraySet(y.head.extra,O,U,Z,d)),512&y.flags&&(y.check=o(y.check,O,Z,U)),N-=Z,U+=Z,y.length-=Z),y.length))break e;y.length=0,y.mode=7;case 7:if(2048&y.flags){if(N===0)break e;for(Z=0;d=O[U+Z++],y.head&&d&&y.length<65536&&(y.head.name+=String.fromCharCode(d)),d&&Z<N;);if(512&y.flags&&(y.check=o(y.check,O,Z,U)),N-=Z,U+=Z,d)break e}else y.head&&(y.head.name=null);y.length=0,y.mode=8;case 8:if(4096&y.flags){if(N===0)break e;for(Z=0;d=O[U+Z++],y.head&&d&&y.length<65536&&(y.head.comment+=String.fromCharCode(d)),d&&Z<N;);if(512&y.flags&&(y.check=o(y.check,O,Z,U)),N-=Z,U+=Z,d)break e}else y.head&&(y.head.comment=null);y.mode=9;case 9:if(512&y.flags){for(;I<16;){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}if(L!==(65535&y.check)){E.msg="header crc mismatch",y.mode=30;break}I=L=0}y.head&&(y.head.hcrc=y.flags>>9&1,y.head.done=!0),E.adler=y.check=0,y.mode=12;break;case 10:for(;I<32;){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}E.adler=y.check=w(L),I=L=0,y.mode=11;case 11:if(y.havedict===0)return E.next_out=ne,E.avail_out=ee,E.next_in=U,E.avail_in=N,y.hold=L,y.bits=I,2;E.adler=y.check=1,y.mode=12;case 12:if(F===5||F===6)break e;case 13:if(y.last){L>>>=7&I,I-=7&I,y.mode=27;break}for(;I<3;){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}switch(y.last=1&L,I-=1,3&(L>>>=1)){case 0:y.mode=14;break;case 1:if(H(y),y.mode=20,F!==6)break;L>>>=2,I-=2;break e;case 2:y.mode=17;break;case 3:E.msg="invalid block type",y.mode=30}L>>>=2,I-=2;break;case 14:for(L>>>=7&I,I-=7&I;I<32;){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}if((65535&L)!=(L>>>16^65535)){E.msg="invalid stored block lengths",y.mode=30;break}if(y.length=65535&L,I=L=0,y.mode=15,F===6)break e;case 15:y.mode=16;case 16:if(Z=y.length){if(N<Z&&(Z=N),ee<Z&&(Z=ee),Z===0)break e;s.arraySet($,O,U,Z,ne),N-=Z,U+=Z,ee-=Z,ne+=Z,y.length-=Z;break}y.mode=12;break;case 17:for(;I<14;){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}if(y.nlen=257+(31&L),L>>>=5,I-=5,y.ndist=1+(31&L),L>>>=5,I-=5,y.ncode=4+(15&L),L>>>=4,I-=4,286<y.nlen||30<y.ndist){E.msg="too many length or distance symbols",y.mode=30;break}y.have=0,y.mode=18;case 18:for(;y.have<y.ncode;){for(;I<3;){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}y.lens[j[y.have++]]=7&L,L>>>=3,I-=3}for(;y.have<19;)y.lens[j[y.have++]]=0;if(y.lencode=y.lendyn,y.lenbits=7,D={bits:y.lenbits},B=c(0,y.lens,0,19,y.lencode,0,y.work,D),y.lenbits=D.bits,B){E.msg="invalid code lengths set",y.mode=30;break}y.have=0,y.mode=19;case 19:for(;y.have<y.nlen+y.ndist;){for(;ae=(A=y.lencode[L&(1<<y.lenbits)-1])>>>16&255,Ae=65535&A,!((ie=A>>>24)<=I);){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}if(Ae<16)L>>>=ie,I-=ie,y.lens[y.have++]=Ae;else{if(Ae===16){for(x=ie+2;I<x;){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}if(L>>>=ie,I-=ie,y.have===0){E.msg="invalid bit length repeat",y.mode=30;break}d=y.lens[y.have-1],Z=3+(3&L),L>>>=2,I-=2}else if(Ae===17){for(x=ie+3;I<x;){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}I-=ie,d=0,Z=3+(7&(L>>>=ie)),L>>>=3,I-=3}else{for(x=ie+7;I<x;){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}I-=ie,d=0,Z=11+(127&(L>>>=ie)),L>>>=7,I-=7}if(y.have+Z>y.nlen+y.ndist){E.msg="invalid bit length repeat",y.mode=30;break}for(;Z--;)y.lens[y.have++]=d}}if(y.mode===30)break;if(y.lens[256]===0){E.msg="invalid code -- missing end-of-block",y.mode=30;break}if(y.lenbits=9,D={bits:y.lenbits},B=c(h,y.lens,0,y.nlen,y.lencode,0,y.work,D),y.lenbits=D.bits,B){E.msg="invalid literal/lengths set",y.mode=30;break}if(y.distbits=6,y.distcode=y.distdyn,D={bits:y.distbits},B=c(l,y.lens,y.nlen,y.ndist,y.distcode,0,y.work,D),y.distbits=D.bits,B){E.msg="invalid distances set",y.mode=30;break}if(y.mode=20,F===6)break e;case 20:y.mode=21;case 21:if(6<=N&&258<=ee){E.next_out=ne,E.avail_out=ee,E.next_in=U,E.avail_in=N,y.hold=L,y.bits=I,a(E,Y),ne=E.next_out,$=E.output,ee=E.avail_out,U=E.next_in,O=E.input,N=E.avail_in,L=y.hold,I=y.bits,y.mode===12&&(y.back=-1);break}for(y.back=0;ae=(A=y.lencode[L&(1<<y.lenbits)-1])>>>16&255,Ae=65535&A,!((ie=A>>>24)<=I);){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}if(ae&&(240&ae)==0){for(pe=ie,Oe=ae,Ce=Ae;ae=(A=y.lencode[Ce+((L&(1<<pe+Oe)-1)>>pe)])>>>16&255,Ae=65535&A,!(pe+(ie=A>>>24)<=I);){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}L>>>=pe,I-=pe,y.back+=pe}if(L>>>=ie,I-=ie,y.back+=ie,y.length=Ae,ae===0){y.mode=26;break}if(32&ae){y.back=-1,y.mode=12;break}if(64&ae){E.msg="invalid literal/length code",y.mode=30;break}y.extra=15&ae,y.mode=22;case 22:if(y.extra){for(x=y.extra;I<x;){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}y.length+=L&(1<<y.extra)-1,L>>>=y.extra,I-=y.extra,y.back+=y.extra}y.was=y.length,y.mode=23;case 23:for(;ae=(A=y.distcode[L&(1<<y.distbits)-1])>>>16&255,Ae=65535&A,!((ie=A>>>24)<=I);){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}if((240&ae)==0){for(pe=ie,Oe=ae,Ce=Ae;ae=(A=y.distcode[Ce+((L&(1<<pe+Oe)-1)>>pe)])>>>16&255,Ae=65535&A,!(pe+(ie=A>>>24)<=I);){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}L>>>=pe,I-=pe,y.back+=pe}if(L>>>=ie,I-=ie,y.back+=ie,64&ae){E.msg="invalid distance code",y.mode=30;break}y.offset=Ae,y.extra=15&ae,y.mode=24;case 24:if(y.extra){for(x=y.extra;I<x;){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}y.offset+=L&(1<<y.extra)-1,L>>>=y.extra,I-=y.extra,y.back+=y.extra}if(y.offset>y.dmax){E.msg="invalid distance too far back",y.mode=30;break}y.mode=25;case 25:if(ee===0)break e;if(Z=Y-ee,y.offset>Z){if((Z=y.offset-Z)>y.whave&&y.sane){E.msg="invalid distance too far back",y.mode=30;break}fe=Z>y.wnext?(Z-=y.wnext,y.wsize-Z):y.wnext-Z,Z>y.length&&(Z=y.length),ve=y.window}else ve=$,fe=ne-y.offset,Z=y.length;for(ee<Z&&(Z=ee),ee-=Z,y.length-=Z;$[ne++]=ve[fe++],--Z;);y.length===0&&(y.mode=21);break;case 26:if(ee===0)break e;$[ne++]=y.length,ee--,y.mode=21;break;case 27:if(y.wrap){for(;I<32;){if(N===0)break e;N--,L|=O[U++]<<I,I+=8}if(Y-=ee,E.total_out+=Y,y.total+=Y,Y&&(E.adler=y.check=y.flags?o(y.check,$,Y,ne-Y):r(y.check,$,Y,ne-Y)),Y=ee,(y.flags?L:w(L))!==y.check){E.msg="incorrect data check",y.mode=30;break}I=L=0}y.mode=28;case 28:if(y.wrap&&y.flags){for(;I<32;){if(N===0)break e;N--,L+=O[U++]<<I,I+=8}if(L!==(4294967295&y.total)){E.msg="incorrect length check",y.mode=30;break}I=L=0}y.mode=29;case 29:B=1;break e;case 30:B=-3;break e;case 31:return-4;case 32:default:return u}return E.next_out=ne,E.avail_out=ee,E.next_in=U,E.avail_in=N,y.hold=L,y.bits=I,(y.wsize||Y!==E.avail_out&&y.mode<30&&(y.mode<27||F!==4))&&K(E,E.output,E.next_out,Y-E.avail_out)?(y.mode=31,-4):(Q-=E.avail_in,Y-=E.avail_out,E.total_in+=Q,E.total_out+=Y,y.total+=Y,y.wrap&&Y&&(E.adler=y.check=y.flags?o(y.check,$,Y,E.next_out-Y):r(y.check,$,Y,E.next_out-Y)),E.data_type=y.bits+(y.last?64:0)+(y.mode===12?128:0)+(y.mode===20||y.mode===15?256:0),(Q==0&&Y===0||F===4)&&B===f&&(B=-5),B)},n.inflateEnd=function(E){if(!E||!E.state)return u;var F=E.state;return F.window&&(F.window=null),E.state=null,f},n.inflateGetHeader=function(E,F){var y;return E&&E.state?(2&(y=E.state).wrap)==0?u:((y.head=F).done=!1,f):u},n.inflateSetDictionary=function(E,F){var y,O=F.length;return E&&E.state?(y=E.state).wrap!==0&&y.mode!==11?u:y.mode===11&&r(1,F,O,0)!==y.check?-3:K(E,F,O,O)?(y.mode=31,-4):(y.havedict=1,f):u},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,i,n){var s=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(h,l,f,u,_,m,g,w){var b,v,T,S,M,P,z,C,H,K=w.bits,E=0,F=0,y=0,O=0,$=0,U=0,ne=0,N=0,ee=0,L=0,I=null,Q=0,Y=new s.Buf16(16),Z=new s.Buf16(16),fe=null,ve=0;for(E=0;E<=15;E++)Y[E]=0;for(F=0;F<u;F++)Y[l[f+F]]++;for($=K,O=15;1<=O&&Y[O]===0;O--);if(O<$&&($=O),O===0)return _[m++]=20971520,_[m++]=20971520,w.bits=1,0;for(y=1;y<O&&Y[y]===0;y++);for($<y&&($=y),E=N=1;E<=15;E++)if(N<<=1,(N-=Y[E])<0)return-1;if(0<N&&(h===0||O!==1))return-1;for(Z[1]=0,E=1;E<15;E++)Z[E+1]=Z[E]+Y[E];for(F=0;F<u;F++)l[f+F]!==0&&(g[Z[l[f+F]]++]=F);if(P=h===0?(I=fe=g,19):h===1?(I=r,Q-=257,fe=o,ve-=257,256):(I=a,fe=c,-1),E=y,M=m,ne=F=L=0,T=-1,S=(ee=1<<(U=$))-1,h===1&&852<ee||h===2&&592<ee)return 1;for(;;){for(z=E-ne,H=g[F]<P?(C=0,g[F]):g[F]>P?(C=fe[ve+g[F]],I[Q+g[F]]):(C=96,0),b=1<<E-ne,y=v=1<<U;_[M+(L>>ne)+(v-=b)]=z<<24|C<<16|H|0,v!==0;);for(b=1<<E-1;L&b;)b>>=1;if(b!==0?(L&=b-1,L+=b):L=0,F++,--Y[E]==0){if(E===O)break;E=l[f+g[F]]}if($<E&&(L&S)!==T){for(ne===0&&(ne=$),M+=y,N=1<<(U=E-ne);U+ne<O&&!((N-=Y[U+ne])<=0);)U++,N<<=1;if(ee+=1<<U,h===1&&852<ee||h===2&&592<ee)return 1;_[T=L&S]=$<<24|U<<16|M-m|0}}return L!==0&&(_[M+L]=E-ne<<24|64<<16|0),w.bits=$,0}},{"../utils/common":41}],51:[function(t,i,n){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,i,n){var s=t("../utils/common"),r=0,o=1;function a(A){for(var k=A.length;0<=--k;)A[k]=0}var c=0,h=29,l=256,f=l+1+h,u=30,_=19,m=2*f+1,g=15,w=16,b=7,v=256,T=16,S=17,M=18,P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],z=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],K=new Array(2*(f+2));a(K);var E=new Array(2*u);a(E);var F=new Array(512);a(F);var y=new Array(256);a(y);var O=new Array(h);a(O);var $,U,ne,N=new Array(u);function ee(A,k,j,G,R){this.static_tree=A,this.extra_bits=k,this.extra_base=j,this.elems=G,this.max_length=R,this.has_stree=A&&A.length}function L(A,k){this.dyn_tree=A,this.max_code=0,this.stat_desc=k}function I(A){return A<256?F[A]:F[256+(A>>>7)]}function Q(A,k){A.pending_buf[A.pending++]=255&k,A.pending_buf[A.pending++]=k>>>8&255}function Y(A,k,j){A.bi_valid>w-j?(A.bi_buf|=k<<A.bi_valid&65535,Q(A,A.bi_buf),A.bi_buf=k>>w-A.bi_valid,A.bi_valid+=j-w):(A.bi_buf|=k<<A.bi_valid&65535,A.bi_valid+=j)}function Z(A,k,j){Y(A,j[2*k],j[2*k+1])}function fe(A,k){for(var j=0;j|=1&A,A>>>=1,j<<=1,0<--k;);return j>>>1}function ve(A,k,j){var G,R,X=new Array(g+1),V=0;for(G=1;G<=g;G++)X[G]=V=V+j[G-1]<<1;for(R=0;R<=k;R++){var W=A[2*R+1];W!==0&&(A[2*R]=fe(X[W]++,W))}}function ie(A){var k;for(k=0;k<f;k++)A.dyn_ltree[2*k]=0;for(k=0;k<u;k++)A.dyn_dtree[2*k]=0;for(k=0;k<_;k++)A.bl_tree[2*k]=0;A.dyn_ltree[2*v]=1,A.opt_len=A.static_len=0,A.last_lit=A.matches=0}function ae(A){8<A.bi_valid?Q(A,A.bi_buf):0<A.bi_valid&&(A.pending_buf[A.pending++]=A.bi_buf),A.bi_buf=0,A.bi_valid=0}function Ae(A,k,j,G){var R=2*k,X=2*j;return A[R]<A[X]||A[R]===A[X]&&G[k]<=G[j]}function pe(A,k,j){for(var G=A.heap[j],R=j<<1;R<=A.heap_len&&(R<A.heap_len&&Ae(k,A.heap[R+1],A.heap[R],A.depth)&&R++,!Ae(k,G,A.heap[R],A.depth));)A.heap[j]=A.heap[R],j=R,R<<=1;A.heap[j]=G}function Oe(A,k,j){var G,R,X,V,W=0;if(A.last_lit!==0)for(;G=A.pending_buf[A.d_buf+2*W]<<8|A.pending_buf[A.d_buf+2*W+1],R=A.pending_buf[A.l_buf+W],W++,G===0?Z(A,R,k):(Z(A,(X=y[R])+l+1,k),(V=P[X])!==0&&Y(A,R-=O[X],V),Z(A,X=I(--G),j),(V=z[X])!==0&&Y(A,G-=N[X],V)),W<A.last_lit;);Z(A,v,k)}function Ce(A,k){var j,G,R,X=k.dyn_tree,V=k.stat_desc.static_tree,W=k.stat_desc.has_stree,te=k.stat_desc.elems,ue=-1;for(A.heap_len=0,A.heap_max=m,j=0;j<te;j++)X[2*j]!==0?(A.heap[++A.heap_len]=ue=j,A.depth[j]=0):X[2*j+1]=0;for(;A.heap_len<2;)X[2*(R=A.heap[++A.heap_len]=ue<2?++ue:0)]=1,A.depth[R]=0,A.opt_len--,W&&(A.static_len-=V[2*R+1]);for(k.max_code=ue,j=A.heap_len>>1;1<=j;j--)pe(A,X,j);for(R=te;j=A.heap[1],A.heap[1]=A.heap[A.heap_len--],pe(A,X,1),G=A.heap[1],A.heap[--A.heap_max]=j,A.heap[--A.heap_max]=G,X[2*R]=X[2*j]+X[2*G],A.depth[R]=(A.depth[j]>=A.depth[G]?A.depth[j]:A.depth[G])+1,X[2*j+1]=X[2*G+1]=R,A.heap[1]=R++,pe(A,X,1),2<=A.heap_len;);A.heap[--A.heap_max]=A.heap[1],(function(oe,Fe){var xt,We,Tt,_e,Zt,pn,Qe=Fe.dyn_tree,Kn=Fe.max_code,Vs=Fe.stat_desc.static_tree,qs=Fe.stat_desc.has_stree,Qs=Fe.stat_desc.extra_bits,Yn=Fe.stat_desc.extra_base,Et=Fe.stat_desc.max_length,Wt=0;for(_e=0;_e<=g;_e++)oe.bl_count[_e]=0;for(Qe[2*oe.heap[oe.heap_max]+1]=0,xt=oe.heap_max+1;xt<m;xt++)Et<(_e=Qe[2*Qe[2*(We=oe.heap[xt])+1]+1]+1)&&(_e=Et,Wt++),Qe[2*We+1]=_e,Kn<We||(oe.bl_count[_e]++,Zt=0,Yn<=We&&(Zt=Qs[We-Yn]),pn=Qe[2*We],oe.opt_len+=pn*(_e+Zt),qs&&(oe.static_len+=pn*(Vs[2*We+1]+Zt)));if(Wt!==0){do{for(_e=Et-1;oe.bl_count[_e]===0;)_e--;oe.bl_count[_e]--,oe.bl_count[_e+1]+=2,oe.bl_count[Et]--,Wt-=2}while(0<Wt);for(_e=Et;_e!==0;_e--)for(We=oe.bl_count[_e];We!==0;)Kn<(Tt=oe.heap[--xt])||(Qe[2*Tt+1]!==_e&&(oe.opt_len+=(_e-Qe[2*Tt+1])*Qe[2*Tt],Qe[2*Tt+1]=_e),We--)}})(A,k),ve(X,ue,A.bl_count)}function d(A,k,j){var G,R,X=-1,V=k[1],W=0,te=7,ue=4;for(V===0&&(te=138,ue=3),k[2*(j+1)+1]=65535,G=0;G<=j;G++)R=V,V=k[2*(G+1)+1],++W<te&&R===V||(W<ue?A.bl_tree[2*R]+=W:R!==0?(R!==X&&A.bl_tree[2*R]++,A.bl_tree[2*T]++):W<=10?A.bl_tree[2*S]++:A.bl_tree[2*M]++,X=R,ue=(W=0)===V?(te=138,3):R===V?(te=6,3):(te=7,4))}function B(A,k,j){var G,R,X=-1,V=k[1],W=0,te=7,ue=4;for(V===0&&(te=138,ue=3),G=0;G<=j;G++)if(R=V,V=k[2*(G+1)+1],!(++W<te&&R===V)){if(W<ue)for(;Z(A,R,A.bl_tree),--W!=0;);else R!==0?(R!==X&&(Z(A,R,A.bl_tree),W--),Z(A,T,A.bl_tree),Y(A,W-3,2)):W<=10?(Z(A,S,A.bl_tree),Y(A,W-3,3)):(Z(A,M,A.bl_tree),Y(A,W-11,7));X=R,ue=(W=0)===V?(te=138,3):R===V?(te=6,3):(te=7,4)}}a(N);var D=!1;function x(A,k,j,G){Y(A,(c<<1)+(G?1:0),3),(function(R,X,V,W){ae(R),Q(R,V),Q(R,~V),s.arraySet(R.pending_buf,R.window,X,V,R.pending),R.pending+=V})(A,k,j)}n._tr_init=function(A){D||((function(){var k,j,G,R,X,V=new Array(g+1);for(R=G=0;R<h-1;R++)for(O[R]=G,k=0;k<1<<P[R];k++)y[G++]=R;for(y[G-1]=R,R=X=0;R<16;R++)for(N[R]=X,k=0;k<1<<z[R];k++)F[X++]=R;for(X>>=7;R<u;R++)for(N[R]=X<<7,k=0;k<1<<z[R]-7;k++)F[256+X++]=R;for(j=0;j<=g;j++)V[j]=0;for(k=0;k<=143;)K[2*k+1]=8,k++,V[8]++;for(;k<=255;)K[2*k+1]=9,k++,V[9]++;for(;k<=279;)K[2*k+1]=7,k++,V[7]++;for(;k<=287;)K[2*k+1]=8,k++,V[8]++;for(ve(K,f+1,V),k=0;k<u;k++)E[2*k+1]=5,E[2*k]=fe(k,5);$=new ee(K,P,l+1,f,g),U=new ee(E,z,0,u,g),ne=new ee(new Array(0),C,0,_,b)})(),D=!0),A.l_desc=new L(A.dyn_ltree,$),A.d_desc=new L(A.dyn_dtree,U),A.bl_desc=new L(A.bl_tree,ne),A.bi_buf=0,A.bi_valid=0,ie(A)},n._tr_stored_block=x,n._tr_flush_block=function(A,k,j,G){var R,X,V=0;0<A.level?(A.strm.data_type===2&&(A.strm.data_type=(function(W){var te,ue=4093624447;for(te=0;te<=31;te++,ue>>>=1)if(1&ue&&W.dyn_ltree[2*te]!==0)return r;if(W.dyn_ltree[18]!==0||W.dyn_ltree[20]!==0||W.dyn_ltree[26]!==0)return o;for(te=32;te<l;te++)if(W.dyn_ltree[2*te]!==0)return o;return r})(A)),Ce(A,A.l_desc),Ce(A,A.d_desc),V=(function(W){var te;for(d(W,W.dyn_ltree,W.l_desc.max_code),d(W,W.dyn_dtree,W.d_desc.max_code),Ce(W,W.bl_desc),te=_-1;3<=te&&W.bl_tree[2*H[te]+1]===0;te--);return W.opt_len+=3*(te+1)+5+5+4,te})(A),R=A.opt_len+3+7>>>3,(X=A.static_len+3+7>>>3)<=R&&(R=X)):R=X=j+5,j+4<=R&&k!==-1?x(A,k,j,G):A.strategy===4||X===R?(Y(A,2+(G?1:0),3),Oe(A,K,E)):(Y(A,4+(G?1:0),3),(function(W,te,ue,oe){var Fe;for(Y(W,te-257,5),Y(W,ue-1,5),Y(W,oe-4,4),Fe=0;Fe<oe;Fe++)Y(W,W.bl_tree[2*H[Fe]+1],3);B(W,W.dyn_ltree,te-1),B(W,W.dyn_dtree,ue-1)})(A,A.l_desc.max_code+1,A.d_desc.max_code+1,V+1),Oe(A,A.dyn_ltree,A.dyn_dtree)),ie(A),G&&ae(A)},n._tr_tally=function(A,k,j){return A.pending_buf[A.d_buf+2*A.last_lit]=k>>>8&255,A.pending_buf[A.d_buf+2*A.last_lit+1]=255&k,A.pending_buf[A.l_buf+A.last_lit]=255&j,A.last_lit++,k===0?A.dyn_ltree[2*j]++:(A.matches++,k--,A.dyn_ltree[2*(y[j]+l+1)]++,A.dyn_dtree[2*I(k)]++),A.last_lit===A.lit_bufsize-1},n._tr_align=function(A){Y(A,2,3),Z(A,v,K),(function(k){k.bi_valid===16?(Q(k,k.bi_buf),k.bi_buf=0,k.bi_valid=0):8<=k.bi_valid&&(k.pending_buf[k.pending++]=255&k.bi_buf,k.bi_buf>>=8,k.bi_valid-=8)})(A)}},{"../utils/common":41}],53:[function(t,i,n){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,i,n){(function(s){(function(r,o){if(!r.setImmediate){var a,c,h,l,f=1,u={},_=!1,m=r.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(r);g=g&&g.setTimeout?g:r,a={}.toString.call(r.process)==="[object process]"?function(T){process.nextTick(function(){b(T)})}:(function(){if(r.postMessage&&!r.importScripts){var T=!0,S=r.onmessage;return r.onmessage=function(){T=!1},r.postMessage("","*"),r.onmessage=S,T}})()?(l="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",v,!1):r.attachEvent("onmessage",v),function(T){r.postMessage(l+T,"*")}):r.MessageChannel?((h=new MessageChannel).port1.onmessage=function(T){b(T.data)},function(T){h.port2.postMessage(T)}):m&&"onreadystatechange"in m.createElement("script")?(c=m.documentElement,function(T){var S=m.createElement("script");S.onreadystatechange=function(){b(T),S.onreadystatechange=null,c.removeChild(S),S=null},c.appendChild(S)}):function(T){setTimeout(b,0,T)},g.setImmediate=function(T){typeof T!="function"&&(T=new Function(""+T));for(var S=new Array(arguments.length-1),M=0;M<S.length;M++)S[M]=arguments[M+1];var P={callback:T,args:S};return u[f]=P,a(f),f++},g.clearImmediate=w}function w(T){delete u[T]}function b(T){if(_)setTimeout(b,0,T);else{var S=u[T];if(S){_=!0;try{(function(M){var P=M.callback,z=M.args;switch(z.length){case 0:P();break;case 1:P(z[0]);break;case 2:P(z[0],z[1]);break;case 3:P(z[0],z[1],z[2]);break;default:P.apply(o,z)}})(S)}finally{w(T),_=!1}}}}function v(T){T.source===r&&typeof T.data=="string"&&T.data.indexOf(l)===0&&b(+T.data.slice(l.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Kt<"u"?Kt:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(_n)),_n.exports}var Ki=Wi();const Yi=Js(Ki),es={type:"change"},Zn={type:"start"},Cs={type:"end"},qt=new $s,ts=new ei,Vi=Math.cos(70*ke.DEG2RAD),xe=new J,Le=2*Math.PI,le={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},wn=1e-6;class qi extends ws{constructor(e,t=null){super(e,t),this.state=le.NONE,this.enabled=!0,this.target=new J,this.cursor=new J,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:_t.ROTATE,MIDDLE:_t.DOLLY,RIGHT:_t.PAN},this.touches={ONE:mt.ROTATE,TWO:mt.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new J,this._lastQuaternion=new ye,this._lastTargetPosition=new J,this._quat=new ye().setFromUnitVectors(e.up,new J(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Vn,this._sphericalDelta=new Vn,this._scale=1,this._panOffset=new J,this._rotateStart=new De,this._rotateEnd=new De,this._rotateDelta=new De,this._panStart=new De,this._panEnd=new De,this._panDelta=new De,this._dollyStart=new De,this._dollyEnd=new De,this._dollyDelta=new De,this._dollyDirection=new J,this._mouse=new De,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Ji.bind(this),this._onPointerDown=Qi.bind(this),this._onPointerUp=$i.bind(this),this._onContextMenu=or.bind(this),this._onMouseWheel=nr.bind(this),this._onKeyDown=sr.bind(this),this._onTouchStart=ir.bind(this),this._onTouchMove=rr.bind(this),this._onMouseDown=er.bind(this),this._onMouseMove=tr.bind(this),this._interceptControlDown=ar.bind(this),this._interceptControlUp=lr.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(es),this.update(),this.state=le.NONE}update(e=null){const t=this.object.position;xe.copy(t).sub(this.target),xe.applyQuaternion(this._quat),this._spherical.setFromVector3(xe),this.autoRotate&&this.state===le.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,n=this.maxAzimuthAngle;isFinite(i)&&isFinite(n)&&(i<-Math.PI?i+=Le:i>Math.PI&&(i-=Le),n<-Math.PI?n+=Le:n>Math.PI&&(n-=Le),i<=n?this._spherical.theta=Math.max(i,Math.min(n,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(i+n)/2?Math.max(i,this._spherical.theta):Math.min(n,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const r=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=r!=this._spherical.radius}if(xe.setFromSpherical(this._spherical),xe.applyQuaternion(this._quatInverse),t.copy(this.target).add(xe),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let r=null;if(this.object.isPerspectiveCamera){const o=xe.length();r=this._clampDistance(o*this._scale);const a=o-r;this.object.position.addScaledVector(this._dollyDirection,a),this.object.updateMatrixWorld(),s=!!a}else if(this.object.isOrthographicCamera){const o=new J(this._mouse.x,this._mouse.y,0);o.unproject(this.object);const a=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=a!==this.object.zoom;const c=new J(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(o),this.object.updateMatrixWorld(),r=xe.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;r!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(r).add(this.object.position):(qt.origin.copy(this.object.position),qt.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(qt.direction))<Vi?this.object.lookAt(this.target):(ts.setFromNormalAndCoplanarPoint(this.object.up,this.target),qt.intersectPlane(ts,this.target))))}else if(this.object.isOrthographicCamera){const r=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),r!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>wn||8*(1-this._lastQuaternion.dot(this.object.quaternion))>wn||this._lastTargetPosition.distanceToSquared(this.target)>wn?(this.dispatchEvent(es),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Le/60*this.autoRotateSpeed*e:Le/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){xe.setFromMatrixColumn(t,0),xe.multiplyScalar(-e),this._panOffset.add(xe)}_panUp(e,t){this.screenSpacePanning===!0?xe.setFromMatrixColumn(t,1):(xe.setFromMatrixColumn(t,0),xe.crossVectors(this.object.up,xe)),xe.multiplyScalar(e),this._panOffset.add(xe)}_pan(e,t){const i=this.domElement;if(this.object.isPerspectiveCamera){const n=this.object.position;xe.copy(n).sub(this.target);let s=xe.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/i.clientHeight,this.object.matrix),this._panUp(2*t*s/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),n=e-i.left,s=t-i.top,r=i.width,o=i.height;this._mouse.x=n/r*2-1,this._mouse.y=-(s/o)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Le*this._rotateDelta.x/t.clientHeight),this._rotateUp(Le*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp(Le*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp(-Le*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft(Le*this.rotateSpeed/this.domElement.clientHeight):this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft(-Le*this.rotateSpeed/this.domElement.clientHeight):this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._rotateStart.set(i,n)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panStart.set(i,n)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,n=e.pageY-t.y,s=Math.sqrt(i*i+n*n);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),n=.5*(e.pageX+i.x),s=.5*(e.pageY+i.y);this._rotateEnd.set(n,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Le*this._rotateDelta.x/t.clientHeight),this._rotateUp(Le*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panEnd.set(i,n)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,n=e.pageY-t.y,s=Math.sqrt(i*i+n*n);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const r=(e.pageX+t.x)*.5,o=(e.pageY+t.y)*.5;this._updateZoomParameters(r,o)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new De,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,i={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}}function Qi(p){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(p.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(p)&&(this._addPointer(p),p.pointerType==="touch"?this._onTouchStart(p):this._onMouseDown(p)))}function Ji(p){this.enabled!==!1&&(p.pointerType==="touch"?this._onTouchMove(p):this._onMouseMove(p))}function $i(p){switch(this._removePointer(p),this._pointers.length){case 0:this.domElement.releasePointerCapture(p.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Cs),this.state=le.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function er(p){let e;switch(p.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case _t.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(p),this.state=le.DOLLY;break;case _t.ROTATE:if(p.ctrlKey||p.metaKey||p.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(p),this.state=le.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(p),this.state=le.ROTATE}break;case _t.PAN:if(p.ctrlKey||p.metaKey||p.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(p),this.state=le.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(p),this.state=le.PAN}break;default:this.state=le.NONE}this.state!==le.NONE&&this.dispatchEvent(Zn)}function tr(p){switch(this.state){case le.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(p);break;case le.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(p);break;case le.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(p);break}}function nr(p){this.enabled===!1||this.enableZoom===!1||this.state!==le.NONE||(p.preventDefault(),this.dispatchEvent(Zn),this._handleMouseWheel(this._customWheelEvent(p)),this.dispatchEvent(Cs))}function sr(p){this.enabled===!1||this.enablePan===!1||this._handleKeyDown(p)}function ir(p){switch(this._trackPointer(p),this._pointers.length){case 1:switch(this.touches.ONE){case mt.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(p),this.state=le.TOUCH_ROTATE;break;case mt.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(p),this.state=le.TOUCH_PAN;break;default:this.state=le.NONE}break;case 2:switch(this.touches.TWO){case mt.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(p),this.state=le.TOUCH_DOLLY_PAN;break;case mt.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(p),this.state=le.TOUCH_DOLLY_ROTATE;break;default:this.state=le.NONE}break;default:this.state=le.NONE}this.state!==le.NONE&&this.dispatchEvent(Zn)}function rr(p){switch(this._trackPointer(p),this.state){case le.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(p),this.update();break;case le.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(p),this.update();break;case le.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(p),this.update();break;case le.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(p),this.update();break;default:this.state=le.NONE}}function or(p){this.enabled!==!1&&p.preventDefault()}function ar(p){p.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function lr(p){p.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const ht=new ti,Ie=new J,et=new J,me=new ye,ns={X:new J(1,0,0),Y:new J(0,1,0),Z:new J(0,0,1)},bn={type:"change"},ss={type:"mouseDown",mode:null},is={type:"mouseUp",mode:null},rs={type:"objectChange"};class cr extends ws{constructor(e,t=null){super(void 0,t);const i=new mr(this);this._root=i;const n=new gr;this._gizmo=n,i.add(n);const s=new yr;this._plane=s,i.add(s);const r=this;function o(v,T){let S=T;Object.defineProperty(r,v,{get:function(){return S!==void 0?S:T},set:function(M){S!==M&&(S=M,s[v]=M,n[v]=M,r.dispatchEvent({type:v+"-changed",value:M}),r.dispatchEvent(bn))}}),r[v]=T,s[v]=T,n[v]=T}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0),o("minX",-1/0),o("maxX",1/0),o("minY",-1/0),o("maxY",1/0),o("minZ",-1/0),o("maxZ",1/0);const a=new J,c=new J,h=new ye,l=new ye,f=new J,u=new ye,_=new J,m=new J,g=new J,w=0,b=new J;o("worldPosition",a),o("worldPositionStart",c),o("worldQuaternion",h),o("worldQuaternionStart",l),o("cameraPosition",f),o("cameraQuaternion",u),o("pointStart",_),o("pointEnd",m),o("rotationAxis",g),o("rotationAngle",w),o("eye",b),this._offset=new J,this._startNorm=new J,this._endNorm=new J,this._cameraScale=new J,this._parentPosition=new J,this._parentQuaternion=new ye,this._parentQuaternionInv=new ye,this._parentScale=new J,this._worldScaleStart=new J,this._worldQuaternionInv=new ye,this._worldScale=new J,this._positionStart=new J,this._quaternionStart=new ye,this._scaleStart=new J,this._getPointer=hr.bind(this),this._onPointerDown=fr.bind(this),this._onPointerHover=ur.bind(this),this._onPointerMove=dr.bind(this),this._onPointerUp=pr.bind(this),t!==null&&this.connect()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&ht.setFromCamera(e,this.camera);const t=vn(this._gizmo.picker[this.mode],ht);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&ht.setFromCamera(e,this.camera);const t=vn(this._plane,ht,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,ss.mode=this.mode,this.dispatchEvent(ss)}}pointerMove(e){const t=this.axis,i=this.mode,n=this.object;let s=this.space;if(i==="scale"?s="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(s="world"),n===void 0||t===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&ht.setFromCamera(e,this.camera);const r=vn(this._plane,ht,!0);if(r){if(this.pointEnd.copy(r.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),s==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),s==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(s==="local"&&(n.position.applyQuaternion(me.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),s==="world"&&(n.parent&&n.position.add(Ie.setFromMatrixPosition(n.parent.matrixWorld)),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(Ie.setFromMatrixPosition(n.parent.matrixWorld)))),n.position.x=Math.max(this.minX,Math.min(this.maxX,n.position.x)),n.position.y=Math.max(this.minY,Math.min(this.maxY,n.position.y)),n.position.z=Math.max(this.minZ,Math.min(this.maxZ,n.position.z));else if(i==="scale"){if(t.search("XYZ")!==-1){let o=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(o*=-1),et.set(o,o,o)}else Ie.copy(this.pointStart),et.copy(this.pointEnd),Ie.applyQuaternion(this._worldQuaternionInv),et.applyQuaternion(this._worldQuaternionInv),et.divide(Ie),t.search("X")===-1&&(et.x=1),t.search("Y")===-1&&(et.y=1),t.search("Z")===-1&&(et.z=1);n.scale.copy(this._scaleStart).multiply(et),this.scaleSnap&&(t.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const o=20/this.worldPosition.distanceTo(Ie.setFromMatrixPosition(this.camera.matrixWorld));let a=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Ie.copy(this.rotationAxis).cross(this.eye))*o):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(ns[t]),Ie.copy(ns[t]),s==="local"&&Ie.applyQuaternion(this.worldQuaternion),Ie.cross(this.eye),Ie.length()===0?a=!0:this.rotationAngle=this._offset.dot(Ie.normalize())*o),(t==="E"||a)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),s==="local"&&t!=="E"&&t!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(me.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(me.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(bn),this.dispatchEvent(rs)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(is.mode=this.mode,this.dispatchEvent(is)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(e){return this.object=e,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(bn),this.dispatchEvent(rs),this.pointStart.copy(this.pointEnd))}getRaycaster(){return ht}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function hr(p){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:p.button};{const e=this.domElement.getBoundingClientRect();return{x:(p.clientX-e.left)/e.width*2-1,y:-(p.clientY-e.top)/e.height*2+1,button:p.button}}}function ur(p){if(this.enabled)switch(p.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(p));break}}function fr(p){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(p.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(p)),this.pointerDown(this._getPointer(p)))}function dr(p){this.enabled&&this.pointerMove(this._getPointer(p))}function pr(p){this.enabled&&(this.domElement.releasePointerCapture(p.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(p)))}function vn(p,e,t){const i=e.intersectObject(p,!0);for(let n=0;n<i.length;n++)if(i[n].object.visible||t)return i[n];return!1}const Qt=new it,ce=new J(0,1,0),os=new J(0,0,0),as=new he,Jt=new ye,rn=new ye,Ke=new J,ls=new he,Pt=new J(1,0,0),ft=new J(0,1,0),Ct=new J(0,0,1),$t=new J,kt=new J,It=new J;class mr extends $e{constructor(e){super(),this.isTransformControlsRoot=!0,this.controls=e,this.visible=!1}updateMatrixWorld(e){const t=this.controls;t.object!==void 0&&(t.object.updateMatrixWorld(),t.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):t.object.parent.matrixWorld.decompose(t._parentPosition,t._parentQuaternion,t._parentScale),t.object.matrixWorld.decompose(t.worldPosition,t.worldQuaternion,t._worldScale),t._parentQuaternionInv.copy(t._parentQuaternion).invert(),t._worldQuaternionInv.copy(t.worldQuaternion).invert()),t.camera.updateMatrixWorld(),t.camera.matrixWorld.decompose(t.cameraPosition,t.cameraQuaternion,t._cameraScale),t.camera.isOrthographicCamera?t.camera.getWorldDirection(t.eye).negate():t.eye.copy(t.cameraPosition).sub(t.worldPosition).normalize(),super.updateMatrixWorld(e)}dispose(){this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}}class gr extends $e{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new dt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new Hn({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const n=t.clone();n.opacity=.5;const s=e.clone();s.color.setHex(16711680);const r=e.clone();r.color.setHex(65280);const o=e.clone();o.color.setHex(255);const a=e.clone();a.color.setHex(16711680),a.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const h=e.clone();h.color.setHex(255),h.opacity=.5;const l=e.clone();l.opacity=.25;const f=e.clone();f.color.setHex(16776960),f.opacity=.25,e.clone().color.setHex(16776960);const _=e.clone();_.color.setHex(7895160);const m=new Me(0,.04,.1,12);m.translate(0,.05,0);const g=new Re(.08,.08,.08);g.translate(0,.04,0);const w=new at;w.setAttribute("position",new st([0,0,0,1,0,0],3));const b=new Me(.0075,.0075,.5,3);b.translate(0,.25,0);function v(O,$){const U=new St(O,.0075,3,64,$*Math.PI*2);return U.rotateY(Math.PI/2),U.rotateX(Math.PI/2),U}function T(){const O=new at;return O.setAttribute("position",new st([0,0,0,1,1,1],3)),O}const S={X:[[new q(m,s),[.5,0,0],[0,0,-Math.PI/2]],[new q(m,s),[-.5,0,0],[0,0,Math.PI/2]],[new q(b,s),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new q(m,r),[0,.5,0]],[new q(m,r),[0,-.5,0],[Math.PI,0,0]],[new q(b,r)]],Z:[[new q(m,o),[0,0,.5],[Math.PI/2,0,0]],[new q(m,o),[0,0,-.5],[-Math.PI/2,0,0]],[new q(b,o),null,[Math.PI/2,0,0]]],XYZ:[[new q(new Vt(.1,0),l.clone()),[0,0,0]]],XY:[[new q(new Re(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new q(new Re(.15,.15,.01),a.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new q(new Re(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},M={X:[[new q(new Me(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new q(new Me(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new q(new Me(.2,0,.6,4),i),[0,.3,0]],[new q(new Me(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new q(new Me(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new q(new Me(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new q(new Vt(.2,0),i)]],XY:[[new q(new Re(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new q(new Re(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new q(new Re(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},P={START:[[new q(new Vt(.01,2),n),null,null,null,"helper"]],END:[[new q(new Vt(.01,2),n),null,null,null,"helper"]],DELTA:[[new Ye(T(),n),null,null,null,"helper"]],X:[[new Ye(w,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ye(w,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ye(w,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},z={XYZE:[[new q(v(.5,1),_),null,[0,Math.PI/2,0]]],X:[[new q(v(.5,.5),s)]],Y:[[new q(v(.5,.5),r),null,[0,0,-Math.PI/2]]],Z:[[new q(v(.5,.5),o),null,[0,Math.PI/2,0]]],E:[[new q(v(.75,1),f),null,[0,Math.PI/2,0]]]},C={AXIS:[[new Ye(w,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},H={XYZE:[[new q(new ni(.25,10,8),i)]],X:[[new q(new St(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new q(new St(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new q(new St(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new q(new St(.75,.1,2,24),i)]]},K={X:[[new q(g,s),[.5,0,0],[0,0,-Math.PI/2]],[new q(b,s),[0,0,0],[0,0,-Math.PI/2]],[new q(g,s),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new q(g,r),[0,.5,0]],[new q(b,r)],[new q(g,r),[0,-.5,0],[0,0,Math.PI]]],Z:[[new q(g,o),[0,0,.5],[Math.PI/2,0,0]],[new q(b,o),[0,0,0],[Math.PI/2,0,0]],[new q(g,o),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new q(new Re(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new q(new Re(.15,.15,.01),a),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new q(new Re(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new q(new Re(.1,.1,.1),l.clone())]]},E={X:[[new q(new Me(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new q(new Me(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new q(new Me(.2,0,.6,4),i),[0,.3,0]],[new q(new Me(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new q(new Me(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new q(new Me(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new q(new Re(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new q(new Re(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new q(new Re(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new q(new Re(.2,.2,.2),i),[0,0,0]]]},F={X:[[new Ye(w,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ye(w,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ye(w,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function y(O){const $=new $e;for(const U in O)for(let ne=O[U].length;ne--;){const N=O[U][ne][0].clone(),ee=O[U][ne][1],L=O[U][ne][2],I=O[U][ne][3],Q=O[U][ne][4];N.name=U,N.tag=Q,ee&&N.position.set(ee[0],ee[1],ee[2]),L&&N.rotation.set(L[0],L[1],L[2]),I&&N.scale.set(I[0],I[1],I[2]),N.updateMatrix();const Y=N.geometry.clone();Y.applyMatrix4(N.matrix),N.geometry=Y,N.renderOrder=1/0,N.position.set(0,0,0),N.rotation.set(0,0,0),N.scale.set(1,1,1),$.add(N)}return $}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=y(S)),this.add(this.gizmo.rotate=y(z)),this.add(this.gizmo.scale=y(K)),this.add(this.picker.translate=y(M)),this.add(this.picker.rotate=y(H)),this.add(this.picker.scale=y(E)),this.add(this.helper.translate=y(P)),this.add(this.helper.rotate=y(C)),this.add(this.helper.scale=y(F)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:rn;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let s=0;s<n.length;s++){const r=n[s];r.visible=!0,r.rotation.set(0,0,0),r.position.copy(this.worldPosition);let o;if(this.camera.isOrthographicCamera?o=(this.camera.top-this.camera.bottom)/this.camera.zoom:o=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),r.scale.set(1,1,1).multiplyScalar(o*this.size/4),r.tag==="helper"){r.visible=!1,r.name==="AXIS"?(r.visible=!!this.axis,this.axis==="X"&&(me.setFromEuler(Qt.set(0,0,0)),r.quaternion.copy(i).multiply(me),Math.abs(ce.copy(Pt).applyQuaternion(i).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Y"&&(me.setFromEuler(Qt.set(0,0,Math.PI/2)),r.quaternion.copy(i).multiply(me),Math.abs(ce.copy(ft).applyQuaternion(i).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Z"&&(me.setFromEuler(Qt.set(0,Math.PI/2,0)),r.quaternion.copy(i).multiply(me),Math.abs(ce.copy(Ct).applyQuaternion(i).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="XYZE"&&(me.setFromEuler(Qt.set(0,Math.PI/2,0)),ce.copy(this.rotationAxis),r.quaternion.setFromRotationMatrix(as.lookAt(os,ce,ft)),r.quaternion.multiply(me),r.visible=this.dragging),this.axis==="E"&&(r.visible=!1)):r.name==="START"?(r.position.copy(this.worldPositionStart),r.visible=this.dragging):r.name==="END"?(r.position.copy(this.worldPosition),r.visible=this.dragging):r.name==="DELTA"?(r.position.copy(this.worldPositionStart),r.quaternion.copy(this.worldQuaternionStart),Ie.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Ie.applyQuaternion(this.worldQuaternionStart.clone().invert()),r.scale.copy(Ie),r.visible=this.dragging):(r.quaternion.copy(i),this.dragging?r.position.copy(this.worldPositionStart):r.position.copy(this.worldPosition),this.axis&&(r.visible=this.axis.search(r.name)!==-1));continue}r.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(r.name==="X"&&Math.abs(ce.copy(Pt).applyQuaternion(i).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Y"&&Math.abs(ce.copy(ft).applyQuaternion(i).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Z"&&Math.abs(ce.copy(Ct).applyQuaternion(i).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XY"&&Math.abs(ce.copy(Ct).applyQuaternion(i).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="YZ"&&Math.abs(ce.copy(Pt).applyQuaternion(i).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XZ"&&Math.abs(ce.copy(ft).applyQuaternion(i).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1)):this.mode==="rotate"&&(Jt.copy(i),ce.copy(this.eye).applyQuaternion(me.copy(i).invert()),r.name.search("E")!==-1&&r.quaternion.setFromRotationMatrix(as.lookAt(this.eye,os,ft)),r.name==="X"&&(me.setFromAxisAngle(Pt,Math.atan2(-ce.y,ce.z)),me.multiplyQuaternions(Jt,me),r.quaternion.copy(me)),r.name==="Y"&&(me.setFromAxisAngle(ft,Math.atan2(ce.x,ce.z)),me.multiplyQuaternions(Jt,me),r.quaternion.copy(me)),r.name==="Z"&&(me.setFromAxisAngle(Ct,Math.atan2(ce.y,ce.x)),me.multiplyQuaternions(Jt,me),r.quaternion.copy(me))),r.visible=r.visible&&(r.name.indexOf("X")===-1||this.showX),r.visible=r.visible&&(r.name.indexOf("Y")===-1||this.showY),r.visible=r.visible&&(r.name.indexOf("Z")===-1||this.showZ),r.visible=r.visible&&(r.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),r.material._color=r.material._color||r.material.color.clone(),r.material._opacity=r.material._opacity||r.material.opacity,r.material.color.copy(r.material._color),r.material.opacity=r.material._opacity,this.enabled&&this.axis&&(r.name===this.axis||this.axis.split("").some(function(a){return r.name===a}))&&(r.material.color.setHex(16776960),r.material.opacity=1)}super.updateMatrixWorld(e)}}class yr extends q{constructor(){super(new si(1e5,1e5,2,2),new dt({visible:!1,wireframe:!0,side:At,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),$t.copy(Pt).applyQuaternion(t==="local"?this.worldQuaternion:rn),kt.copy(ft).applyQuaternion(t==="local"?this.worldQuaternion:rn),It.copy(Ct).applyQuaternion(t==="local"?this.worldQuaternion:rn),ce.copy(kt),this.mode){case"translate":case"scale":switch(this.axis){case"X":ce.copy(this.eye).cross($t),Ke.copy($t).cross(ce);break;case"Y":ce.copy(this.eye).cross(kt),Ke.copy(kt).cross(ce);break;case"Z":ce.copy(this.eye).cross(It),Ke.copy(It).cross(ce);break;case"XY":Ke.copy(It);break;case"YZ":Ke.copy($t);break;case"XZ":ce.copy(It),Ke.copy(kt);break;case"XYZ":case"E":Ke.set(0,0,0);break}break;case"rotate":default:Ke.set(0,0,0)}Ke.length()===0?this.quaternion.copy(this.cameraQuaternion):(ls.lookAt(Ie.set(0,0,0),Ke,ce),this.quaternion.setFromRotationMatrix(ls)),super.updateMatrixWorld(e)}}function ia(p,e=!1){const t=p[0].index!==null,i=new Set(Object.keys(p[0].attributes)),n=new Set(Object.keys(p[0].morphAttributes)),s={},r={},o=p[0].morphTargetsRelative,a=new at;let c=0;for(let h=0;h<p.length;++h){const l=p[h];let f=0;if(t!==(l.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const u in l.attributes){if(!i.has(u))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+u+'" attribute exists among all geometries, or in none of them.'),null;s[u]===void 0&&(s[u]=[]),s[u].push(l.attributes[u]),f++}if(f!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(o!==l.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const u in l.morphAttributes){if(!n.has(u))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;r[u]===void 0&&(r[u]=[]),r[u].push(l.morphAttributes[u])}if(e){let u;if(t)u=l.index.count;else if(l.attributes.position!==void 0)u=l.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;a.addGroup(c,u,h),c+=u}}if(t){let h=0;const l=[];for(let f=0;f<p.length;++f){const u=p[f].index;for(let _=0;_<u.count;++_)l.push(u.getX(_)+h);h+=p[f].attributes.position.count}a.setIndex(l)}for(const h in s){const l=cs(s[h]);if(!l)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+h+" attribute."),null;a.setAttribute(h,l)}for(const h in r){const l=r[h][0].length;if(l===0)break;a.morphAttributes=a.morphAttributes||{},a.morphAttributes[h]=[];for(let f=0;f<l;++f){const u=[];for(let m=0;m<r[h].length;++m)u.push(r[h][m][f]);const _=cs(u);if(!_)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+h+" morphAttribute."),null;a.morphAttributes[h].push(_)}}return a}function cs(p){let e,t,i,n=-1,s=0;for(let c=0;c<p.length;++c){const h=p[c];if(e===void 0&&(e=h.array.constructor),e!==h.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=h.itemSize),t!==h.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(i===void 0&&(i=h.normalized),i!==h.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(n===-1&&(n=h.gpuType),n!==h.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;s+=h.count*t}const r=new e(s),o=new wt(r,t,i);let a=0;for(let c=0;c<p.length;++c){const h=p[c];if(h.isInterleavedBufferAttribute){const l=a/t;for(let f=0,u=h.count;f<u;f++)for(let _=0;_<t;_++){const m=h.getComponent(f,_);o.setComponent(f+l,_,m)}}else r.set(h.array,a);a+=h.count*t}return n!==void 0&&(o.gpuType=n),o}function hs(p,e){if(e===ii)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),p;if(e===Pn||e===bs){let t=p.getIndex();if(t===null){const r=[],o=p.getAttribute("position");if(o!==void 0){for(let a=0;a<o.count;a++)r.push(a);p.setIndex(r),t=p.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),p}const i=t.count-2,n=[];if(e===Pn)for(let r=1;r<=i;r++)n.push(t.getX(0)),n.push(t.getX(r)),n.push(t.getX(r+1));else for(let r=0;r<i;r++)r%2===0?(n.push(t.getX(r)),n.push(t.getX(r+1)),n.push(t.getX(r+2))):(n.push(t.getX(r+2)),n.push(t.getX(r+1)),n.push(t.getX(r)));n.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=p.clone();return s.setIndex(n),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),p}class Wn extends zt{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Ar(t)}),this.register(function(t){return new xr(t)}),this.register(function(t){return new Mr(t)}),this.register(function(t){return new Lr(t)}),this.register(function(t){return new Dr(t)}),this.register(function(t){return new Er(t)}),this.register(function(t){return new Sr(t)}),this.register(function(t){return new kr(t)}),this.register(function(t){return new Ir(t)}),this.register(function(t){return new vr(t)}),this.register(function(t){return new Rr(t)}),this.register(function(t){return new Tr(t)}),this.register(function(t){return new Cr(t)}),this.register(function(t){return new Pr(t)}),this.register(function(t){return new wr(t)}),this.register(function(t){return new Or(t)}),this.register(function(t){return new Fr(t)})}load(e,t,i,n){const s=this;let r;if(this.resourcePath!=="")r=this.resourcePath;else if(this.path!==""){const c=bt.extractUrlBase(e);r=bt.resolveURL(c,this.path)}else r=bt.extractUrlBase(e);this.manager.itemStart(e);const o=function(c){n?n(c):console.error(c),s.manager.itemError(e),s.manager.itemEnd(e)},a=new Bt(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(c){try{s.parse(c,r,function(h){t(h),s.manager.itemEnd(e)},o)}catch(h){o(h)}},i,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){let s;const r={},o={},a=new TextDecoder;if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(a.decode(new Uint8Array(e,0,4))===Ms){try{r[re.KHR_BINARY_GLTF]=new zr(e)}catch(l){n&&n(l);return}s=JSON.parse(r[re.KHR_BINARY_GLTF].content)}else s=JSON.parse(a.decode(e));else s=e;if(s.asset===void 0||s.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new qr(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const l=this.pluginCallbacks[h](c);l.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[l.name]=l,r[l.name]=!0}if(s.extensionsUsed)for(let h=0;h<s.extensionsUsed.length;++h){const l=s.extensionsUsed[h],f=s.extensionsRequired||[];switch(l){case re.KHR_MATERIALS_UNLIT:r[l]=new br;break;case re.KHR_DRACO_MESH_COMPRESSION:r[l]=new Br(s,this.dracoLoader);break;case re.KHR_TEXTURE_TRANSFORM:r[l]=new Nr;break;case re.KHR_MESH_QUANTIZATION:r[l]=new Ur;break;default:f.indexOf(l)>=0&&o[l]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+l+'".')}}c.setExtensions(r),c.setPlugins(o),c.parse(i,n)}parseAsync(e,t){const i=this;return new Promise(function(n,s){i.parse(e,t,n,s)})}}function _r(){let p={};return{get:function(e){return p[e]},add:function(e,t){p[e]=t},remove:function(e){delete p[e]},removeAll:function(){p={}}}}const re={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class wr{constructor(e){this.parser=e,this.name=re.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,n=t.length;i<n;i++){const s=t[i];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let n=t.cache.get(i);if(n)return n;const s=t.json,a=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let c;const h=new Se(16777215);a.color!==void 0&&h.setRGB(a.color[0],a.color[1],a.color[2],Ve);const l=a.range!==void 0?a.range:0;switch(a.type){case"directional":c=new Gn(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new ln(h),c.distance=l;break;case"spot":c=new vs(h),c.distance=l,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,c.angle=a.spot.outerConeAngle,c.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return c.position.set(0,0,0),c.decay=2,Je(c,a),a.intensity!==void 0&&(c.intensity=a.intensity),c.name=t.createUniqueName(a.name||"light_"+e),n=Promise.resolve(c),t.cache.add(i,n),n}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,s=i.json.nodes[e],o=(s.extensions&&s.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(a){return i._getNodeRef(t.cache,o,a)})}}class br{constructor(){this.name=re.KHR_MATERIALS_UNLIT}getMaterialType(){return dt}extendParams(e,t,i){const n=[];e.color=new Se(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const r=s.baseColorFactor;e.color.setRGB(r[0],r[1],r[2],Ve),e.opacity=r[3]}s.baseColorTexture!==void 0&&n.push(i.assignTexture(e,"map",s.baseColorTexture,we))}return Promise.all(n)}}class vr{constructor(e){this.parser=e,this.name=re.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class Ar{constructor(e){this.parser=e,this.name=re.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:qe}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];if(r.clearcoatFactor!==void 0&&(t.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(s.push(i.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const o=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new De(o,o)}return Promise.all(s)}}class xr{constructor(e){this.parser=e,this.name=re.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:qe}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class Tr{constructor(e){this.parser=e,this.name=re.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:qe}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return r.iridescenceFactor!==void 0&&(t.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&s.push(i.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(t.iridescenceIOR=r.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&s.push(i.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(s)}}class Er{constructor(e){this.parser=e,this.name=re.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:qe}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new Se(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=n.extensions[this.name];if(r.sheenColorFactor!==void 0){const o=r.sheenColorFactor;t.sheenColor.setRGB(o[0],o[1],o[2],Ve)}return r.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&s.push(i.assignTexture(t,"sheenColorMap",r.sheenColorTexture,we)),r.sheenRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(s)}}class Sr{constructor(e){this.parser=e,this.name=re.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:qe}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return r.transmissionFactor!==void 0&&(t.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&s.push(i.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(s)}}class kr{constructor(e){this.parser=e,this.name=re.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:qe}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];t.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&s.push(i.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const o=r.attenuationColor||[1,1,1];return t.attenuationColor=new Se().setRGB(o[0],o[1],o[2],Ve),Promise.all(s)}}class Ir{constructor(e){this.parser=e,this.name=re.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:qe}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class Rr{constructor(e){this.parser=e,this.name=re.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:qe}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];t.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&s.push(i.assignTexture(t,"specularIntensityMap",r.specularTexture));const o=r.specularColorFactor||[1,1,1];return t.specularColor=new Se().setRGB(o[0],o[1],o[2],Ve),r.specularColorTexture!==void 0&&s.push(i.assignTexture(t,"specularColorMap",r.specularColorTexture,we)),Promise.all(s)}}class Pr{constructor(e){this.parser=e,this.name=re.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:qe}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return t.bumpScale=r.bumpFactor!==void 0?r.bumpFactor:1,r.bumpTexture!==void 0&&s.push(i.assignTexture(t,"bumpMap",r.bumpTexture)),Promise.all(s)}}class Cr{constructor(e){this.parser=e,this.name=re.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:qe}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return r.anisotropyStrength!==void 0&&(t.anisotropy=r.anisotropyStrength),r.anisotropyRotation!==void 0&&(t.anisotropyRotation=r.anisotropyRotation),r.anisotropyTexture!==void 0&&s.push(i.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(s)}}class Mr{constructor(e){this.parser=e,this.name=re.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const s=n.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,r)}}class Lr{constructor(e){this.parser=e,this.name=re.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,s=n.textures[e];if(!s.extensions||!s.extensions[t])return null;const r=s.extensions[t],o=n.images[r.source];let a=i.textureLoader;if(o.uri){const c=i.options.manager.getHandler(o.uri);c!==null&&(a=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,r.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Dr{constructor(e){this.parser=e,this.name=re.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,s=n.textures[e];if(!s.extensions||!s.extensions[t])return null;const r=s.extensions[t],o=n.images[r.source];let a=i.textureLoader;if(o.uri){const c=i.options.manager.getHandler(o.uri);c!==null&&(a=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,r.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Or{constructor(e){this.name=re.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const n=i.extensions[this.name],s=this.parser.getDependency("buffer",n.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(o){const a=n.byteOffset||0,c=n.byteLength||0,h=n.count,l=n.byteStride,f=new Uint8Array(o,a,c);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(h,l,f,n.mode,n.filter).then(function(u){return u.buffer}):r.ready.then(function(){const u=new ArrayBuffer(h*l);return r.decodeGltfBuffer(new Uint8Array(u),h,l,f,n.mode,n.filter),u})})}else return null}}class Fr{constructor(e){this.name=re.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const n=t.meshes[i.mesh];for(const c of n.primitives)if(c.mode!==ze.TRIANGLES&&c.mode!==ze.TRIANGLE_STRIP&&c.mode!==ze.TRIANGLE_FAN&&c.mode!==void 0)return null;const r=i.extensions[this.name].attributes,o=[],a={};for(const c in r)o.push(this.parser.getDependency("accessor",r[c]).then(h=>(a[c]=h,a[c])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(c=>{const h=c.pop(),l=h.isGroup?h.children:[h],f=c[0].count,u=[];for(const _ of l){const m=new he,g=new J,w=new ye,b=new J(1,1,1),v=new ri(_.geometry,_.material,f);for(let T=0;T<f;T++)a.TRANSLATION&&g.fromBufferAttribute(a.TRANSLATION,T),a.ROTATION&&w.fromBufferAttribute(a.ROTATION,T),a.SCALE&&b.fromBufferAttribute(a.SCALE,T),v.setMatrixAt(T,m.compose(g,w,b));for(const T in a)if(T==="_COLOR_0"){const S=a[T];v.instanceColor=new oi(S.array,S.itemSize,S.normalized)}else T!=="TRANSLATION"&&T!=="ROTATION"&&T!=="SCALE"&&_.geometry.setAttribute(T,a[T]);$e.prototype.copy.call(v,_),this.parser.assignFinalMaterial(v),u.push(v)}return h.isGroup?(h.clear(),h.add(...u),h):u[0]}))}}const Ms="glTF",Rt=12,us={JSON:1313821514,BIN:5130562};class zr{constructor(e){this.name=re.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Rt),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Ms)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-Rt,s=new DataView(e,Rt);let r=0;for(;r<n;){const o=s.getUint32(r,!0);r+=4;const a=s.getUint32(r,!0);if(r+=4,a===us.JSON){const c=new Uint8Array(e,Rt+r,o);this.content=i.decode(c)}else if(a===us.BIN){const c=Rt+r;this.body=e.slice(c,c+o)}r+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Br{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=re.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,n=this.dracoLoader,s=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,o={},a={},c={};for(const h in r){const l=Bn[h]||h.toLowerCase();o[l]=r[h]}for(const h in e.attributes){const l=Bn[h]||h.toLowerCase();if(r[h]!==void 0){const f=i.accessors[e.attributes[h]],u=vt[f.componentType];c[l]=u.name,a[l]=f.normalized===!0}}return t.getDependency("bufferView",s).then(function(h){return new Promise(function(l,f){n.decodeDracoFile(h,function(u){for(const _ in u.attributes){const m=u.attributes[_],g=a[_];g!==void 0&&(m.normalized=g)}l(u)},o,c,Ve,f)})})}}class Nr{constructor(){this.name=re.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Ur{constructor(){this.name=re.KHR_MESH_QUANTIZATION}}class Ls extends vi{constructor(e,t,i,n){super(e,t,i,n)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=e*n*3+n;for(let r=0;r!==n;r++)t[r]=i[s+r];return t}interpolate_(e,t,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=o*2,c=o*3,h=n-t,l=(i-t)/h,f=l*l,u=f*l,_=e*c,m=_-c,g=-2*u+3*f,w=u-f,b=1-g,v=w-f+l;for(let T=0;T!==o;T++){const S=r[m+T+o],M=r[m+T+a]*h,P=r[_+T+o],z=r[_+T]*h;s[T]=b*S+v*M+g*P+w*z}return s}}const jr=new ye;class Hr extends Ls{interpolate_(e,t,i,n){const s=super.interpolate_(e,t,i,n);return jr.fromArray(s).normalize().toArray(s),s}}const ze={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},vt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},fs={9728:Ts,9729:Cn,9984:ui,9985:hi,9986:ci,9987:xs},ds={33071:Mn,33648:fi,10497:Nt},An={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Bn={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},tt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Gr={CUBICSPLINE:void 0,LINEAR:Rs,STEP:_i},xn={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Xr(p){return p.DefaultMaterial===void 0&&(p.DefaultMaterial=new Es({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:bi})),p.DefaultMaterial}function ut(p,e,t){for(const i in t.extensions)p[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function Je(p,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(p.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Zr(p,e,t){let i=!1,n=!1,s=!1;for(let c=0,h=e.length;c<h;c++){const l=e[c];if(l.POSITION!==void 0&&(i=!0),l.NORMAL!==void 0&&(n=!0),l.COLOR_0!==void 0&&(s=!0),i&&n&&s)break}if(!i&&!n&&!s)return Promise.resolve(p);const r=[],o=[],a=[];for(let c=0,h=e.length;c<h;c++){const l=e[c];if(i){const f=l.POSITION!==void 0?t.getDependency("accessor",l.POSITION):p.attributes.position;r.push(f)}if(n){const f=l.NORMAL!==void 0?t.getDependency("accessor",l.NORMAL):p.attributes.normal;o.push(f)}if(s){const f=l.COLOR_0!==void 0?t.getDependency("accessor",l.COLOR_0):p.attributes.color;a.push(f)}}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(a)]).then(function(c){const h=c[0],l=c[1],f=c[2];return i&&(p.morphAttributes.position=h),n&&(p.morphAttributes.normal=l),s&&(p.morphAttributes.color=f),p.morphTargetsRelative=!0,p})}function Wr(p,e){if(p.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)p.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(p.morphTargetInfluences.length===t.length){p.morphTargetDictionary={};for(let i=0,n=t.length;i<n;i++)p.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Kr(p){let e;const t=p.extensions&&p.extensions[re.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Tn(t.attributes):e=p.indices+":"+Tn(p.attributes)+":"+p.mode,p.targets!==void 0)for(let i=0,n=p.targets.length;i<n;i++)e+=":"+Tn(p.targets[i]);return e}function Tn(p){let e="";const t=Object.keys(p).sort();for(let i=0,n=t.length;i<n;i++)e+=t[i]+":"+p[t[i]]+";";return e}function Nn(p){switch(p){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Yr(p){return p.search(/\.jpe?g($|\?)/i)>0||p.search(/^data\:image\/jpeg/)===0?"image/jpeg":p.search(/\.webp($|\?)/i)>0||p.search(/^data\:image\/webp/)===0?"image/webp":p.search(/\.ktx2($|\?)/i)>0||p.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const Vr=new he;class qr{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new _r,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,n=-1,s=!1,r=-1;if(typeof navigator<"u"){const o=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(o)===!0;const a=o.match(/Version\/(\d+)/);n=i&&a?parseInt(a[1],10):-1,s=o.indexOf("Firefox")>-1,r=s?o.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&n<17||s&&r<98?this.textureLoader=new As(this.options.manager):this.textureLoader=new ai(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Bt(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,n=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(r){const o={scene:r[0][n.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:n.asset,parser:i,userData:{}};return ut(s,o,n),Je(o,n),Promise.all(i._invokeAll(function(a){return a.afterRoot&&a.afterRoot(o)})).then(function(){for(const a of o.scenes)a.updateMatrixWorld();e(o)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let n=0,s=t.length;n<s;n++){const r=t[n].joints;for(let o=0,a=r.length;o<a;o++)e[r[o]].isBone=!0}for(let n=0,s=e.length;n<s;n++){const r=e[n];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(i[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const n=i.clone(),s=(r,o)=>{const a=this.associations.get(r);a!=null&&this.associations.set(o,a);for(const[c,h]of r.children.entries())s(h,o.children[c])};return s(i,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const n=e(t[i]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let n=0;n<t.length;n++){const s=e(t[n]);s&&i.push(s)}return i}getDependency(e,t){const i=e+":"+t;let n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":n=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(i,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(s,r){return i.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[re.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(s,r){i.load(bt.resolveURL(t.uri,n.path),s,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const n=t.byteLength||0,s=t.byteOffset||0;return i.slice(s,s+n)})}loadAccessor(e){const t=this,i=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const r=An[n.type],o=vt[n.componentType],a=n.normalized===!0,c=new o(n.count*r);return Promise.resolve(new wt(c,r,a))}const s=[];return n.bufferView!==void 0?s.push(this.getDependency("bufferView",n.bufferView)):s.push(null),n.sparse!==void 0&&(s.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(s).then(function(r){const o=r[0],a=An[n.type],c=vt[n.componentType],h=c.BYTES_PER_ELEMENT,l=h*a,f=n.byteOffset||0,u=n.bufferView!==void 0?i.bufferViews[n.bufferView].byteStride:void 0,_=n.normalized===!0;let m,g;if(u&&u!==l){const w=Math.floor(f/u),b="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+w+":"+n.count;let v=t.cache.get(b);v||(m=new c(o,w*u,n.count*u/h),v=new li(m,u/h),t.cache.add(b,v)),g=new wi(v,a,f%u/h,_)}else o===null?m=new c(n.count*a):m=new c(o,f,n.count*a),g=new wt(m,a,_);if(n.sparse!==void 0){const w=An.SCALAR,b=vt[n.sparse.indices.componentType],v=n.sparse.indices.byteOffset||0,T=n.sparse.values.byteOffset||0,S=new b(r[1],v,n.sparse.count*w),M=new c(r[2],T,n.sparse.count*a);o!==null&&(g=new wt(g.array.slice(),g.itemSize,g.normalized)),g.normalized=!1;for(let P=0,z=S.length;P<z;P++){const C=S[P];if(g.setX(C,M[P*a]),a>=2&&g.setY(C,M[P*a+1]),a>=3&&g.setZ(C,M[P*a+2]),a>=4&&g.setW(C,M[P*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}g.normalized=_}return g})}loadTexture(e){const t=this.json,i=this.options,s=t.textures[e].source,r=t.images[s];let o=this.textureLoader;if(r.uri){const a=i.manager.getHandler(r.uri);a!==null&&(o=a)}return this.loadTextureImage(e,s,o)}loadTextureImage(e,t,i){const n=this,s=this.json,r=s.textures[e],o=s.images[t],a=(o.uri||o.bufferView)+":"+r.sampler;if(this.textureCache[a])return this.textureCache[a];const c=this.loadImageSource(t,i).then(function(h){h.flipY=!1,h.name=r.name||o.name||"",h.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(h.name=o.uri);const f=(s.samplers||{})[r.sampler]||{};return h.magFilter=fs[f.magFilter]||Cn,h.minFilter=fs[f.minFilter]||xs,h.wrapS=ds[f.wrapS]||Nt,h.wrapT=ds[f.wrapT]||Nt,h.generateMipmaps=!h.isCompressedTexture&&h.minFilter!==Ts&&h.minFilter!==Cn,n.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[a]=c,c}loadImageSource(e,t){const i=this,n=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(l=>l.clone());const r=n.images[e],o=self.URL||self.webkitURL;let a=r.uri||"",c=!1;if(r.bufferView!==void 0)a=i.getDependency("bufferView",r.bufferView).then(function(l){c=!0;const f=new Blob([l],{type:r.mimeType});return a=o.createObjectURL(f),a});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(a).then(function(l){return new Promise(function(f,u){let _=f;t.isImageBitmapLoader===!0&&(_=function(m){const g=new Dn(m);g.needsUpdate=!0,f(g)}),t.load(bt.resolveURL(l,s.path),_,void 0,u)})}).then(function(l){return c===!0&&o.revokeObjectURL(a),Je(l,r),l.userData.mimeType=r.mimeType||Yr(r.uri),l}).catch(function(l){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),l});return this.sourceCache[e]=h,h}assignTexture(e,t,i,n){const s=this;return this.getDependency("texture",i.index).then(function(r){if(!r)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(r=r.clone(),r.channel=i.texCoord),s.extensions[re.KHR_TEXTURE_TRANSFORM]){const o=i.extensions!==void 0?i.extensions[re.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const a=s.associations.get(r);r=s.extensions[re.KHR_TEXTURE_TRANSFORM].extendTexture(r,o),s.associations.set(r,a)}}return n!==void 0&&(r.colorSpace=n),e[t]=r,r})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const n=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,r=t.attributes.normal===void 0;if(e.isPoints){const o="PointsMaterial:"+i.uuid;let a=this.cache.get(o);a||(a=new di,mn.prototype.copy.call(a,i),a.color.copy(i.color),a.map=i.map,a.sizeAttenuation=!1,this.cache.add(o,a)),i=a}else if(e.isLine){const o="LineBasicMaterial:"+i.uuid;let a=this.cache.get(o);a||(a=new Hn,mn.prototype.copy.call(a,i),a.color.copy(i.color),a.map=i.map,this.cache.add(o,a)),i=a}if(n||s||r){let o="ClonedMaterial:"+i.uuid+":";n&&(o+="derivative-tangents:"),s&&(o+="vertex-colors:"),r&&(o+="flat-shading:");let a=this.cache.get(o);a||(a=i.clone(),s&&(a.vertexColors=!0),r&&(a.flatShading=!0),n&&(a.normalScale&&(a.normalScale.y*=-1),a.clearcoatNormalScale&&(a.clearcoatNormalScale.y*=-1)),this.cache.add(o,a),this.associations.set(a,this.associations.get(i))),i=a}e.material=i}getMaterialType(){return Es}loadMaterial(e){const t=this,i=this.json,n=this.extensions,s=i.materials[e];let r;const o={},a=s.extensions||{},c=[];if(a[re.KHR_MATERIALS_UNLIT]){const l=n[re.KHR_MATERIALS_UNLIT];r=l.getMaterialType(),c.push(l.extendParams(o,s,t))}else{const l=s.pbrMetallicRoughness||{};if(o.color=new Se(1,1,1),o.opacity=1,Array.isArray(l.baseColorFactor)){const f=l.baseColorFactor;o.color.setRGB(f[0],f[1],f[2],Ve),o.opacity=f[3]}l.baseColorTexture!==void 0&&c.push(t.assignTexture(o,"map",l.baseColorTexture,we)),o.metalness=l.metallicFactor!==void 0?l.metallicFactor:1,o.roughness=l.roughnessFactor!==void 0?l.roughnessFactor:1,l.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(o,"metalnessMap",l.metallicRoughnessTexture)),c.push(t.assignTexture(o,"roughnessMap",l.metallicRoughnessTexture))),r=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,o)})))}s.doubleSided===!0&&(o.side=At);const h=s.alphaMode||xn.OPAQUE;if(h===xn.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,h===xn.MASK&&(o.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&r!==dt&&(c.push(t.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new De(1,1),s.normalTexture.scale!==void 0)){const l=s.normalTexture.scale;o.normalScale.set(l,l)}if(s.occlusionTexture!==void 0&&r!==dt&&(c.push(t.assignTexture(o,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&r!==dt){const l=s.emissiveFactor;o.emissive=new Se().setRGB(l[0],l[1],l[2],Ve)}return s.emissiveTexture!==void 0&&r!==dt&&c.push(t.assignTexture(o,"emissiveMap",s.emissiveTexture,we)),Promise.all(c).then(function(){const l=new r(o);return s.name&&(l.name=s.name),Je(l,s),t.associations.set(l,{materials:e}),s.extensions&&ut(n,l,s),l})}createUniqueName(e){const t=Ut.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,n=this.primitiveCache;function s(o){return i[re.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,t).then(function(a){return ps(a,o,t)})}const r=[];for(let o=0,a=e.length;o<a;o++){const c=e[o],h=Kr(c),l=n[h];if(l)r.push(l.promise);else{let f;c.extensions&&c.extensions[re.KHR_DRACO_MESH_COMPRESSION]?f=s(c):f=ps(new at,c,t),n[h]={primitive:c,promise:f},r.push(f)}}return Promise.all(r)}loadMesh(e){const t=this,i=this.json,n=this.extensions,s=i.meshes[e],r=s.primitives,o=[];for(let a=0,c=r.length;a<c;a++){const h=r[a].material===void 0?Xr(this.cache):this.getDependency("material",r[a].material);o.push(h)}return o.push(t.loadGeometries(r)),Promise.all(o).then(function(a){const c=a.slice(0,a.length-1),h=a[a.length-1],l=[];for(let u=0,_=h.length;u<_;u++){const m=h[u],g=r[u];let w;const b=c[u];if(g.mode===ze.TRIANGLES||g.mode===ze.TRIANGLE_STRIP||g.mode===ze.TRIANGLE_FAN||g.mode===void 0)w=s.isSkinnedMesh===!0?new Ss(m,b):new q(m,b),w.isSkinnedMesh===!0&&w.normalizeSkinWeights(),g.mode===ze.TRIANGLE_STRIP?w.geometry=hs(w.geometry,bs):g.mode===ze.TRIANGLE_FAN&&(w.geometry=hs(w.geometry,Pn));else if(g.mode===ze.LINES)w=new pi(m,b);else if(g.mode===ze.LINE_STRIP)w=new Ye(m,b);else if(g.mode===ze.LINE_LOOP)w=new mi(m,b);else if(g.mode===ze.POINTS)w=new gi(m,b);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(w.geometry.morphAttributes).length>0&&Wr(w,s),w.name=t.createUniqueName(s.name||"mesh_"+e),Je(w,s),g.extensions&&ut(n,w,g),t.assignFinalMaterial(w),l.push(w)}for(let u=0,_=l.length;u<_;u++)t.associations.set(l[u],{meshes:e,primitives:u});if(l.length===1)return s.extensions&&ut(n,l[0],s),l[0];const f=new Lt;s.extensions&&ut(n,f,s),t.associations.set(f,{meshes:e});for(let u=0,_=l.length;u<_;u++)f.add(l[u]);return f})}loadCamera(e){let t;const i=this.json.cameras[e],n=i[i.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new Xn(ke.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):i.type==="orthographic"&&(t=new yi(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Je(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let n=0,s=t.joints.length;n<s;n++)i.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(n){const s=n.pop(),r=n,o=[],a=[];for(let c=0,h=r.length;c<h;c++){const l=r[c];if(l){o.push(l);const f=new he;s!==null&&f.fromArray(s.array,c*16),a.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new ks(o,a)})}loadAnimation(e){const t=this.json,i=this,n=t.animations[e],s=n.name?n.name:"animation_"+e,r=[],o=[],a=[],c=[],h=[];for(let l=0,f=n.channels.length;l<f;l++){const u=n.channels[l],_=n.samplers[u.sampler],m=u.target,g=m.node,w=n.parameters!==void 0?n.parameters[_.input]:_.input,b=n.parameters!==void 0?n.parameters[_.output]:_.output;m.node!==void 0&&(r.push(this.getDependency("node",g)),o.push(this.getDependency("accessor",w)),a.push(this.getDependency("accessor",b)),c.push(_),h.push(m))}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(a),Promise.all(c),Promise.all(h)]).then(function(l){const f=l[0],u=l[1],_=l[2],m=l[3],g=l[4],w=[];for(let b=0,v=f.length;b<v;b++){const T=f[b],S=u[b],M=_[b],P=m[b],z=g[b];if(T===void 0)continue;T.updateMatrix&&T.updateMatrix();const C=i._createAnimationTracks(T,S,M,P,z);if(C)for(let H=0;H<C.length;H++)w.push(C[H])}return new Is(s,void 0,w)})}createNodeMesh(e){const t=this.json,i=this,n=t.nodes[e];return n.mesh===void 0?null:i.getDependency("mesh",n.mesh).then(function(s){const r=i._getNodeRef(i.meshCache,n.mesh,s);return n.weights!==void 0&&r.traverse(function(o){if(o.isMesh)for(let a=0,c=n.weights.length;a<c;a++)o.morphTargetInfluences[a]=n.weights[a]}),r})}loadNode(e){const t=this.json,i=this,n=t.nodes[e],s=i._loadNodeShallow(e),r=[],o=n.children||[];for(let c=0,h=o.length;c<h;c++)r.push(i.getDependency("node",o[c]));const a=n.skin===void 0?Promise.resolve(null):i.getDependency("skin",n.skin);return Promise.all([s,Promise.all(r),a]).then(function(c){const h=c[0],l=c[1],f=c[2];f!==null&&h.traverse(function(u){u.isSkinnedMesh&&u.bind(f,Vr)});for(let u=0,_=l.length;u<_;u++)h.add(l[u]);return h})}_loadNodeShallow(e){const t=this.json,i=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],r=s.name?n.createUniqueName(s.name):"",o=[],a=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return a&&o.push(a),s.camera!==void 0&&o.push(n.getDependency("camera",s.camera).then(function(c){return n._getNodeRef(n.cameraCache,s.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){o.push(c)}),this.nodeCache[e]=Promise.all(o).then(function(c){let h;if(s.isBone===!0?h=new Ln:c.length>1?h=new Lt:c.length===1?h=c[0]:h=new $e,h!==c[0])for(let l=0,f=c.length;l<f;l++)h.add(c[l]);if(s.name&&(h.userData.name=s.name,h.name=r),Je(h,s),s.extensions&&ut(i,h,s),s.matrix!==void 0){const l=new he;l.fromArray(s.matrix),h.applyMatrix4(l)}else s.translation!==void 0&&h.position.fromArray(s.translation),s.rotation!==void 0&&h.quaternion.fromArray(s.rotation),s.scale!==void 0&&h.scale.fromArray(s.scale);return n.associations.has(h)||n.associations.set(h,{}),n.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],n=this,s=new Lt;i.name&&(s.name=n.createUniqueName(i.name)),Je(s,i),i.extensions&&ut(t,s,i);const r=i.nodes||[],o=[];for(let a=0,c=r.length;a<c;a++)o.push(n.getDependency("node",r[a]));return Promise.all(o).then(function(a){for(let h=0,l=a.length;h<l;h++)s.add(a[h]);const c=h=>{const l=new Map;for(const[f,u]of n.associations)(f instanceof mn||f instanceof Dn)&&l.set(f,u);return h.traverse(f=>{const u=n.associations.get(f);u!=null&&l.set(f,u)}),l};return n.associations=c(s),s})}_createAnimationTracks(e,t,i,n,s){const r=[],o=e.name?e.name:e.uuid,a=[];tt[s.path]===tt.weights?e.traverse(function(f){f.morphTargetInfluences&&a.push(f.name?f.name:f.uuid)}):a.push(o);let c;switch(tt[s.path]){case tt.weights:c=Fn;break;case tt.rotation:c=cn;break;case tt.position:case tt.scale:c=On;break;default:switch(i.itemSize){case 1:c=Fn;break;case 2:case 3:default:c=On;break}break}const h=n.interpolation!==void 0?Gr[n.interpolation]:Rs,l=this._getArrayFromAccessor(i);for(let f=0,u=a.length;f<u;f++){const _=new c(a[f]+"."+tt[s.path],t.array,l,h);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(_),r.push(_)}return r}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=Nn(t.constructor),n=new Float32Array(t.length);for(let s=0,r=t.length;s<r;s++)n[s]=t[s]*i;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const n=this instanceof cn?Hr:Ls;return new n(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Qr(p,e,t){const i=e.attributes,n=new Ai;if(i.POSITION!==void 0){const o=t.json.accessors[i.POSITION],a=o.min,c=o.max;if(a!==void 0&&c!==void 0){if(n.set(new J(a[0],a[1],a[2]),new J(c[0],c[1],c[2])),o.normalized){const h=Nn(vt[o.componentType]);n.min.multiplyScalar(h),n.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const o=new J,a=new J;for(let c=0,h=s.length;c<h;c++){const l=s[c];if(l.POSITION!==void 0){const f=t.json.accessors[l.POSITION],u=f.min,_=f.max;if(u!==void 0&&_!==void 0){if(a.setX(Math.max(Math.abs(u[0]),Math.abs(_[0]))),a.setY(Math.max(Math.abs(u[1]),Math.abs(_[1]))),a.setZ(Math.max(Math.abs(u[2]),Math.abs(_[2]))),f.normalized){const m=Nn(vt[f.componentType]);a.multiplyScalar(m)}o.max(a)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(o)}p.boundingBox=n;const r=new xi;n.getCenter(r.center),r.radius=n.min.distanceTo(n.max)/2,p.boundingSphere=r}function ps(p,e,t){const i=e.attributes,n=[];function s(r,o){return t.getDependency("accessor",r).then(function(a){p.setAttribute(o,a)})}for(const r in i){const o=Bn[r]||r.toLowerCase();o in p.attributes||n.push(s(i[r],o))}if(e.indices!==void 0&&!p.index){const r=t.getDependency("accessor",e.indices).then(function(o){p.setIndex(o)});n.push(r)}return Ge.workingColorSpace!==Ve&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Ge.workingColorSpace}" not supported.`),Je(p,e),Qr(p,e,t),Promise.all(n).then(function(){return e.targets!==void 0?Zr(p,e.targets,t):p})}const En=new WeakMap;class Ds extends zt{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,n){const s=new Bt(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,r=>{this.parse(r,t,n)},i,n)}parse(e,t,i=()=>{}){this.decodeDracoFile(e,t,null,null,we,i).catch(i)}decodeDracoFile(e,t,i,n,s=Ve,r=()=>{}){const o={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:s};return this.decodeGeometry(e,o).then(t).catch(r)}decodeGeometry(e,t){const i=JSON.stringify(t);if(En.has(e)){const a=En.get(e);if(a.key===i)return a.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const s=this.workerNextTaskID++,r=e.byteLength,o=this._getWorker(s,r).then(a=>(n=a,new Promise((c,h)=>{n._callbacks[s]={resolve:c,reject:h},n.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(a=>this._createGeometry(a.geometry));return o.catch(()=>!0).then(()=>{n&&s&&this._releaseTask(n,s)}),En.set(e,{key:i,promise:o}),o}_createGeometry(e){const t=new at;e.index&&t.setIndex(new wt(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const n=e.attributes[i],s=n.name,r=n.array,o=n.itemSize,a=new wt(r,o);s==="color"&&(this._assignVertexColorSpace(a,n.vertexColorSpace),a.normalized=!(r instanceof Float32Array)),t.setAttribute(s,a)}return t}_assignVertexColorSpace(e,t){if(t!==we)return;const i=new Se;for(let n=0,s=e.count;n<s;n++)i.fromBufferAttribute(e,n),Ge.toWorkingColorSpace(i,we),e.setXYZ(n,i.r,i.g,i.b)}_loadLibrary(e,t){const i=new Bt(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((n,s)=>{i.load(e,n,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const n=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const s=Jr.toString(),r=["/* draco decoder */",n,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(s){const r=s.data;switch(r.type){case"decode":n._callbacks[r.id].resolve(r);break;case"error":n._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,s){return n._taskLoad>s._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function Jr(){let p,e;onmessage=function(r){const o=r.data;switch(o.type){case"init":p=o.decoderConfig,e=new Promise(function(h){p.onModuleLoaded=function(l){h({draco:l})},DracoDecoderModule(p)});break;case"decode":const a=o.buffer,c=o.taskConfig;e.then(h=>{const l=h.draco,f=new l.Decoder;try{const u=t(l,f,new Int8Array(a),c),_=u.attributes.map(m=>m.array.buffer);u.index&&_.push(u.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:u},_)}catch(u){console.error(u),self.postMessage({type:"error",id:o.id,error:u.message})}finally{l.destroy(f)}});break}};function t(r,o,a,c){const h=c.attributeIDs,l=c.attributeTypes;let f,u;const _=o.GetEncodedGeometryType(a);if(_===r.TRIANGULAR_MESH)f=new r.Mesh,u=o.DecodeArrayToMesh(a,a.byteLength,f);else if(_===r.POINT_CLOUD)f=new r.PointCloud,u=o.DecodeArrayToPointCloud(a,a.byteLength,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!u.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+u.error_msg());const m={index:null,attributes:[]};for(const g in h){const w=self[l[g]];let b,v;if(c.useUniqueIDs)v=h[g],b=o.GetAttributeByUniqueId(f,v);else{if(v=o.GetAttributeId(f,r[h[g]]),v===-1)continue;b=o.GetAttribute(f,v)}const T=n(r,o,f,g,w,b);g==="color"&&(T.vertexColorSpace=c.vertexColorSpace),m.attributes.push(T)}return _===r.TRIANGULAR_MESH&&(m.index=i(r,o,f)),r.destroy(f),m}function i(r,o,a){const h=a.num_faces()*3,l=h*4,f=r._malloc(l);o.GetTrianglesUInt32Array(a,l,f);const u=new Uint32Array(r.HEAPF32.buffer,f,h).slice();return r._free(f),{array:u,itemSize:1}}function n(r,o,a,c,h,l){const f=l.num_components(),_=a.num_points()*f,m=_*h.BYTES_PER_ELEMENT,g=s(r,h),w=r._malloc(m);o.GetAttributeDataArrayForAllPoints(a,l,g,m,w);const b=new h(r.HEAPF32.buffer,w,_).slice();return r._free(w),{name:c,array:b,itemSize:f}}function s(r,o){switch(o){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32}}}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var Ue=Uint8Array,gt=Uint16Array,$r=Int32Array,Os=new Ue([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Fs=new Ue([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),eo=new Ue([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zs=function(p,e){for(var t=new gt(31),i=0;i<31;++i)t[i]=e+=1<<p[i-1];for(var n=new $r(t[30]),i=1;i<30;++i)for(var s=t[i];s<t[i+1];++s)n[s]=s-t[i]<<5|i;return{b:t,r:n}},Bs=zs(Os,2),Ns=Bs.b,to=Bs.r;Ns[28]=258,to[258]=28;var no=zs(Fs,0),so=no.b,Un=new gt(32768);for(var de=0;de<32768;++de){var nt=(de&43690)>>1|(de&21845)<<1;nt=(nt&52428)>>2|(nt&13107)<<2,nt=(nt&61680)>>4|(nt&3855)<<4,Un[de]=((nt&65280)>>8|(nt&255)<<8)>>1}var Dt=(function(p,e,t){for(var i=p.length,n=0,s=new gt(e);n<i;++n)p[n]&&++s[p[n]-1];var r=new gt(e);for(n=1;n<e;++n)r[n]=r[n-1]+s[n-1]<<1;var o;if(t){o=new gt(1<<e);var a=15-e;for(n=0;n<i;++n)if(p[n])for(var c=n<<4|p[n],h=e-p[n],l=r[p[n]-1]++<<h,f=l|(1<<h)-1;l<=f;++l)o[Un[l]>>a]=c}else for(o=new gt(i),n=0;n<i;++n)p[n]&&(o[n]=Un[r[p[n]-1]++]>>15-p[n]);return o}),Gt=new Ue(288);for(var de=0;de<144;++de)Gt[de]=8;for(var de=144;de<256;++de)Gt[de]=9;for(var de=256;de<280;++de)Gt[de]=7;for(var de=280;de<288;++de)Gt[de]=8;var Us=new Ue(32);for(var de=0;de<32;++de)Us[de]=5;var io=Dt(Gt,9,1),ro=Dt(Us,5,1),Sn=function(p){for(var e=p[0],t=1;t<p.length;++t)p[t]>e&&(e=p[t]);return e},je=function(p,e,t){var i=e/8|0;return(p[i]|p[i+1]<<8)>>(e&7)&t},kn=function(p,e){var t=e/8|0;return(p[t]|p[t+1]<<8|p[t+2]<<16)>>(e&7)},oo=function(p){return(p+7)/8|0},ao=function(p,e,t){return(t==null||t>p.length)&&(t=p.length),new Ue(p.subarray(e,t))},lo=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],He=function(p,e,t){var i=new Error(e||lo[p]);if(i.code=p,Error.captureStackTrace&&Error.captureStackTrace(i,He),!t)throw i;return i},co=function(p,e,t,i){var n=p.length,s=0;if(!n||e.f&&!e.l)return t||new Ue(0);var r=!t,o=r||e.i!=2,a=e.i;r&&(t=new Ue(n*3));var c=function(pe){var Oe=t.length;if(pe>Oe){var Ce=new Ue(Math.max(Oe*2,pe));Ce.set(t),t=Ce}},h=e.f||0,l=e.p||0,f=e.b||0,u=e.l,_=e.d,m=e.m,g=e.n,w=n*8;do{if(!u){h=je(p,l,1);var b=je(p,l+1,3);if(l+=3,b)if(b==1)u=io,_=ro,m=9,g=5;else if(b==2){var M=je(p,l,31)+257,P=je(p,l+10,15)+4,z=M+je(p,l+5,31)+1;l+=14;for(var C=new Ue(z),H=new Ue(19),K=0;K<P;++K)H[eo[K]]=je(p,l+K*3,7);l+=P*3;for(var E=Sn(H),F=(1<<E)-1,y=Dt(H,E,1),K=0;K<z;){var O=y[je(p,l,F)];l+=O&15;var v=O>>4;if(v<16)C[K++]=v;else{var $=0,U=0;for(v==16?(U=3+je(p,l,3),l+=2,$=C[K-1]):v==17?(U=3+je(p,l,7),l+=3):v==18&&(U=11+je(p,l,127),l+=7);U--;)C[K++]=$}}var ne=C.subarray(0,M),N=C.subarray(M);m=Sn(ne),g=Sn(N),u=Dt(ne,m,1),_=Dt(N,g,1)}else He(1);else{var v=oo(l)+4,T=p[v-4]|p[v-3]<<8,S=v+T;if(S>n){a&&He(0);break}o&&c(f+T),t.set(p.subarray(v,S),f),e.b=f+=T,e.p=l=S*8,e.f=h;continue}if(l>w){a&&He(0);break}}o&&c(f+131072);for(var ee=(1<<m)-1,L=(1<<g)-1,I=l;;I=l){var $=u[kn(p,l)&ee],Q=$>>4;if(l+=$&15,l>w){a&&He(0);break}if($||He(2),Q<256)t[f++]=Q;else if(Q==256){I=l,u=null;break}else{var Y=Q-254;if(Q>264){var K=Q-257,Z=Os[K];Y=je(p,l,(1<<Z)-1)+Ns[K],l+=Z}var fe=_[kn(p,l)&L],ve=fe>>4;fe||He(3),l+=fe&15;var N=so[ve];if(ve>3){var Z=Fs[ve];N+=kn(p,l)&(1<<Z)-1,l+=Z}if(l>w){a&&He(0);break}o&&c(f+131072);var ie=f+Y;if(f<N){var ae=s-N,Ae=Math.min(N,ie);for(ae+f<0&&He(3);f<Ae;++f)t[f]=i[ae+f]}for(;f<ie;++f)t[f]=t[f-N]}}e.l=u,e.p=I,e.b=f,e.f=h,u&&(h=1,e.m=m,e.d=_,e.n=g)}while(!h);return f!=t.length&&r?ao(t,0,f):t.subarray(0,f)},ho=new Ue(0),uo=function(p,e){return((p[0]&15)!=8||p[0]>>4>7||(p[0]<<8|p[1])%31)&&He(6,"invalid zlib data"),(p[1]>>5&1)==1&&He(6,"invalid zlib data: "+(p[1]&32?"need":"unexpected")+" dictionary"),(p[1]>>3&4)+2};function fo(p,e){return co(p.subarray(uo(p),-4),{i:2},e,e)}var po=typeof TextDecoder<"u"&&new TextDecoder,mo=0;try{po.decode(ho,{stream:!0}),mo=1}catch{}function js(p,e,t){const i=t.length-p-1;if(e>=t[i])return i-1;if(e<=t[p])return p;let n=p,s=i,r=Math.floor((n+s)/2);for(;e<t[r]||e>=t[r+1];)e<t[r]?s=r:n=r,r=Math.floor((n+s)/2);return r}function go(p,e,t,i){const n=[],s=[],r=[];n[0]=1;for(let o=1;o<=t;++o){s[o]=e-i[p+1-o],r[o]=i[p+o]-e;let a=0;for(let c=0;c<o;++c){const h=r[c+1],l=s[o-c],f=n[c]/(h+l);n[c]=a+h*f,a=l*f}n[o]=a}return n}function yo(p,e,t,i){const n=js(p,i,e),s=go(n,i,p,e),r=new jt(0,0,0,0);for(let o=0;o<=p;++o){const a=t[n-p+o],c=s[o],h=a.w*c;r.x+=a.x*h,r.y+=a.y*h,r.z+=a.z*h,r.w+=a.w*c}return r}function _o(p,e,t,i,n){const s=[];for(let l=0;l<=t;++l)s[l]=0;const r=[];for(let l=0;l<=i;++l)r[l]=s.slice(0);const o=[];for(let l=0;l<=t;++l)o[l]=s.slice(0);o[0][0]=1;const a=s.slice(0),c=s.slice(0);for(let l=1;l<=t;++l){a[l]=e-n[p+1-l],c[l]=n[p+l]-e;let f=0;for(let u=0;u<l;++u){const _=c[u+1],m=a[l-u];o[l][u]=_+m;const g=o[u][l-1]/o[l][u];o[u][l]=f+_*g,f=m*g}o[l][l]=f}for(let l=0;l<=t;++l)r[0][l]=o[l][t];for(let l=0;l<=t;++l){let f=0,u=1;const _=[];for(let m=0;m<=t;++m)_[m]=s.slice(0);_[0][0]=1;for(let m=1;m<=i;++m){let g=0;const w=l-m,b=t-m;l>=m&&(_[u][0]=_[f][0]/o[b+1][w],g=_[u][0]*o[w][b]);const v=w>=-1?1:-w,T=l-1<=b?m-1:t-l;for(let M=v;M<=T;++M)_[u][M]=(_[f][M]-_[f][M-1])/o[b+1][w+M],g+=_[u][M]*o[w+M][b];l<=b&&(_[u][m]=-_[f][m-1]/o[b+1][l],g+=_[u][m]*o[l][b]),r[m][l]=g;const S=f;f=u,u=S}}let h=t;for(let l=1;l<=i;++l){for(let f=0;f<=t;++f)r[l][f]*=h;h*=t-l}return r}function wo(p,e,t,i,n){const s=n<p?n:p,r=[],o=js(p,i,e),a=_o(o,i,p,s,e),c=[];for(let h=0;h<t.length;++h){const l=t[h].clone(),f=l.w;l.x*=f,l.y*=f,l.z*=f,c[h]=l}for(let h=0;h<=s;++h){const l=c[o-p].clone().multiplyScalar(a[h][0]);for(let f=1;f<=p;++f)l.add(c[o-p+f].clone().multiplyScalar(a[h][f]));r[h]=l}for(let h=s+1;h<=n+1;++h)r[h]=new jt(0,0,0);return r}function bo(p,e){let t=1;for(let n=2;n<=p;++n)t*=n;let i=1;for(let n=2;n<=e;++n)i*=n;for(let n=2;n<=p-e;++n)i*=n;return t/i}function vo(p){const e=p.length,t=[],i=[];for(let s=0;s<e;++s){const r=p[s];t[s]=new J(r.x,r.y,r.z),i[s]=r.w}const n=[];for(let s=0;s<e;++s){const r=t[s].clone();for(let o=1;o<=s;++o)r.sub(n[s-o].clone().multiplyScalar(bo(s,o)*i[o]));n[s]=r.divideScalar(i[0])}return n}function Ao(p,e,t,i,n){const s=wo(p,e,t,i,n);return vo(s)}class xo extends Ti{constructor(e,t,i,n,s){super();const r=t?t.length-1:0,o=i?i.length:0;this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=n||0,this.endKnot=s||r;for(let a=0;a<o;++a){const c=i[a];this.controlPoints[a]=new jt(c.x,c.y,c.z,c.w)}}getPoint(e,t=new J){const i=t,n=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=yo(this.degree,this.knots,this.controlPoints,n);return s.w!==1&&s.divideScalar(s.w),i.set(s.x,s.y,s.z)}getTangent(e,t=new J){const i=t,n=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=Ao(this.degree,this.knots,this.controlPoints,n,1);return i.copy(s[1]).normalize(),i}toJSON(){const e=super.toJSON();return e.degree=this.degree,e.knots=[...this.knots],e.controlPoints=this.controlPoints.map(t=>t.toArray()),e.startKnot=this.startKnot,e.endKnot=this.endKnot,e}fromJSON(e){return super.fromJSON(e),this.degree=e.degree,this.knots=[...e.knots],this.controlPoints=e.controlPoints.map(t=>new jt(t[0],t[1],t[2],t[3])),this.startKnot=e.startKnot,this.endKnot=e.endKnot,this}}let se,be,Pe;class To extends zt{constructor(e){super(e)}load(e,t,i,n){const s=this,r=s.path===""?bt.extractUrlBase(e):s.path,o=new Bt(this.manager);o.setPath(s.path),o.setResponseType("arraybuffer"),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(a,r))}catch(c){n?n(c):console.error(c),s.manager.itemError(e)}},i,n)}parse(e,t){if(Po(e))se=new Ro().parse(e);else{const n=Xs(e);if(!Co(n))throw new Error("THREE.FBXLoader: Unknown format.");if(gs(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+gs(n));se=new Io().parse(n)}const i=new As(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Eo(i,this.manager).parse(se)}}class Eo{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){be=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),n=this.parseDeformers(),s=new So().parse(n);return this.parseScene(n,s,i),Pe}parseConnections(){const e=new Map;return"Connections"in se&&se.Connections.connections.forEach(function(i){const n=i[0],s=i[1],r=i[2];e.has(n)||e.set(n,{parents:[],children:[]});const o={ID:s,relationship:r};e.get(n).parents.push(o),e.has(s)||e.set(s,{parents:[],children:[]});const a={ID:n,relationship:r};e.get(s).children.push(a)}),e}parseImages(){const e={},t={};if("Video"in se.Objects){const i=se.Objects.Video;for(const n in i){const s=i[n],r=parseInt(n);if(e[r]=s.RelativeFilename||s.Filename,"Content"in s){const o=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,a=typeof s.Content=="string"&&s.Content!=="";if(o||a){const c=this.parseImage(i[n]);t[s.RelativeFilename||s.Filename]=c}}}}for(const i in e){const n=e[i];t[n]!==void 0?e[i]=t[n]:e[i]=e[i].split("\\").pop()}return e}parseImage(e){const t=e.Content,i=e.RelativeFilename||e.Filename,n=i.slice(i.lastIndexOf(".")+1).toLowerCase();let s;switch(n){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",i),s="image/tga";break;default:console.warn('FBXLoader: Image type "'+n+'" is not supported.');return}if(typeof t=="string")return"data:"+s+";base64,"+t;{const r=new Uint8Array(t);return window.URL.createObjectURL(new Blob([r],{type:s}))}}parseTextures(e){const t=new Map;if("Texture"in se.Objects){const i=se.Objects.Texture;for(const n in i){const s=this.parseTexture(i[n],e);t.set(parseInt(n),s)}}return t}parseTexture(e,t){const i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;const n=e.WrapModeU,s=e.WrapModeV,r=n!==void 0?n.value:0,o=s!==void 0?s.value:0;if(i.wrapS=r===0?Nt:Mn,i.wrapT=o===0?Nt:Mn,"Scaling"in e){const a=e.Scaling.value;i.repeat.x=a[0],i.repeat.y=a[1]}if("Translation"in e){const a=e.Translation.value;i.offset.x=a[0],i.offset.y=a[1]}return i}loadTexture(e,t){const i=new Set(["tga","tif","tiff","exr","dds","hdr","ktx2"]),n=e.FileName.split(".").pop().toLowerCase(),s=i.has(n)?this.manager.getHandler(`.${n}`):this.textureLoader;if(!s)return console.warn(`FBXLoader: ${n.toUpperCase()} loader not found, creating placeholder texture for`,e.RelativeFilename),new Dn;const r=s.path;r||s.setPath(this.textureLoader.path);const o=be.get(e.id).children;let a;o!==void 0&&o.length>0&&t[o[0].ID]!==void 0&&(a=t[o[0].ID],(a.indexOf("blob:")===0||a.indexOf("data:")===0)&&s.setPath(void 0));const c=s.load(a);return s.setPath(r),c}parseMaterials(e){const t=new Map;if("Material"in se.Objects){const i=se.Objects.Material;for(const n in i){const s=this.parseMaterial(i[n],e);s!==null&&t.set(parseInt(n),s)}}return t}parseMaterial(e,t){const i=e.id,n=e.attrName;let s=e.ShadingModel;if(typeof s=="object"&&(s=s.value),!be.has(i))return null;const r=this.parseParameters(e,t,i);let o;switch(s.toLowerCase()){case"phong":o=new gn;break;case"lambert":o=new Ei;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),o=new gn;break}return o.setValues(r),o.name=n,o}parseParameters(e,t,i){const n={};e.BumpFactor&&(n.bumpScale=e.BumpFactor.value),e.Diffuse?n.color=Ge.toWorkingColorSpace(new Se().fromArray(e.Diffuse.value),we):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(n.color=Ge.toWorkingColorSpace(new Se().fromArray(e.DiffuseColor.value),we)),e.DisplacementFactor&&(n.displacementScale=e.DisplacementFactor.value),e.Emissive?n.emissive=Ge.toWorkingColorSpace(new Se().fromArray(e.Emissive.value),we):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(n.emissive=Ge.toWorkingColorSpace(new Se().fromArray(e.EmissiveColor.value),we)),e.EmissiveFactor&&(n.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),n.opacity=1-(e.TransparencyFactor?parseFloat(e.TransparencyFactor.value):0),(n.opacity===1||n.opacity===0)&&(n.opacity=e.Opacity?parseFloat(e.Opacity.value):null,n.opacity===null&&(n.opacity=1-(e.TransparentColor?parseFloat(e.TransparentColor.value[0]):0))),n.opacity<1&&(n.transparent=!0),e.ReflectionFactor&&(n.reflectivity=e.ReflectionFactor.value),e.Shininess&&(n.shininess=e.Shininess.value),e.Specular?n.specular=Ge.toWorkingColorSpace(new Se().fromArray(e.Specular.value),we):e.SpecularColor&&e.SpecularColor.type==="Color"&&(n.specular=Ge.toWorkingColorSpace(new Se().fromArray(e.SpecularColor.value),we));const s=this;return be.get(i).children.forEach(function(r){const o=r.relationship;switch(o){case"Bump":n.bumpMap=s.getTexture(t,r.ID);break;case"Maya|TEX_ao_map":n.aoMap=s.getTexture(t,r.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":n.map=s.getTexture(t,r.ID),n.map!==void 0&&(n.map.colorSpace=we);break;case"DisplacementColor":n.displacementMap=s.getTexture(t,r.ID);break;case"EmissiveColor":n.emissiveMap=s.getTexture(t,r.ID),n.emissiveMap!==void 0&&(n.emissiveMap.colorSpace=we);break;case"NormalMap":case"Maya|TEX_normal_map":n.normalMap=s.getTexture(t,r.ID);break;case"ReflectionColor":n.envMap=s.getTexture(t,r.ID),n.envMap!==void 0&&(n.envMap.mapping=Si,n.envMap.colorSpace=we);break;case"SpecularColor":n.specularMap=s.getTexture(t,r.ID),n.specularMap!==void 0&&(n.specularMap.colorSpace=we);break;case"TransparentColor":case"TransparencyFactor":n.alphaMap=s.getTexture(t,r.ID),n.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",o);break}}),n}getTexture(e,t){return"LayeredTexture"in se.Objects&&t in se.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=be.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in se.Objects){const i=se.Objects.Deformer;for(const n in i){const s=i[n],r=be.get(parseInt(n));if(s.attrType==="Skin"){const o=this.parseSkeleton(r,i);o.ID=n,r.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),o.geometryID=r.parents[0].ID,e[n]=o}else if(s.attrType==="BlendShape"){const o={id:n};o.rawTargets=this.parseMorphTargets(r,i),o.id=n,r.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[n]=o}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const i=[];return e.children.forEach(function(n){const s=t[n.ID];if(s.attrType!=="Cluster")return;const r={ID:n.ID,indices:[],weights:[],transformLink:new he().fromArray(s.TransformLink.a)};"Indexes"in s&&(r.indices=s.Indexes.a,r.weights=s.Weights.a),i.push(r)}),{rawBones:i,bones:[]}}parseMorphTargets(e,t){const i=[];for(let n=0;n<e.children.length;n++){const s=e.children[n],r=t[s.ID],o={name:r.attrName,initialWeight:r.DeformPercent,id:r.id,fullWeights:r.FullWeights.a};if(r.attrType!=="BlendShapeChannel")return;o.geoID=be.get(parseInt(s.ID)).children.filter(function(a){return a.relationship===void 0})[0].ID,i.push(o)}return i}parseScene(e,t,i){Pe=new Lt;const n=this.parseModels(e.skeletons,t,i),s=se.Objects.Model,r=this;n.forEach(function(a){const c=s[a.ID];r.setLookAtProperties(a,c),be.get(a.ID).parents.forEach(function(l){const f=n.get(l.ID);f!==void 0&&f.add(a)}),a.parent===null&&Pe.add(a)}),this.bindSkeleton(e.skeletons,t,n),this.addGlobalSceneSettings(),Pe.traverse(function(a){if(a.userData.transformData){a.parent&&(a.userData.transformData.parentMatrix=a.parent.matrix,a.userData.transformData.parentMatrixWorld=a.parent.matrixWorld);const c=Gs(a.userData.transformData);a.applyMatrix4(c),a.updateWorldMatrix()}});const o=new ko().parse();Pe.children.length===1&&Pe.children[0].isGroup&&(Pe.children[0].animations=o,Pe=Pe.children[0]),Pe.animations=o}parseModels(e,t,i){const n=new Map,s=se.Objects.Model;for(const r in s){const o=parseInt(r),a=s[r],c=be.get(o);let h=this.buildSkeleton(c,e,o,a.attrName);if(!h){switch(a.attrType){case"Camera":h=this.createCamera(c);break;case"Light":h=this.createLight(c);break;case"Mesh":h=this.createMesh(c,t,i);break;case"NurbsCurve":h=this.createCurve(c,t);break;case"LimbNode":case"Root":h=new Ln;break;case"Null":default:h=new Lt;break}h.name=a.attrName?Ut.sanitizeNodeName(a.attrName):"",h.userData.originalName=a.attrName,h.ID=o}this.getTransformData(h,a),n.set(o,h)}return n}buildSkeleton(e,t,i,n){let s=null;return e.parents.forEach(function(r){for(const o in t){const a=t[o];a.rawBones.forEach(function(c,h){if(c.ID===r.ID){const l=s;s=new Ln,s.matrixWorld.copy(c.transformLink),s.name=n?Ut.sanitizeNodeName(n):"",s.userData.originalName=n,s.ID=i,a.bones[h]=s,l!==null&&s.add(l)}})}}),s}createCamera(e){let t,i;if(e.children.forEach(function(n){const s=se.Objects.NodeAttribute[n.ID];s!==void 0&&(i=s)}),i===void 0)t=new $e;else{let n=0;i.CameraProjectionType!==void 0&&i.CameraProjectionType.value===1&&(n=1);let s=1;i.NearPlane!==void 0&&(s=i.NearPlane.value/1e3);let r=1e3;i.FarPlane!==void 0&&(r=i.FarPlane.value/1e3);let o=window.innerWidth,a=window.innerHeight;i.AspectWidth!==void 0&&i.AspectHeight!==void 0&&(o=i.AspectWidth.value,a=i.AspectHeight.value);const c=o/a;let h=45;i.FieldOfView!==void 0&&(h=i.FieldOfView.value);const l=i.FocalLength?i.FocalLength.value:null;switch(n){case 0:t=new Xn(h,c,s,r),l!==null&&t.setFocalLength(l);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),t=new $e;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+n+"."),t=new $e;break}}return t}createLight(e){let t,i;if(e.children.forEach(function(n){const s=se.Objects.NodeAttribute[n.ID];s!==void 0&&(i=s)}),i===void 0)t=new $e;else{let n;i.LightType===void 0?n=0:n=i.LightType.value;let s=16777215;i.Color!==void 0&&(s=Ge.toWorkingColorSpace(new Se().fromArray(i.Color.value),we));let r=i.Intensity===void 0?1:i.Intensity.value/100;i.CastLightOnObject!==void 0&&i.CastLightOnObject.value===0&&(r=0);let o=0;i.FarAttenuationEnd!==void 0&&(i.EnableFarAttenuation!==void 0&&i.EnableFarAttenuation.value===0?o=0:o=i.FarAttenuationEnd.value);const a=1;switch(n){case 0:t=new ln(s,r,o,a);break;case 1:t=new Gn(s,r);break;case 2:let c=Math.PI/3;i.InnerAngle!==void 0&&(c=ke.degToRad(i.InnerAngle.value));let h=0;i.OuterAngle!==void 0&&(h=ke.degToRad(i.OuterAngle.value),h=Math.max(h,1)),t=new vs(s,r,o,c,h,a);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),t=new ln(s,r);break}i.CastShadows!==void 0&&i.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,i){let n,s=null,r=null;const o=[];return e.children.forEach(function(a){t.has(a.ID)&&(s=t.get(a.ID)),i.has(a.ID)&&o.push(i.get(a.ID))}),o.length>1?r=o:o.length>0?r=o[0]:(r=new gn({name:zt.DEFAULT_MATERIAL_NAME,color:13421772}),o.push(r)),"color"in s.attributes&&o.forEach(function(a){a.vertexColors=!0}),s.FBX_Deformer?(n=new Ss(s,r),n.normalizeSkinWeights()):n=new q(s,r),n}createCurve(e,t){const i=e.children.reduce(function(s,r){return t.has(r.ID)&&(s=t.get(r.ID)),s},null),n=new Hn({name:zt.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new Ye(i,n)}getTransformData(e,t){const i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?i.eulerOrder=Ht(t.RotationOrder.value):i.eulerOrder=Ht(0),"Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(e,t){"LookAtProperty"in t&&be.get(e.ID).children.forEach(function(n){if(n.relationship==="LookAtProperty"){const s=se.Objects.Model[n.ID];if("Lcl_Translation"in s){const r=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(r),Pe.add(e.target)):e.lookAt(new J().fromArray(r))}}})}bindSkeleton(e,t,i){const n=this.parsePoseNodes();for(const s in e){const r=e[s];be.get(parseInt(r.ID)).parents.forEach(function(a){if(t.has(a.ID)){const c=a.ID;be.get(c).parents.forEach(function(l){i.has(l.ID)&&i.get(l.ID).bind(new ks(r.bones),n[l.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in se.Objects){const t=se.Objects.Pose;for(const i in t)if(t[i].attrType==="BindPose"&&t[i].NbPoseNodes>0){const n=t[i].PoseNode;Array.isArray(n)?n.forEach(function(s){e[s.Node]=new he().fromArray(s.Matrix.a)}):e[n.Node]=new he().fromArray(n.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in se){if("AmbientColor"in se.GlobalSettings){const e=se.GlobalSettings.AmbientColor.value,t=e[0],i=e[1],n=e[2];if(t!==0||i!==0||n!==0){const s=new Se().setRGB(t,i,n,we);Pe.add(new Ps(s,1))}}"UnitScaleFactor"in se.GlobalSettings&&(Pe.userData.unitScaleFactor=se.GlobalSettings.UnitScaleFactor.value)}}}class So{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in se.Objects){const i=se.Objects.Geometry;for(const n in i){const s=be.get(parseInt(n)),r=this.parseGeometry(s,i[n],e);t.set(parseInt(n),r)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,i){const n=i.skeletons,s=[],r=e.parents.map(function(l){return se.Objects.Model[l.ID]});if(r.length===0)return;const o=e.children.reduce(function(l,f){return n[f.ID]!==void 0&&(l=n[f.ID]),l},null);e.children.forEach(function(l){i.morphTargets[l.ID]!==void 0&&s.push(i.morphTargets[l.ID])});const a=r[0],c={};"RotationOrder"in a&&(c.eulerOrder=Ht(a.RotationOrder.value)),"InheritType"in a&&(c.inheritType=parseInt(a.InheritType.value)),"GeometricTranslation"in a&&(c.translation=a.GeometricTranslation.value),"GeometricRotation"in a&&(c.rotation=a.GeometricRotation.value),"GeometricScaling"in a&&(c.scale=a.GeometricScaling.value);const h=Gs(c);return this.genGeometry(t,o,s,h)}genGeometry(e,t,i,n){const s=new at;e.attrName&&(s.name=e.attrName);const r=this.parseGeoNode(e,t),o=this.genBuffers(r),a=new st(o.vertex,3);if(a.applyMatrix4(n),s.setAttribute("position",a),o.colors.length>0&&s.setAttribute("color",new st(o.colors,3)),t&&(s.setAttribute("skinIndex",new ki(o.weightsIndices,4)),s.setAttribute("skinWeight",new st(o.vertexWeights,4)),s.FBX_Deformer=t),o.normal.length>0){const c=new Ii().getNormalMatrix(n),h=new st(o.normal,3);h.applyNormalMatrix(c),s.setAttribute("normal",h)}if(o.uvs.forEach(function(c,h){const l=h===0?"uv":`uv${h}`;s.setAttribute(l,new st(o.uvs[h],2))}),r.material&&r.material.mappingType!=="AllSame"){let c=o.materialIndex[0],h=0;if(o.materialIndex.forEach(function(l,f){l!==c&&(s.addGroup(h,f-h,c),c=l,h=f)}),s.groups.length>0){const l=s.groups[s.groups.length-1],f=l.start+l.count;f!==o.materialIndex.length&&s.addGroup(f,o.materialIndex.length-f,c)}s.groups.length===0&&s.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(s,e,i,n),s}parseGeoNode(e,t){const i={};if(i.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],i.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];let n=0;for(;e.LayerElementUV[n];)e.LayerElementUV[n].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[n])),n++}return i.weightTable={},t!==null&&(i.skeleton=t,t.rawBones.forEach(function(n,s){n.indices.forEach(function(r,o){i.weightTable[r]===void 0&&(i.weightTable[r]=[]),i.weightTable[r].push({id:s,weight:n.weights[o]})})})),i}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let i=0,n=0,s=!1,r=[],o=[],a=[],c=[],h=[],l=[];const f=this;return e.vertexIndices.forEach(function(u,_){let m,g=!1;u<0&&(u=u^-1,g=!0);let w=[],b=[];if(r.push(u*3,u*3+1,u*3+2),e.color){const v=en(_,i,u,e.color);a.push(v[0],v[1],v[2])}if(e.skeleton){if(e.weightTable[u]!==void 0&&e.weightTable[u].forEach(function(v){b.push(v.weight),w.push(v.id)}),b.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const v=[0,0,0,0],T=[0,0,0,0];b.forEach(function(S,M){let P=S,z=w[M];T.forEach(function(C,H,K){if(P>C){K[H]=P,P=C;const E=v[H];v[H]=z,z=E}})}),w=v,b=T}for(;b.length<4;)b.push(0),w.push(0);for(let v=0;v<4;++v)h.push(b[v]),l.push(w[v])}if(e.normal){const v=en(_,i,u,e.normal);o.push(v[0],v[1],v[2])}e.material&&e.material.mappingType!=="AllSame"&&(m=en(_,i,u,e.material)[0],m<0&&(f.negativeMaterialIndices=!0,m=0)),e.uv&&e.uv.forEach(function(v,T){const S=en(_,i,u,v);c[T]===void 0&&(c[T]=[]),c[T].push(S[0]),c[T].push(S[1])}),n++,g&&(f.genFace(t,e,r,m,o,a,c,h,l,n),i++,n=0,r=[],o=[],a=[],c=[],h=[],l=[])}),t}getNormalNewell(e){const t=new J(0,0,0);for(let i=0;i<e.length;i++){const n=e[i],s=e[(i+1)%e.length];t.x+=(n.y-s.y)*(n.z+s.z),t.y+=(n.z-s.z)*(n.x+s.x),t.z+=(n.x-s.x)*(n.y+s.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),n=(Math.abs(t.z)>.5?new J(0,1,0):new J(0,0,1)).cross(t).normalize(),s=t.clone().cross(n).normalize();return{normal:t,tangent:n,bitangent:s}}flattenVertex(e,t,i){return new De(e.dot(t),e.dot(i))}genFace(e,t,i,n,s,r,o,a,c,h){let l;if(h>3){const f=[],u=t.baseVertexPositions||t.vertexPositions;for(let w=0;w<i.length;w+=3)f.push(new J(u[i[w]],u[i[w+1]],u[i[w+2]]));const{tangent:_,bitangent:m}=this.getNormalTangentAndBitangent(f),g=[];for(const w of f)g.push(this.flattenVertex(w,_,m));l=Ri.triangulateShape(g,[])}else l=[[0,1,2]];for(const[f,u,_]of l)e.vertex.push(t.vertexPositions[i[f*3]]),e.vertex.push(t.vertexPositions[i[f*3+1]]),e.vertex.push(t.vertexPositions[i[f*3+2]]),e.vertex.push(t.vertexPositions[i[u*3]]),e.vertex.push(t.vertexPositions[i[u*3+1]]),e.vertex.push(t.vertexPositions[i[u*3+2]]),e.vertex.push(t.vertexPositions[i[_*3]]),e.vertex.push(t.vertexPositions[i[_*3+1]]),e.vertex.push(t.vertexPositions[i[_*3+2]]),t.skeleton&&(e.vertexWeights.push(a[f*4]),e.vertexWeights.push(a[f*4+1]),e.vertexWeights.push(a[f*4+2]),e.vertexWeights.push(a[f*4+3]),e.vertexWeights.push(a[u*4]),e.vertexWeights.push(a[u*4+1]),e.vertexWeights.push(a[u*4+2]),e.vertexWeights.push(a[u*4+3]),e.vertexWeights.push(a[_*4]),e.vertexWeights.push(a[_*4+1]),e.vertexWeights.push(a[_*4+2]),e.vertexWeights.push(a[_*4+3]),e.weightsIndices.push(c[f*4]),e.weightsIndices.push(c[f*4+1]),e.weightsIndices.push(c[f*4+2]),e.weightsIndices.push(c[f*4+3]),e.weightsIndices.push(c[u*4]),e.weightsIndices.push(c[u*4+1]),e.weightsIndices.push(c[u*4+2]),e.weightsIndices.push(c[u*4+3]),e.weightsIndices.push(c[_*4]),e.weightsIndices.push(c[_*4+1]),e.weightsIndices.push(c[_*4+2]),e.weightsIndices.push(c[_*4+3])),t.color&&(e.colors.push(r[f*3]),e.colors.push(r[f*3+1]),e.colors.push(r[f*3+2]),e.colors.push(r[u*3]),e.colors.push(r[u*3+1]),e.colors.push(r[u*3+2]),e.colors.push(r[_*3]),e.colors.push(r[_*3+1]),e.colors.push(r[_*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(s[f*3]),e.normal.push(s[f*3+1]),e.normal.push(s[f*3+2]),e.normal.push(s[u*3]),e.normal.push(s[u*3+1]),e.normal.push(s[u*3+2]),e.normal.push(s[_*3]),e.normal.push(s[_*3+1]),e.normal.push(s[_*3+2])),t.uv&&t.uv.forEach(function(m,g){e.uvs[g]===void 0&&(e.uvs[g]=[]),e.uvs[g].push(o[g][f*2]),e.uvs[g].push(o[g][f*2+1]),e.uvs[g].push(o[g][u*2]),e.uvs[g].push(o[g][u*2+1]),e.uvs[g].push(o[g][_*2]),e.uvs[g].push(o[g][_*2+1])})}addMorphTargets(e,t,i,n){if(i.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const s=this;i.forEach(function(r){r.rawTargets.forEach(function(o){const a=se.Objects.Geometry[o.geoID];a!==void 0&&s.genMorphGeometry(e,t,a,n,o.name)})})}genMorphGeometry(e,t,i,n,s){const r=t.Vertices!==void 0?t.Vertices.a:[],o=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],a=i.Vertices!==void 0?i.Vertices.a:[],c=i.Indexes!==void 0?i.Indexes.a:[],h=e.attributes.position.count*3,l=new Float32Array(h);for(let m=0;m<c.length;m++){const g=c[m]*3;l[g]=a[m*3],l[g+1]=a[m*3+1],l[g+2]=a[m*3+2]}const f={vertexIndices:o,vertexPositions:l,baseVertexPositions:r},u=this.genBuffers(f),_=new st(u.vertex,3);_.name=s||i.attrName,_.applyMatrix4(n),e.morphAttributes.position.push(_)}parseNormals(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Normals.a;let s=[];return i==="IndexToDirect"&&("NormalIndex"in e?s=e.NormalIndex.a:"NormalsIndex"in e&&(s=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:s,mappingType:t,referenceType:i}}parseUVs(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.UV.a;let s=[];return i==="IndexToDirect"&&(s=e.UVIndex.a),{dataSize:2,buffer:n,indices:s,mappingType:t,referenceType:i}}parseVertexColors(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Colors.a;let s=[];i==="IndexToDirect"&&(s=e.ColorIndex.a);for(let r=0,o=new Se;r<n.length;r+=4)o.fromArray(n,r),Ge.toWorkingColorSpace(o,we),o.toArray(n,r);return{dataSize:4,buffer:n,indices:s,mappingType:t,referenceType:i}}parseMaterialIndices(e){const t=e.MappingInformationType,i=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};const n=e.Materials.a,s=[];for(let r=0;r<n.length;++r)s.push(r);return{dataSize:1,buffer:n,indices:s,mappingType:t,referenceType:i}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new at;const i=t-1,n=e.KnotVector.a,s=[],r=e.Points.a;for(let l=0,f=r.length;l<f;l+=4)s.push(new jt().fromArray(r,l));let o,a;if(e.Form==="Closed")s.push(s[0]);else if(e.Form==="Periodic"){o=i,a=n.length-1-o;for(let l=0;l<i;++l)s.push(s[l])}const h=new xo(i,n,s,o,a).getPoints(s.length*12);return new at().setFromPoints(h)}}class ko{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const i in t){const n=t[i],s=this.addClip(n);e.push(s)}return e}parseClips(){if(se.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=se.Objects.AnimationCurveNode,t=new Map;for(const i in e){const n=e[i];if(n.attrName.match(/S|R|T|DeformPercent/)!==null){const s={id:n.id,attr:n.attrName,curves:{}};t.set(s.id,s)}}return t}parseAnimationCurves(e){const t=se.Objects.AnimationCurve;for(const i in t){const n={id:t[i].id,times:t[i].KeyTime.a.map(Mo),values:t[i].KeyValueFloat.a},s=be.get(n.id);if(s!==void 0){const r=s.parents[0].ID,o=s.parents[0].relationship;o.match(/X/)?e.get(r).curves.x=n:o.match(/Y/)?e.get(r).curves.y=n:o.match(/Z/)?e.get(r).curves.z=n:o.match(/DeformPercent/)&&e.has(r)&&(e.get(r).curves.morph=n)}}}parseAnimationLayers(e){const t=se.Objects.AnimationLayer,i=new Map;for(const n in t){const s=[],r=be.get(parseInt(n));r!==void 0&&(r.children.forEach(function(a,c){if(e.has(a.ID)){const h=e.get(a.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(s[c]===void 0){const l=be.get(a.ID).parents.filter(function(f){return f.relationship!==void 0})[0].ID;if(l!==void 0){const f=se.Objects.Model[l.toString()];if(f===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",a);return}const u={modelName:f.attrName?Ut.sanitizeNodeName(f.attrName):"",ID:f.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Pe.traverse(function(_){_.ID===f.id&&(u.transform=_.matrix,_.userData.transformData&&(u.eulerOrder=_.userData.transformData.eulerOrder))}),u.transform||(u.transform=new he),"PreRotation"in f&&(u.preRotation=f.PreRotation.value),"PostRotation"in f&&(u.postRotation=f.PostRotation.value),s[c]=u}}s[c]&&(s[c][h.attr]=h)}else if(h.curves.morph!==void 0){if(s[c]===void 0){const l=be.get(a.ID).parents.filter(function(w){return w.relationship!==void 0})[0].ID,f=be.get(l).parents[0].ID,u=be.get(f).parents[0].ID,_=be.get(u).parents[0].ID,m=se.Objects.Model[_],g={modelName:m.attrName?Ut.sanitizeNodeName(m.attrName):"",morphName:se.Objects.Deformer[l].attrName};s[c]=g}s[c][h.attr]=h}}}),i.set(parseInt(n),s))}return i}parseAnimStacks(e){const t=se.Objects.AnimationStack,i={};for(const n in t){const s=be.get(parseInt(n)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const r=e.get(s[0].ID);i[n]={name:t[n].attrName,layer:r}}return i}addClip(e){let t=[];const i=this;return e.layer.forEach(function(n){t=t.concat(i.generateTracks(n))}),new Is(e.name,-1,t)}generateTracks(e){const t=[];let i=new J,n=new J;if(e.transform&&e.transform.decompose(i,new ye,n),i=i.toArray(),n=n.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");s!==void 0&&t.push(s)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const s=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);s!==void 0&&t.push(s)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.S.curves,n,"scale");s!==void 0&&t.push(s)}if(e.DeformPercent!==void 0){const s=this.generateMorphTrack(e);s!==void 0&&t.push(s)}return t}generateVectorTrack(e,t,i,n){const s=this.getTimesForAllAxes(t),r=this.getKeyframeTrackValues(s,t,i);return new On(e+"."+n,s,r)}generateRotationTrack(e,t,i,n,s){let r,o;if(t.x!==void 0&&t.y!==void 0&&t.z!==void 0){const f=this.interpolateRotations(t.x,t.y,t.z,s);r=f[0],o=f[1]}const a=Ht(0);i!==void 0&&(i=i.map(ke.degToRad),i.push(a),i=new it().fromArray(i),i=new ye().setFromEuler(i)),n!==void 0&&(n=n.map(ke.degToRad),n.push(a),n=new it().fromArray(n),n=new ye().setFromEuler(n).invert());const c=new ye,h=new it,l=[];if(!o||!r)return new cn(e+".quaternion",[0],[0]);for(let f=0;f<o.length;f+=3)h.set(o[f],o[f+1],o[f+2],s),c.setFromEuler(h),i!==void 0&&c.premultiply(i),n!==void 0&&c.multiply(n),f>2&&new ye().fromArray(l,(f-3)/3*4).dot(c)<0&&c.set(-c.x,-c.y,-c.z,-c.w),c.toArray(l,f/3*4);return new cn(e+".quaternion",r,l)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,i=t.values.map(function(s){return s/100}),n=Pe.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Fn(e.modelName+".morphTargetInfluences["+n+"]",t.times,i)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(i,n){return i-n}),t.length>1){let i=1,n=t[0];for(let s=1;s<t.length;s++){const r=t[s];r!==n&&(t[i]=r,n=r,i++)}t=t.slice(0,i)}return t}getKeyframeTrackValues(e,t,i){const n=i,s=[];let r=-1,o=-1,a=-1;return e.forEach(function(c){if(t.x&&(r=t.x.times.indexOf(c)),t.y&&(o=t.y.times.indexOf(c)),t.z&&(a=t.z.times.indexOf(c)),r!==-1){const h=t.x.values[r];s.push(h),n[0]=h}else s.push(n[0]);if(o!==-1){const h=t.y.values[o];s.push(h),n[1]=h}else s.push(n[1]);if(a!==-1){const h=t.z.values[a];s.push(h),n[2]=h}else s.push(n[2])}),s}interpolateRotations(e,t,i,n){const s=[],r=[];s.push(e.times[0]),r.push(ke.degToRad(e.values[0])),r.push(ke.degToRad(t.values[0])),r.push(ke.degToRad(i.values[0]));for(let o=1;o<e.values.length;o++){const a=[e.values[o-1],t.values[o-1],i.values[o-1]];if(isNaN(a[0])||isNaN(a[1])||isNaN(a[2]))continue;const c=a.map(ke.degToRad),h=[e.values[o],t.values[o],i.values[o]];if(isNaN(h[0])||isNaN(h[1])||isNaN(h[2]))continue;const l=h.map(ke.degToRad),f=[h[0]-a[0],h[1]-a[1],h[2]-a[2]],u=[Math.abs(f[0]),Math.abs(f[1]),Math.abs(f[2])];if(u[0]>=180||u[1]>=180||u[2]>=180){const m=Math.max(...u)/180,g=new it(...c,n),w=new it(...l,n),b=new ye().setFromEuler(g),v=new ye().setFromEuler(w);b.dot(v)&&v.set(-v.x,-v.y,-v.z,-v.w);const T=e.times[o-1],S=e.times[o]-T,M=new ye,P=new it;for(let z=0;z<1;z+=1/m)M.copy(b.clone().slerp(v.clone(),z)),s.push(T+z*S),P.setFromQuaternion(M,n),r.push(P.x),r.push(P.y),r.push(P.z)}else s.push(e.times[o]),r.push(ke.degToRad(e.values[o])),r.push(ke.degToRad(t.values[o])),r.push(ke.degToRad(i.values[o]))}return[s,r]}}class Io{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Hs,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,i=e.split(/[\r\n]+/);return i.forEach(function(n,s){const r=n.match(/^[\s\t]*;/),o=n.match(/^[\s\t]*$/);if(r||o)return;const a=n.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=n.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=n.match("^\\t{"+(t.currentIndent-1)+"}}");a?t.parseNodeBegin(n,a):c?t.parseNodeProperty(n,c,i[++s]):h?t.popStack():n.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(n)}),this.allNodes}parseNodeBegin(e,t){const i=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map(function(a){return a.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:i},r=this.parseNodeAttr(n),o=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(i,s):i in o?(i==="PoseNode"?o.PoseNode.push(s):o[i].id!==void 0&&(o[i]={},o[i][o[i].id]=o[i]),r.id!==""&&(o[i][r.id]=s)):typeof r.id=="number"?(o[i]={},o[i][r.id]=s):i!=="Properties70"&&(i==="PoseNode"?o[i]=[s]:o[i]=s),typeof r.id=="number"&&(s.id=r.id),r.name!==""&&(s.attrName=r.name),r.type!==""&&(s.attrType=r.type),this.pushStack(s)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let i="",n="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:i,type:n}}parseNodeProperty(e,t,i){let n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),s=t[2].replace(/^"/,"").replace(/"$/,"").trim();n==="Content"&&s===","&&(s=i.replace(/"/g,"").replace(/,$/,"").trim());const r=this.getCurrentNode();if(r.name==="Properties70"){this.parseNodeSpecialProperty(e,n,s);return}if(n==="C"){const a=s.split(",").slice(1),c=parseInt(a[0]),h=parseInt(a[1]);let l=s.split(",").slice(3);l=l.map(function(f){return f.trim().replace(/^"/,"")}),n="connections",s=[c,h],Do(s,l),r[n]===void 0&&(r[n]=[])}n==="Node"&&(r.id=s),n in r&&Array.isArray(r[n])?r[n].push(s):n!=="a"?r[n]=s:r.a=s,this.setCurrentProp(r,n),n==="a"&&s.slice(-1)!==","&&(r.a=Rn(s))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Rn(t.a))}parseNodeSpecialProperty(e,t,i){const n=i.split('",').map(function(h){return h.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=n[0],r=n[1],o=n[2],a=n[3];let c=n[4];switch(r){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=Rn(c);break}this.getPrevNode()[s]={type:r,type2:o,flag:a,value:c},this.setCurrentProp(this.getPrevNode(),s)}}class Ro{parse(e){const t=new ms(e);t.skip(23);const i=t.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);const n=new Hs;for(;!this.endOfContent(t);){const s=this.parseNode(t,i);s!==null&&n.add(s.name,s)}return n}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const i={},n=t>=7500?e.getUint64():e.getUint32(),s=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const r=e.getUint8(),o=e.getString(r);if(n===0)return null;const a=[];for(let f=0;f<s;f++)a.push(this.parseProperty(e));const c=a.length>0?a[0]:"",h=a.length>1?a[1]:"",l=a.length>2?a[2]:"";for(i.singleProperty=s===1&&e.getOffset()===n;n>e.getOffset();){const f=this.parseNode(e,t);f!==null&&this.parseSubNode(o,i,f)}return i.propertyList=a,typeof c=="number"&&(i.id=c),h!==""&&(i.attrName=h),l!==""&&(i.attrType=l),o!==""&&(i.name=o),i}parseSubNode(e,t,i){if(i.singleProperty===!0){const n=i.propertyList[0];Array.isArray(n)?(t[i.name]=i,i.a=n):t[i.name]=n}else if(e==="Connections"&&i.name==="C"){const n=[];i.propertyList.forEach(function(s,r){r!==0&&n.push(s)}),t.connections===void 0&&(t.connections=[]),t.connections.push(n)}else if(i.name==="Properties70")Object.keys(i).forEach(function(s){t[s]=i[s]});else if(e==="Properties70"&&i.name==="P"){let n=i.propertyList[0],s=i.propertyList[1];const r=i.propertyList[2],o=i.propertyList[3];let a;n.indexOf("Lcl ")===0&&(n=n.replace("Lcl ","Lcl_")),s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),s==="Color"||s==="ColorRGB"||s==="Vector"||s==="Vector3D"||s.indexOf("Lcl_")===0?a=[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:a=i.propertyList[4],t[n]={type:s,type2:r,flag:o,value:a}}else t[i.name]===void 0?typeof i.id=="number"?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:i.name==="PoseNode"?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):t[i.name][i.id]===void 0&&(t[i.name][i.id]=i)}parseProperty(e){const t=e.getString(1);let i;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return i=e.getUint32(),e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const n=e.getUint32(),s=e.getUint32(),r=e.getUint32();if(s===0)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}const o=fo(new Uint8Array(e.getArrayBuffer(r))),a=new ms(o.buffer);switch(t){case"b":case"c":return a.getBooleanArray(n);case"d":return a.getFloat64Array(n);case"f":return a.getFloat32Array(n);case"i":return a.getInt32Array(n);case"l":return a.getInt64Array(n)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class ms{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let i=0;i<e;i++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let i=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const n=i.indexOf(0);return n>=0&&(i=new Uint8Array(this.dv.buffer,t,n)),this._textDecoder.decode(i)}}class Hs{add(e,t){this[e]=t}}function Po(p){const e="Kaydara FBX Binary  \0";return p.byteLength>=e.length&&e===Xs(p,0,e.length)}function Co(p){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function i(n){const s=p[n-1];return p=p.slice(t+n),t++,s}for(let n=0;n<e.length;++n)if(i(1)===e[n])return!1;return!0}function gs(p){const e=/FBXVersion: (\d+)/,t=p.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Mo(p){return p/46186158e3}const Lo=[];function en(p,e,t,i){let n;switch(i.mappingType){case"ByPolygonVertex":n=p;break;case"ByPolygon":n=e;break;case"ByVertice":n=t;break;case"AllSame":n=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}i.referenceType==="IndexToDirect"&&(n=i.indices[n]);const s=n*i.dataSize,r=s+i.dataSize;return Oo(Lo,i.buffer,s,r)}const In=new it,pt=new J;function Gs(p){const e=new he,t=new he,i=new he,n=new he,s=new he,r=new he,o=new he,a=new he,c=new he,h=new he,l=new he,f=new he,u=p.inheritType?p.inheritType:0;p.translation&&e.setPosition(pt.fromArray(p.translation));const _=Ht(0);if(p.preRotation){const K=p.preRotation.map(ke.degToRad);K.push(_),t.makeRotationFromEuler(In.fromArray(K))}if(p.rotation){const K=p.rotation.map(ke.degToRad);K.push(p.eulerOrder||_),i.makeRotationFromEuler(In.fromArray(K))}if(p.postRotation){const K=p.postRotation.map(ke.degToRad);K.push(_),n.makeRotationFromEuler(In.fromArray(K)),n.invert()}p.scale&&s.scale(pt.fromArray(p.scale)),p.scalingOffset&&o.setPosition(pt.fromArray(p.scalingOffset)),p.scalingPivot&&r.setPosition(pt.fromArray(p.scalingPivot)),p.rotationOffset&&a.setPosition(pt.fromArray(p.rotationOffset)),p.rotationPivot&&c.setPosition(pt.fromArray(p.rotationPivot)),p.parentMatrixWorld&&(l.copy(p.parentMatrix),h.copy(p.parentMatrixWorld));const m=t.clone().multiply(i).multiply(n),g=new he;g.extractRotation(h);const w=new he;w.copyPosition(h);const b=w.clone().invert().multiply(h),v=g.clone().invert().multiply(b),T=s,S=new he;if(u===0)S.copy(g).multiply(m).multiply(v).multiply(T);else if(u===1)S.copy(g).multiply(v).multiply(m).multiply(T);else{const E=new he().scale(new J().setFromMatrixScale(l)).clone().invert(),F=v.clone().multiply(E);S.copy(g).multiply(m).multiply(F).multiply(T)}const M=c.clone().invert(),P=r.clone().invert();let z=e.clone().multiply(a).multiply(c).multiply(t).multiply(i).multiply(n).multiply(M).multiply(o).multiply(r).multiply(s).multiply(P);const C=new he().copyPosition(z),H=h.clone().multiply(C);return f.copyPosition(H),z=f.clone().multiply(S),z.premultiply(h.invert()),z}function Ht(p){p=p||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return p===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[p]}function Rn(p){return p.split(",").map(function(t){return parseFloat(t)})}function Xs(p,e,t){return e===void 0&&(e=0),t===void 0&&(t=p.byteLength),new TextDecoder().decode(new Uint8Array(p,e,t))}function Do(p,e){for(let t=0,i=p.length,n=e.length;t<n;t++,i++)p[i]=e[t]}function Oo(p,e,t,i){for(let n=t,s=0;n<i;n++,s++)p[s]=e[n];return p}var Ot=function(){var p=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(h){h.preventDefault(),i(++p%e.children.length)},!1);function t(h){return e.appendChild(h.dom),h}function i(h){for(var l=0;l<e.children.length;l++)e.children[l].style.display=l===h?"block":"none";p=h}var n=(performance||Date).now(),s=n,r=0,o=t(new Ot.Panel("FPS","#0ff","#002")),a=t(new Ot.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new Ot.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:e,addPanel:t,showPanel:i,begin:function(){n=(performance||Date).now()},end:function(){r++;var h=(performance||Date).now();if(a.update(h-n,200),h>=s+1e3&&(o.update(r*1e3/(h-s),100),s=h,r=0,c)){var l=performance.memory;c.update(l.usedJSHeapSize/1048576,l.jsHeapSizeLimit/1048576)}return h},update:function(){n=this.end()},domElement:e,setMode:i}};Ot.Panel=function(p,e,t){var i=1/0,n=0,s=Math.round,r=s(window.devicePixelRatio||1),o=80*r,a=48*r,c=3*r,h=2*r,l=3*r,f=15*r,u=74*r,_=30*r,m=document.createElement("canvas");m.width=o,m.height=a,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*r+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=t,g.fillRect(0,0,o,a),g.fillStyle=e,g.fillText(p,c,h),g.fillRect(l,f,u,_),g.fillStyle=t,g.globalAlpha=.9,g.fillRect(l,f,u,_),{dom:m,update:function(w,b){i=Math.min(i,w),n=Math.max(n,w),g.fillStyle=t,g.globalAlpha=1,g.fillRect(0,0,o,f),g.fillStyle=e,g.fillText(s(w)+" "+p+" ("+s(i)+"-"+s(n)+")",c,h),g.drawImage(m,l+r,f,u-r,_,l,f,u-r,_),g.fillRect(l+u-r,f,r,_),g.fillStyle=t,g.globalAlpha=.9,g.fillRect(l+u-r,f,r,s((1-w/b)*_))}}};const Fo=async p=>{for(;p.children.length>0;){const e=p.children[0];if(e.isMesh)if(e.geometry.dispose(),e.geometry=null,e.material.isMaterial)tn(e.material);else for(const t of e.material)tn(t);e.isGroup&&e.children.forEach(i=>{if(i.isMesh)if(i.geometry.dispose(),i.geometry=null,i.material.isMaterial)tn(i.material);else for(const n of i.material)tn(n)}),p.remove(e)}},tn=p=>{p.dispose(),p.map&&p.map.dispose(),p.lightMap&&p.lightMap.dispose(),p.bumpMap&&p.bumpMap.dispose(),p.normalMap&&p.normalMap.dispose(),p.specularMap&&p.specularMap.dispose(),p.envMap&&p.envMap.dispose()},Zs=Oi(),Ws=Fi();let Xe=null,Te=null,Ze=null,ge=null,Be=null,yt=null,lt=null,on=null,Ks=null,Ee=null,Ys=null,Ne=null,jn=null,an=null,hn=null,Mt=null,Ft=null,un=null;const rt=dn(0),ot=dn(0),ct=dn(0),Xt=dn(!0),ys=async()=>{Xe=null,Te=null,Ze=null,ge=null,Be=null,yt=null,lt=null,on=null,Ne=null,Ys=null,Ee=null,Mt=null,Ft=null,un=null,rt.value=0,ot.value=0,ct.value=0,Xt.value=!0},zo=async(p,e)=>{let t=document.querySelector(".stats")||null;if(t&&t.remove(),!p)return;Ee=new Ot;const[i="calc(2rem + 60px)",n="calc(2rem + 300px)"]=e;Ee.dom.style.position="absolute",Zs.getFlagStatus?(Ee.dom.style.top=0,Ee.dom.style.left=0):(Ee.dom.style.top=i,Ee.dom.style.left=n,Ws.isMobile&&(Ee.dom.style.top="1rem",Ee.dom.style.left="22vw")),Ee.dom.style.right="auto",Ee.dom.style.zIndex="10",Ee.dom.className="stats",document.body.appendChild(Ee.dom)},Bo=async(p,e,t)=>{Xe=document.querySelector(p),rt.value=Xe.clientWidth,ot.value=Xe.clientHeight,Te=new Pi,Te.background=new Se(e),Ze=new Xn(75,rt.value/ot.value,.1,1e3),Ze.position.set(t[0],t[1],t[2]),Xe.tagName==="DIV"?(ge=new qn({antialias:!0}),ge.setSize(rt.value,ot.value),ge.setPixelRatio=window.devicePixelRatio,Xe.appendChild(ge.domElement)):(ge=new qn({canvas:Xe,antialias:!0}),ge.setPixelRatio=window.devicePixelRatio,ge.setSize(rt.value,ot.value))},No=async(p,e,t)=>{p&&(Be=new qi(Ze,ge.domElement),Be.enableDamping=!0,Be.dampingFactor=.03,Be.autoRotate=e,e&&(Be.autoRotateSpeed=t),Be.update())},Uo=async(p,e)=>{if(p){yt=new cr(Ze,ge.domElement),yt.addEventListener("dragging-changed",function(i){if(!i.value){const{position:n,scale:s,rotation:r}=yt.object;console.log(JSON.stringify({position:n,scale:s,rotation:{x:r.x,y:r.y,z:r.z}}))}Be&&(Be.enabled=!i.value)});const t=yt.getHelper();Te.add(t)}},jo=async p=>{if(p){const e=new Gn("#FFFFFF",2);e.position.set(10,5,5),Te.add(e);const t=new ln(16777215,150,0);t.position.set(5,3,5),t.lookAt(0,0,0),t.castShadow=!0,Te.add(t);const i=new Ps(16777215,.5);Te.add(i)}},Ho=async p=>{p&&(Ft=new Ci(10),Ft.position.set(0,0,0),Te.add(Ft),un=new Mi(30,30,16777215,"white"),Te.add(un))},ra=async(p,e=[1,1,1],t="model")=>{if(p)return lt=new Wn,new Promise((i,n)=>{lt.parse(p,"",function(s){if("scene"in s){const r=s.scene;s.scene.traverse(function(o){o.isMesh&&(o.material.side=At)}),r.name=t,r.position.set(0,0,0),r.scale.set(e[0],e[1],e[2])}i(s)},function(s){n(s)})})},Go=async(p,e=[1,1,1],t="model")=>{if(p)return on=new Ds,on.setDecoderPath("http://115.190.117.177:10086/draco/gltf/"),lt=new Wn,lt.setDRACOLoader(on),new Promise((i,n)=>{lt.load(p,function(s){if("scene"in s){const r=s.scene;s.scene.traverse(function(o){o.isMesh&&(o.material.side=At)}),r.name=t,r.position.set(0,0,0),r.scale.set(e[0],e[1],e[2])}i(s)},s=>{ct.value=(s.loaded/s.total*100).toFixed(2),ct.value==100&&(Xt.value=!1)},function(s){n(s)})})},Xo=async(p,e=[1,1,1],t="model")=>{if(!p)return;let i=100;return lt=new To,new Promise((n,s)=>{lt.load(p,function(r){r.traverse(function(o){o.isMesh&&(o.castShadow=!0,o.receiveShadow=!0,Array.isArray(o.material)&&o.material.length>0?o.material.forEach(a=>{a.side=At}):o.material.side=At)}),r.name=t,r.position.set(0,0,0),r.scale.set(e[0]/i,e[1]/i,e[2]/i),n(r)},r=>{ct.value=(r.loaded/r.total*100).toFixed(2),ct.value==100&&(Xt.value=!1)},function(r){s(r)})})},nn=async(p,e,t)=>{const i=p.split(".").pop(),n=p.split(".").shift();if(i==="glb"||i==="gltf"){let s=await Go(p,e,t||n);"scene"in s&&(Mt=s.scene,Te.add(Mt),s.animations.length>0&&(Ne=new sn(Mt),s.animations.forEach(function(o){Ne.clipAction(o).play()})),s.animations&&s.animations.length>0&&(Ne=new sn(Mt),Ne.clipAction(s.animations[0]).play()),ge.setAnimationLoop(fn))}else if(i==="fbx"){const s=await Xo(p,e,t||n);s&&(Te.add(s),Ne=new sn(s),s.animations.length>0&&s.animations.forEach(function(o){Ne.clipAction(o).play()}),ge.setAnimationLoop(fn))}};async function _s(p,e,t){try{const n=await(await fetch(p)).arrayBuffer(),s=new Yi;await s.loadAsync(n);const r=Object.keys(s.files)[0],a=await s.file(r).async("arraybuffer"),c=new Ds;c.setDecoderPath("http://115.190.117.177:10086/draco/gltf/"),c.preload();const h=new Wn;h.setDRACOLoader(c);const l=await new Promise((u,_)=>{h.parse(a,"",m=>u(m),m=>_(m))}),f=l.scene;f.name=t,f.position.set(0,0,0),f.scale.set(e[0],e[1],e[2]),Te.add(f),l.animations&&l.animations.length>0&&(Ne=new sn(f),l.animations.forEach(u=>{Ne.clipAction(u).play()})),ge.setAnimationLoop(fn)}catch(i){throw console.error(":",i),i}}const Zo=async(p,e,t,i)=>{if(Te&&p)if(Array.isArray(p)&&p.length>0)for(let n=0;n<p.length;n++){const s="http://115.190.117.177:10086/glbs/"+p[n];i?s.substr(-4).toLowerCase()===".zip"?await _s(s,e,t[n]):await nn(s,e,t[n]):await nn(s,e,t[n])}else{const n="http://115.190.117.177:10086/glbs/"+p;i?n.substr(-4).toLowerCase()===".zip"?await _s(n):await nn(n,e,t):await nn(n,e,t)}},fn=()=>{if(an&&typeof an=="function"&&hn)an(hn);else{if(Be)Be.update();else{cancelAnimationFrame(Ks);return}if(Ne){const p=jn.getDelta();Ne.update(p)}ge.render(Te,Ze),Ee&&Ee.update()}},Wo=async p=>{p&&typeof p=="function"&&(ct.value=0,await p(hn),ge.setAnimationLoop(fn),ct.value=100,setTimeout(()=>{Xt.value=!1},100))},oa=({el:p="#canvas",background:e="#000000",modelPath:t=null,modelScale:i=[1,1,1],modelZip:n=!1,modelName:s=null,control:r=!0,controlAuto:o=!0,controlAutoSpeed:a=.5,cameraPosition:c=[0,0,5],light:h=!0,helper:l=!1,animation:f=void 0,creatMesh:u=void 0,transformControls:_=!1,showStats:m=!0,statsPosition:g=[]})=>(Bi(async()=>{await ys(),await zo(m,g),await Bo(p,e,c),jn=new Li,an=f,await jo(h),await Ho(l),await No(r,o,a),await Uo(_),await Zo(t,i,s,n),hn={THREE:Di,scene:Te,camera:Ze,renderer:ge,controls:Be,transControls:yt,cube:Ys,stats:Ee,clock:jn,canvas:Xe,gridHelper:un,axesHelper:Ft,mixer:Ne},await Wo(u),ge.render(Te,Ze)}),Ni(async()=>{try{Ee?.dom&&document.body.removeChild(Ee.dom),cancelAnimationFrame(Ks),Te.clear(),ge.dispose(),ge.forceContextLoss();let w=ge.domElement.getContext("webgl");w&&w.getExtension("WEBGL_lose_context").loseContext(),ge.content=null,await Fo(Te),await ys()}catch(w){console.error(w)}}),zn(()=>Zs.getFlagStatus,(w,b)=>{if(w!=b){let v=document.querySelector(p),T=document.querySelector(".lil-gui"),S=document.querySelector(".stats");v&&Xe&&(v.style.width="100%",v.style.height="100%",rt.value=Xe.clientWidth,ot.value=Xe.clientHeight,Ze.aspect=rt.value/ot.value,Ze.updateProjectionMatrix(),ge.setSize(rt.value,ot.value),ge.render(Te,Ze)),w?(T&&(T.style.top="0",T.style.right="0"),S&&(S.style.top="0",S.style.left="0")):(T&&(Ws.isMobile?(T.style.top="1rem",T.style.right="20px"):(T.style.top="calc(2rem + 60px)",T.style.right="2rem")),S&&(S.style.top="calc(2rem + 60px)",S.style.left="calc(2rem + 300px)"))}},{immediate:!0}),{loading:Xt,pregress:ct}),Ko={class:"model"},Yo={class:"loading"},Vo={key:0},qo={class:"canvas-box"},Qo={__name:"Loading",props:{loading:{type:Boolean,default:!0},pregress:{type:[Number,String],default:0}},setup(p){const e=Zi(),t=p;return zn(()=>t.loading,i=>{i?e.setLoadingStatus(!0):e.setLoadingStatus(!1)},{immediate:!0}),zn(()=>t.pregress,i=>{i&&i>100&&e.setLoadingStatus(!1)},{immediate:!0}),(i,n)=>(Jn(),Qn("div",Ko,[Ui(yn("div",Yo,[n[0]||(n[0]=yn("img",{src:"http://115.190.117.177:10086/images/loading.gif"},null,-1)),t.pregress?(Jn(),Qn("p",Vo,""+Gi(t.pregress)+" %",1)):Hi("",!0)],512),[[ji,t.loading&&t.pregress<=100]]),yn("div",qo,[Xi(i.$slots,"default",{},void 0)])]))}},aa=zi(Qo,[["__scopeId","data-v-e9e59e69"]]);export{aa as L,ra as l,ia as m,oa as u};
