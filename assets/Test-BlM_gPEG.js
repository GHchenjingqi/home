import{_ as z,r as u,o as G,a as H,b as p,l as v,H as I,w as P,u as W,h as S,v as B,d as l,t as f,E as $,F as L,s as j,n as J,m as O}from"./index-BuYTP-pm.js";import{u as q,L as K,at as Q}from"./Loading-DC6eqkF4.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./allscreen-DnW93eKv.js";import"./loading-C4V6Bmbo.js";const R={class:"upload-box"},X={key:0,class:"ani-box"},Y={class:"ani-tag"},Z=["onClick"],ee={__name:"Test",setup(ne){let g=null,o=null,h=null,d=null,c=u(null);const U=async({THREE:e,scene:a,camera:s,axesHelper:t,stats:i})=>{g=a,d=e,i.dom.style.top=0,i.dom.style.left=0,h=new e.Clock},F=({controls:e,scene:a,camera:s,renderer:t,stats:i,gridHelper:n})=>{if(i==null||i.update(),e==null||e.update(),t==null||t.render(a,s),o){const r=h.getDelta();o.update(r)}},_=u(!1),k=u(null);function M(e){const a=e.target.files[0];if(a&&a.name.toLowerCase().endsWith(".glb")){const s=new FileReader;s.onload=async function(t){const i=t.target.result;_.value=!0;let n=await Q(i);if("scene"in n){let r=n.scene;k.value={scene:n.scene,animations:n.animations},g.add(r),n.animations.length>0&&(o=new d.AnimationMixer(r),n.animations.forEach(function(V){o.clipAction(V).play()})),n.animations&&n.animations.length>0&&(o=new d.AnimationMixer(r),m.value=n.animations.length,y.value=n.animations,c.value=o.clipAction(n.animations[0]),x.value=n.animations[0].name,confirm(`检测到${m.value}个动画，是否播放第一个？`)&&w())}},s.readAsArrayBuffer(a)}else alert("请选择一个 .glb 格式的文件")}const b=u(!1),N=()=>{b.value=!b.value},m=u(0),y=u([]),C=u(0),x=u(""),w=()=>{c.value.play()};function A(){c.value.stop()}function D(e){A(),C.value=e,c.value=o.clipAction(y.value[e]),w()}const{loading:E}=q({el:"#canvas",background:"#333333",cameraPosition:[4,2.5,-6],control:!0,controlAutoSpeed:!1,helper:!0,light:!0,showStats:!0,creatMesh:U,animation:F});return G(()=>{var e;(e=document.getElementById("glbUploader"))==null||e.addEventListener("change",M,!1)}),H(()=>{g=null,o=null,h=null,d=null,c=null}),(e,a)=>(p(),v(L,null,[I(K,{loading:W(E)},{default:P(()=>a[0]||(a[0]=[l("div",{id:"canvas"},null,-1)])),_:1},8,["loading"]),S(l("div",R,a[1]||(a[1]=[l("input",{type:"file",id:"glbUploader",accept:".glb"},null,-1),l("label",{for:"glbUploader"},"上传模型",-1)]),512),[[B,!_.value]]),S(l("div",{class:"object-box",style:$({width:b.value?"40vw":"20vw"}),onClick:N},[l("pre",null," "+f(JSON.stringify(k.value,null,4))+" ",1)],4),[[B,_.value]]),m.value?(p(),v("div",X,[l("h1",null,"共检测到"+f(m.value)+"个动画序列",1),l("div",Y,[(p(!0),v(L,null,j(y.value,(s,t)=>(p(),v("span",{class:J(C.value===t?"active":""),key:s.id,onClick:i=>D(t)},f(s.name),11,Z))),128))]),l("p",null,"正在播放："+f(x.value),1),l("p",null,[l("button",{onClick:w},"播放"),l("button",{onClick:A},"暂停")])])):O("",!0)],64))}},ue=z(ee,[["__scopeId","data-v-f4d84090"]]);export{ue as default};
