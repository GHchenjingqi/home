import{_ as V,r as i,o as z,a as E,l as p,I as P,h as S,m as W,w as $,u as j,v as B,d as a,t as v,G as H,F as L,x as J,b as f,n as O}from"./index-DpGVNEm0.js";import{u as q,L as K,at as Q}from"./Loading-DX6OrYVO.js";import"https://ghchenjingqi.github.io/resources/mds/pathList.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./allscreen-Ccov-lO2.js";import"./loading-Vx-oxiet.js";const R={class:"upload-box"},X={key:0,class:"ani-box"},Y={class:"ani-tag"},Z=["onClick"],ee={__name:"Test",setup(ne){let g=null,l=null,h=null,d=null,u=i(null);const U=async({THREE:t,scene:n,camera:o,axesHelper:s,stats:r})=>{g=n,d=t,r.dom.style.top=0,r.dom.style.left=0,h=new t.Clock},F=({controls:t,scene:n,camera:o,renderer:s,stats:r,gridHelper:e})=>{if(r?.update(),t?.update(),s?.render(n,o),l){const c=h.getDelta();l.update(c)}},_=i(!1),k=i(null);function M(t){const n=t.target.files[0];if(n&&n.name.toLowerCase().endsWith(".glb")){const o=new FileReader;o.onload=async function(s){const r=s.target.result;_.value=!0;let e=await Q(r);if("scene"in e){let c=e.scene;k.value={scene:e.scene,animations:e.animations},g.add(c),e.animations.length>0&&(l=new d.AnimationMixer(c),e.animations.forEach(function(T){l.clipAction(T).play()})),e.animations&&e.animations.length>0&&(l=new d.AnimationMixer(c),m.value=e.animations.length,y.value=e.animations,u.value=l.clipAction(e.animations[0]),C.value=e.animations[0].name,confirm(`检测到${m.value}个动画，是否播放第一个？`)&&w())}},o.readAsArrayBuffer(n)}else alert("请选择一个 .glb 格式的文件")}const b=i(!1),N=()=>{b.value=!b.value},m=i(0),y=i([]),x=i(0),C=i(""),w=()=>{u.value.play()};function A(){u.value.stop()}function D(t){A(),x.value=t,u.value=l.clipAction(y.value[t]),w()}const{loading:G}=q({el:"#canvas",background:"#333333",cameraPosition:[4,2.5,-6],control:!0,controlAutoSpeed:!1,helper:!0,light:!0,showStats:!0,creatMesh:U,animation:F});return z(()=>{document.getElementById("glbUploader")?.addEventListener("change",M,!1)}),E(()=>{g=null,l=null,h=null,d=null,u=null}),(t,n)=>(f(),p(L,null,[P(K,{loading:j(G)},{default:$(()=>[...n[0]||(n[0]=[a("div",{id:"canvas"},null,-1)])]),_:1},8,["loading"]),S(a("div",R,[...n[1]||(n[1]=[a("input",{type:"file",id:"glbUploader",accept:".glb"},null,-1),a("label",{for:"glbUploader"},"上传模型",-1)])],512),[[B,!_.value]]),S(a("div",{class:"object-box",style:H({width:b.value?"40vw":"20vw"}),onClick:N},[a("pre",null," "+v(JSON.stringify(k.value,null,4))+" ",1)],4),[[B,_.value]]),m.value?(f(),p("div",X,[a("h1",null,"共检测到"+v(m.value)+"个动画序列",1),a("div",Y,[(f(!0),p(L,null,J(y.value,(o,s)=>(f(),p("span",{class:O(x.value===s?"active":""),key:o.id,onClick:r=>D(s)},v(o.name),11,Z))),128))]),a("p",null,"正在播放："+v(C.value),1),a("p",null,[a("button",{onClick:w},"播放"),a("button",{onClick:A},"暂停")])])):W("",!0)],64))}},ue=V(ee,[["__scopeId","data-v-f4d84090"]]);export{ue as default};
