import{V,f as Y,g as q,Q as F,u as J,L as U}from"./Loading-BOak9VNV.js";import{f as k,_ as z,a as X,c as Z,b as Q,w as W,u as C,d as $}from"./index-3r0CxIdO.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./allscreen-DUqb-iEA.js";import"./loading-Cd1P2AmI.js";import"https://ghchenjingqi.github.io/resources/mds/pathList.js";const K="https://cdn.jsdelivr.net/npm/jolt-physics@0.23.0/dist/jolt-physics.wasm-compat.js",R=60;let i=null;function T(h){const s=h.parameters;if(h.type==="BoxGeometry"){const y=s.width!==void 0?s.width/2:.5,m=s.height!==void 0?s.height/2:.5,M=s.depth!==void 0?s.depth/2:.5;return new i.BoxShape(new i.Vec3(y,m,M),.05*Math.min(y,m,M),null)}else if(h.type==="SphereGeometry"||h.type==="IcosahedronGeometry"){const y=s.radius!==void 0?s.radius:1;return new i.SphereShape(y,null)}return null}const D=0,S=1,j=2;function H(h){let s=new i.ObjectLayerPairFilterTable(j);s.EnableCollision(D,S),s.EnableCollision(S,S);const y=new i.BroadPhaseLayer(0),m=new i.BroadPhaseLayer(1),M=2;let f=new i.BroadPhaseLayerInterfaceTable(j,M);f.MapObjectToBroadPhaseLayer(D,y),f.MapObjectToBroadPhaseLayer(S,m),h.mObjectLayerPairFilter=s,h.mBroadPhaseLayerInterface=f,h.mObjectVsBroadPhaseLayerFilter=new i.ObjectVsBroadPhaseLayerFilterTable(h.mBroadPhaseLayerInterface,M,h.mObjectLayerPairFilter,j)}async function E(){if(i===null){const{default:e}=await k(async()=>{const{default:o}=await import(`${K}`);return{default:o}},[]);i=await e()}const h=new i.JoltSettings;H(h);const s=new i.JoltInterface(h);i.destroy(h);const m=s.GetPhysicsSystem().GetBodyInterface(),M=[],f=new WeakMap,b=new V,t=new F,w=new V(1,1,1),B=new Y;function O(e){e.traverse(function(o){if(o.isMesh){const r=o.userData.physics;r&&P(o,r.mass,r.restitution)}})}function P(e,o=0,r=0){const u=T(e.geometry);if(u===null)return;const n=e.isInstancedMesh?v(e,o,r,u):G(e.position,e.quaternion,o,r,u);o>0&&(M.push(e),f.set(e,n))}function v(e,o,r,u){const n=e.instanceMatrix.array,c=[];for(let a=0;a<e.count;a++){const l=b.fromArray(n,a*16+12),g=t.setFromRotationMatrix(B.fromArray(n,a*16));c.push(G(l,g,o,r,u))}return c}function G(e,o,r,u,n){const c=new i.Vec3(e.x,e.y,e.z),a=new i.Quat(o.x,o.y,o.z,o.w),l=r>0?i.EMotionType_Dynamic:i.EMotionType_Static,g=r>0?S:D,d=new i.BodyCreationSettings(n,c,a,l,g);d.mRestitution=u;const _=m.CreateBody(d);return m.AddBody(_.GetID(),i.EActivation_Activate),i.destroy(d),_}function x(e,o,r=0){if(e.isInstancedMesh){const u=f.get(e),n=u[r];m.RemoveBody(n.GetID()),m.DestroyBody(n.GetID());const c=e.userData.physics;let a=n.GetShape(),l=G(o,{x:0,y:0,z:0,w:1},c.mass,c.restitution,a);u[r]=l}}function L(e,o,r=0){}const I=new q;function A(){let e=I.getDelta();e=Math.min(e,1/30);const o=e>1/55?2:1;s.Step(e,o);for(let r=0,u=M.length;r<u;r++){const n=M[r];if(n.isInstancedMesh){const c=n.instanceMatrix.array,a=f.get(n);for(let l=0;l<a.length;l++){const g=a[l],d=g.GetPosition(),_=g.GetRotation();b.set(d.GetX(),d.GetY(),d.GetZ()),t.set(_.GetX(),_.GetY(),_.GetZ(),_.GetW()),B.compose(b,t,w).toArray(c,l*16)}n.instanceMatrix.needsUpdate=!0,n.computeBoundingSphere()}else{const c=f.get(n),a=c.GetPosition(),l=c.GetRotation();n.position.set(a.GetX(),a.GetY(),a.GetZ()),n.quaternion.set(l.GetX(),l.GetY(),l.GetZ(),l.GetW())}}}return setInterval(A,1e3/R),{addScene:O,addMesh:P,setMeshPosition:x,setMeshVelocity:L}}const ee={__name:"demo13",setup(h){let s,y,m;const M=async({THREE:t,scene:w,controls:B,transControls:O,camera:P,renderer:v})=>{s=await E(),y=new t.Vector3;const G=new t.Group;let x=new t.TextureLoader,L=x.load("/home/https://ghchenjingqi.github.io/resources/images/world.jpg"),I=x.load("/home/https://ghchenjingqi.github.io/resources/images/atearth.webp"),A=new t.SphereGeometry(2,40,40),e=new t.MeshLambertMaterial({map:L,bumpMap:I,bumpScale:1}),o=new t.Mesh(A,e);o.name="earth",G.add(o);let r=x.load("/home/https://ghchenjingqi.github.io/resources/images/cloud.png"),u=new t.Mesh(new t.SphereGeometry(2.2,40,40),new t.MeshLambertMaterial({map:r,transparent:!0,opacity:.4}));u.name="earthCloud",G.add(u),w.add(G);const n=new t.Mesh(new t.BoxGeometry(10,5,10),new t.ShadowMaterial({color:4473924}));n.position.y=-5,n.receiveShadow=!0,n.userData.physics={mass:0},w.add(n);const c=100;e=new t.MeshBasicMaterial({color:16777215});let a=new t.InstancedMesh(new t.BoxGeometry(.3,.3,.3,2,2,2),e,c);a.instanceMatrix.setUsage(t.DynamicDrawUsage),a.userData.physics={mass:1};const l=new t.Matrix4,g=new t.Color;for(let p=0;p<c;p++)l.setPosition(Math.random()*3-5,Math.random()*3-5,Math.random()*3-5),a.setMatrixAt(p,l),a.setColorAt(p,g.setHSL(p/c,1,.5));a.position.set(-.5,0,1),w.add(a);let d=new t.InstancedMesh(new t.SphereGeometry(.3,30,12),e,c);d.instanceMatrix.setUsage(t.DynamicDrawUsage),d.userData.physics={mass:1};const _=new t.Matrix4,N=new t.Color;for(let p=0;p<c;p++)_.setPosition(Math.random()*2-5,Math.random()*2-5,Math.random()*2-5),d.setMatrixAt(p,_),d.setColorAt(p,N.setHSL(p/c,1,.5));d.position.set(-.5,0,1),w.add(d),s.addScene(w),m=setInterval(()=>{let p=Math.floor(Math.random()*a.count);y.set(-3,Math.random()+3,0),s.setMeshPosition(a,y,p),p=Math.floor(Math.random()*d.count),y.set(5,Math.random()+3,0),s.setMeshPosition(d,y,p)},16.666666666666668)},{loading:f,pregress:b}=J({el:"#canvas",background:"#fff",cameraPosition:[0,2,6],control:!0,controlAutoSpeed:!0,helper:!1,light:!0,creatMesh:M});return X(()=>{s=y=null,m&&clearInterval(m)}),(t,w)=>(Q(),Z(U,{loading:C(f),pregress:C(b)},{default:W(()=>[...w[0]||(w[0]=[$("canvas",{id:"canvas"},null,-1)])]),_:1},8,["loading","pregress"]))}},ce=z(ee,[["__scopeId","data-v-0376a9cf"]]);export{ce as default};
