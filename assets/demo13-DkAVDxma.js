import{V,f as Y,g as q,Q as F,u as J,L as U}from"./Loading-DruFyOl3.js";import{f as k,_ as z,a as X,c as Z,b as Q,w as W,u as C,d as $}from"./index-BW9tvWnl.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./allscreen-BRzil6w2.js";import"./loading-Cr1aGhL8.js";import"https://fastly.jsdelivr.net/gh/GHchenjingqi/resources/mds/pathList.js";const K="https://cdn.jsdelivr.net/npm/jolt-physics@0.23.0/dist/jolt-physics.wasm-compat.js",R=60;let i=null;function T(h){const a=h.parameters;if(h.type==="BoxGeometry"){const y=a.width!==void 0?a.width/2:.5,m=a.height!==void 0?a.height/2:.5,M=a.depth!==void 0?a.depth/2:.5;return new i.BoxShape(new i.Vec3(y,m,M),.05*Math.min(y,m,M),null)}else if(h.type==="SphereGeometry"||h.type==="IcosahedronGeometry"){const y=a.radius!==void 0?a.radius:1;return new i.SphereShape(y,null)}return null}const v=0,S=1,A=2;function H(h){let a=new i.ObjectLayerPairFilterTable(A);a.EnableCollision(v,S),a.EnableCollision(S,S);const y=new i.BroadPhaseLayer(0),m=new i.BroadPhaseLayer(1),M=2;let f=new i.BroadPhaseLayerInterfaceTable(A,M);f.MapObjectToBroadPhaseLayer(v,y),f.MapObjectToBroadPhaseLayer(S,m),h.mObjectLayerPairFilter=a,h.mBroadPhaseLayerInterface=f,h.mObjectVsBroadPhaseLayerFilter=new i.ObjectVsBroadPhaseLayerFilterTable(h.mBroadPhaseLayerInterface,M,h.mObjectLayerPairFilter,A)}async function E(){if(i===null){const{default:e}=await k(async()=>{const{default:o}=await import(`${K}`);return{default:o}},[]);i=await e()}const h=new i.JoltSettings;H(h);const a=new i.JoltInterface(h);i.destroy(h);const m=a.GetPhysicsSystem().GetBodyInterface(),M=[],f=new WeakMap,b=new V,t=new F,w=new V(1,1,1),B=new Y;function D(e){e.traverse(function(o){if(o.isMesh){const r=o.userData.physics;r&&P(o,r.mass,r.restitution)}})}function P(e,o=0,r=0){const p=T(e.geometry);if(p===null)return;const n=e.isInstancedMesh?O(e,o,r,p):g(e.position,e.quaternion,o,r,p);o>0&&(M.push(e),f.set(e,n))}function O(e,o,r,p){const n=e.instanceMatrix.array,c=[];for(let s=0;s<e.count;s++){const l=b.fromArray(n,s*16+12),_=t.setFromRotationMatrix(B.fromArray(n,s*16));c.push(g(l,_,o,r,p))}return c}function g(e,o,r,p,n){const c=new i.Vec3(e.x,e.y,e.z),s=new i.Quat(o.x,o.y,o.z,o.w),l=r>0?i.EMotionType_Dynamic:i.EMotionType_Static,_=r>0?S:v,d=new i.BodyCreationSettings(n,c,s,l,_);d.mRestitution=p;const G=m.CreateBody(d);return m.AddBody(G.GetID(),i.EActivation_Activate),i.destroy(d),G}function x(e,o,r=0){if(e.isInstancedMesh){const p=f.get(e),n=p[r];m.RemoveBody(n.GetID()),m.DestroyBody(n.GetID());const c=e.userData.physics;let s=n.GetShape(),l=g(o,{x:0,y:0,z:0,w:1},c.mass,c.restitution,s);p[r]=l}}function L(e,o,r=0){}const I=new q;function j(){let e=I.getDelta();e=Math.min(e,1/30);const o=e>1/55?2:1;a.Step(e,o);for(let r=0,p=M.length;r<p;r++){const n=M[r];if(n.isInstancedMesh){const c=n.instanceMatrix.array,s=f.get(n);for(let l=0;l<s.length;l++){const _=s[l],d=_.GetPosition(),G=_.GetRotation();b.set(d.GetX(),d.GetY(),d.GetZ()),t.set(G.GetX(),G.GetY(),G.GetZ(),G.GetW()),B.compose(b,t,w).toArray(c,l*16)}n.instanceMatrix.needsUpdate=!0,n.computeBoundingSphere()}else{const c=f.get(n),s=c.GetPosition(),l=c.GetRotation();n.position.set(s.GetX(),s.GetY(),s.GetZ()),n.quaternion.set(l.GetX(),l.GetY(),l.GetZ(),l.GetW())}}}return setInterval(j,1e3/R),{addScene:D,addMesh:P,setMeshPosition:x,setMeshVelocity:L}}const ee={__name:"demo13",setup(h){let a,y,m;const M=async({THREE:t,scene:w,controls:B,transControls:D,camera:P,renderer:O})=>{a=await E(),y=new t.Vector3;const g=new t.Group;let x=new t.TextureLoader,L=x.load("/home/https://fastly.jsdelivr.net/gh/GHchenjingqi/resources/images/world.jpg"),I=x.load("/home/https://fastly.jsdelivr.net/gh/GHchenjingqi/resources/images/atearth.webp"),j=new t.SphereGeometry(2,40,40),e=new t.MeshLambertMaterial({map:L,bumpMap:I,bumpScale:1}),o=new t.Mesh(j,e);o.name="earth",g.add(o);let r=x.load("/home/https://fastly.jsdelivr.net/gh/GHchenjingqi/resources/images/cloud.png"),p=new t.Mesh(new t.SphereGeometry(2.2,40,40),new t.MeshLambertMaterial({map:r,transparent:!0,opacity:.4}));p.name="earthCloud",g.add(p),w.add(g);const n=new t.Mesh(new t.BoxGeometry(10,5,10),new t.ShadowMaterial({color:4473924}));n.position.y=-5,n.receiveShadow=!0,n.userData.physics={mass:0},w.add(n);const c=100;e=new t.MeshBasicMaterial({color:16777215});let s=new t.InstancedMesh(new t.BoxGeometry(.3,.3,.3,2,2,2),e,c);s.instanceMatrix.setUsage(t.DynamicDrawUsage),s.userData.physics={mass:1};const l=new t.Matrix4,_=new t.Color;for(let u=0;u<c;u++)l.setPosition(Math.random()*3-5,Math.random()*3-5,Math.random()*3-5),s.setMatrixAt(u,l),s.setColorAt(u,_.setHSL(u/c,1,.5));s.position.set(-.5,0,1),w.add(s);let d=new t.InstancedMesh(new t.SphereGeometry(.3,30,12),e,c);d.instanceMatrix.setUsage(t.DynamicDrawUsage),d.userData.physics={mass:1};const G=new t.Matrix4,N=new t.Color;for(let u=0;u<c;u++)G.setPosition(Math.random()*2-5,Math.random()*2-5,Math.random()*2-5),d.setMatrixAt(u,G),d.setColorAt(u,N.setHSL(u/c,1,.5));d.position.set(-.5,0,1),w.add(d),a.addScene(w),m=setInterval(()=>{let u=Math.floor(Math.random()*s.count);y.set(-3,Math.random()+3,0),a.setMeshPosition(s,y,u),u=Math.floor(Math.random()*d.count),y.set(5,Math.random()+3,0),a.setMeshPosition(d,y,u)},16.666666666666668)},{loading:f,pregress:b}=J({el:"#canvas",background:"#fff",cameraPosition:[0,2,6],control:!0,controlAutoSpeed:!0,helper:!1,light:!0,creatMesh:M});return X(()=>{a=y=null,m&&clearInterval(m)}),(t,w)=>(Q(),Z(U,{loading:C(f),pregress:C(b)},{default:W(()=>[...w[0]||(w[0]=[$("canvas",{id:"canvas"},null,-1)])]),_:1},8,["loading","pregress"]))}},ce=z(ee,[["__scopeId","data-v-00cc2213"]]);export{ce as default};
