import{_ as E,r as B,o as ee,a as oe,c as te,b as ae,w as se,u as ne,d as a,t as y,j as ie,h as le,v as re}from"./index-ChFF_AJc.js";import{u as ce,L as de}from"./Loading-C_p77wqb.js";import{g as S}from"./comfun-BiQWa5Ul.js";import{W as pe,N as ue,P as fe,a as q,V as m,B as N,Q as ye}from"./cannon-es-DfQPZTbc.js";import"https://ghchenjingqi.github.io/resources/mds/pathList.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./allscreen-Ckx2K_9C.js";import"./loading-uPR8U6F_.js";const me={class:"box-position"},we={class:"grade-box",style:{display:"none"}},be={class:"gald"},he={__name:"demo34",setup(xe){let t=null,w=null,l=null,c=null,n=null,b=null;const h=B([0,0,0]),x=B(0),A=B(0),V=async({THREE:e,scene:o,camera:r})=>{let d=new e.PlaneGeometry(2e3,2e3,100,100);d.rotateX(-Math.PI/2);const p=new e.MeshBasicMaterial({color:1118481}),k=new e.Mesh(d,p);k.position.y=-.5,o.add(k);let P=new e.BoxGeometry(1,1,1),F=new e.MeshBasicMaterial({color:16711680});t=new e.Mesh(P,F),t.position.set(S(-3,3),0,S(1,4)),o.add(t),c=new e.Group;let u=new e.Mesh(P,F);u.position.x=1,u.material=new e.MeshBasicMaterial({color:16776960,transparent:!0,opacity:.8,transmission:.9,roughness:.3,metalness:.1,clearcoat:.5,clearcoatRoughness:.1,ior:1.3,thickness:.5,specularColor:new e.Color(16777215)});const G=new e.Group;for(let i=0;i<50;i++){const f=new e.Mesh(new e.SphereGeometry(.05,8,8),new e.MeshBasicMaterial({color:16777215}));f.position.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize().multiplyScalar(Math.random()*.8),G.add(f)}u.add(G);let I=u.clone();I.position.x=-1;let D=u.clone();D.position.x=0,D.position.z=-1,b=new e.Mesh(new e.PlaneGeometry(1,1),new e.MeshBasicMaterial({color:65280})),b.rotateX(-Math.PI/2).translateZ(-.49),c.add(u,I,D),o.add(c,b),l=new pe,l.gravity.set(0,0,0),l.quatNormalizeSkip=0,l.quatNormalizeFast=!1,l.broadphase=new ue;const Z=new fe,M=new q({mass:0});M.addShape(Z),M.quaternion.setFromAxisAngle(new m(1,0,0),-Math.PI/2),M.position.y=-.5,l.addBody(M);const O=new N(new m(.5,.5,.5));n=new q({mass:1,position:new m().copy(t.position),angularFactor:new m(0,0,0),angularDamping:.8,linearDamping:.8,shape:O}),n.velocity.set(0,0,0),n.allowSleep=!1,n.addEventListener("collide",i=>{i.body===w&&(t.material.color.setHex(65280),i.contact.restitution=.3)}),l.addBody(n),w=new q({mass:0}),c.traverse(i=>{if(i instanceof e.Mesh){const f=i.geometry.parameters,$=new m(f.width/2,f.height/2,f.depth/2),R=new N($),T=new m().copy(i.position),H=new ye().copy(i.quaternion);w.addShape(R,T,H)}}),l.addBody(w),r.position.set(t.position.x,t.position.y+5,t.position.z+10),r.lookAt(c.position)};let z=!1;const J=()=>{l.step(1/60),t.position.copy(n.position),t.quaternion.copy(n.quaternion),Y(),n.position.z>1&&t.material.color.setHex(16711680),t.position.y=0,n.position.y=0,n.velocity.y=0,h.value=[t.position.x,t.position.y,t.position.z],W(t,b,.5)&&(z=!0,x.value=((performance.now()-A.value)/1e3).toFixed(3),g.value=!1,document.querySelector(".grade-box").style.display="block")};function W(e,o,r=.3){return e.position.distanceTo(o.position)<r}const C=(e,o)=>{const p=new e.Vector3().copy(t.position);p.y+=8,o.position.lerp(p,.1),o.position.z+=.2,o.lookAt(c.position)},U=({THREE:e,controls:o,scene:r,camera:d,renderer:p,stats:k})=>{k?.update(),o?.update(),z||(J(),C(e,d)),p?.render(r,d)},{loading:Q}=ce({el:"#canvas",background:"#333333",cameraPosition:[2,2,6],control:!0,controlAutoSpeed:!1,helper:!1,light:!0,showStats:!0,creatMesh:V,animation:U});let v=1,X=.5,s={forward:!1,backward:!1,left:!1,right:!1,canJump:!1};const Y=()=>{const e=n.velocity;s.forward&&(e.z=-v),s.backward&&(e.z=v),s.left&&(e.x=-v),s.right&&(e.x=v),s.canJump&&Math.abs(e.y)<.01&&(e.y=X,s.canJump=!1)},K=function(e){switch(e.code){case"ArrowUp":case"KeyW":s.forward=!0;break;case"ArrowLeft":case"KeyA":s.left=!0;break;case"ArrowDown":case"KeyS":s.backward=!0;break;case"ArrowRight":case"KeyD":s.right=!0;break;case"Space":s.canJump=!1;break}},_=function(e){switch(e.code){case"ArrowUp":case"KeyW":s.forward=!1;break;case"ArrowLeft":case"KeyA":s.left=!1;break;case"ArrowDown":case"KeyS":s.backward=!1;break;case"ArrowRight":case"KeyD":s.right=!1;break;case"Space":s.canJump=!1;break}};let g=B(!1);const j=()=>g.value?((performance.now()-A.value)/1e3).toFixed(3):0,L=()=>{document.querySelector(".playbox").style.display="none",document.querySelector(".grade-box").style.display="none",document.addEventListener("keydown",K),document.addEventListener("keyup",_),g.value=!0,z=!1,A.value=performance.now();const e=S(-3,3),o=S(1,4);t.position.set(e,0,o),n.position.set(e,0,o),n.velocity.set(0,0,0),n.angularVelocity.set(0,0,0),t.material.color.setHex(16711680)};return ee(()=>{document.getElementById("reset").onclick=()=>{L()},document.getElementById("reset2").onclick=()=>{L()},document.getElementById("help").onclick=()=>{document.querySelector(".playbox").style.display="block",g.value=!1}}),oe(()=>{document.removeEventListener("keydown",K),document.removeEventListener("keyup",_),s=null}),(e,o)=>(ae(),te(de,{loading:ne(Q)},{default:se(()=>[o[2]||(o[2]=a("div",{id:"canvas"},null,-1)),a("div",me,[a("p",null,"盒子位置：x轴"+y(h.value[0].toFixed(2))+",y轴"+y(h.value[1].toFixed(2))+",z轴"+y(h.value[2].toFixed(2)),1),a("p",null,[ie("用时："+y(j())+"s ",1),le(a("span",null,"，成绩"+y(x.value)+"s",513),[[re,x.value]])])]),o[3]||(o[3]=a("div",{class:"playbox"},[a("div",{class:"help"},[a("h3",null,"玩法介绍"),a("p",null,"1.按键盘“WASD”或“↑←↓→”键移动红色盒子"),a("p",null,"2.将红色盒子移动到绿色区域，挑战成功")]),a("div",{class:"btn-group"},[a("button",{class:"btn-paly",id:"reset"},"开始挑战")])],-1)),a("div",we,[a("div",be,[o[0]||(o[0]=a("h3",null,"恭喜完成任务",-1)),a("p",null,"成绩："+y(x.value||0)+"s",1)]),o[1]||(o[1]=a("div",{class:"btn-group"},[a("button",{class:"btn-paly",id:"reset2"},"再玩一次")],-1))]),o[4]||(o[4]=a("div",{class:"btn",id:"help"},"帮助",-1))]),_:1},8,["loading"]))}},qe=E(he,[["__scopeId","data-v-a5a4631b"]]);export{qe as default};
